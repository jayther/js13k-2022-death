<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Death Estate</title>
      <style>
        a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:'';content:none}table{border-collapse:collapse;border-spacing:0}
      </style>
  </head>
  <body>
      <script>
        !function(){"use strict";const t=Math.PI,e=t=>t<0?-t:t,s=(t,e)=>t<e?t:e,n=(t,e)=>t>e?t:e,i=t=>t<0?-1:1,r=(t,e=0,s=1)=>t<e?e:t>s?s:t,o=(t,e=0,s=1)=>s-e?r((t-e)/(s-e)):0,h=(t,e=0,s=1)=>e+r(t)*(s-e),a=(t=1,e=0)=>e+(t-e)*Math.random(),c=(t=1,e=0)=>0|a(t,e),l=(t=0,e)=>null==t.x?new d(t,null==e?t:e):new d(t.x,t.y);class d{constructor(t=0,e=0){this.x=t,this.y=e}copy(){return new d(this.x,this.y)}add(t){return new d(this.x+t.x,this.y+t.y)}subtract(t){return new d(this.x-t.x,this.y-t.y)}multiply(t){return new d(this.x*t.x,this.y*t.y)}divide(t){return new d(this.x/t.x,this.y/t.y)}scale(t){return new d(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const e=this.length();return e?this.scale(t/e):new d(0,t)}clampLength(t=1){const e=this.length();return e>t?this.scale(t/e):this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,e=1){return this.x=e*Math.sin(t),this.y=e*Math.cos(t),this}rotate(t){const e=Math.cos(t),s=Math.sin(t);return new d(this.x*e-this.y*s,this.x*s+this.y*e)}direction(){return e(this.x)>e(this.y)?this.x<0?3:1:this.y<0?2:0}invert(){return new d(this.y,-this.x)}floor(){return new d(Math.floor(this.x),Math.floor(this.y))}area(){return e(this.x*this.y)}lerp(t,e){return this.add(t.subtract(this).scale(r(e)))}arrayCheck(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}class u{constructor(t=1,e=1,s=1,n=1){this.r=t,this.g=e,this.b=s,this.a=n}copy(){return new u(this.r,this.g,this.b,this.a)}add(t){return new u(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new u(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new u(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new u(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,e=t){return new u(this.r*t,this.g*t,this.b*t,this.a*e)}clamp(){return new u(r(this.r),r(this.g),r(this.b),r(this.a))}lerp(t,e){return this.add(t.subtract(this).scale(r(e)))}setHSLA(t=0,e=0,s=1,n=1){const i=s<.5?s*(1+e):s+e-s*e,r=2*s-i,o=(t,e,s)=>(s=(s%1+1)%1)<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t;return this.r=o(r,i,t+1/3),this.g=o(r,i,t),this.b=o(r,i,t-1/3),this.a=n,this}getHSLA(){const t=this.r,e=this.g,s=this.b,n=this.a,i=Math.max(t,e,s),r=Math.min(t,e,s),o=(i+r)/2;let h=0,a=0;if(i!=r){let n=i-r;a=o>.5?n/(2-i-r):n/(i+r),t==i?h=(e-s)/n+(e<s?6:0):e==i?h=(s-t)/n+2:s==i&&(h=(t-e)/n+4)}return[h/6,a,o,n]}mutate(t=.05,e=0){return new u(this.r+a(t,-t),this.g+a(t,-t),this.b+a(t,-t),this.a+a(e,-e)).clamp()}toString(){return`rgb(${255*this.r|0},${255*this.g|0},${255*this.b|0},${this.a})`}rgbaInt(){return(255*this.r|0)+(255*this.g<<8)+(255*this.b<<16)+(255*this.a<<24)}setHex(t){const e=e=>parseInt(t.slice(e,e+2),16)/255;return this.r=e(1),this.g=e(3),this.b=e(5),this.a=1,this}getHex(){const t=t=>((t=255*t|0)<16?"0":"")+t.toString(16);return"#"+t(this.r)+t(this.g)+t(this.b)}}let p=l(1920,1200),y=l(),f=l(16),g=.3,x=(l(1),l()),m=n(f.x,f.y);let w=.5;let b,v,S=[],M=[],z=0,C=0,T=0,k=0,A=0;const B="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";function D(){M=S.filter((t=>t.collideSolidObjects));const t=e=>{if(!e.destroyed){e.update();for(const s of e.children)t(s)}};for(const e of S)e.parent||t(e);S=S.filter((t=>!t.destroyed)),C=++z/60}const E=new Image;let P,L,R,I,$=l();const U=t=>t.add(l(.5)).subtract($.scale(.5)).multiply(l(1/m,-1/m)).add(x),F=t=>t.subtract(x).multiply(l(m,-m)).add($.scale(.5)).subtract(l(.5));function H(t,e=l(1),s=-1,n=f,i=new u,r=0,o,h=new u(0,0,0,0),a=1){if(a)if(s<0||!E.width)zt(t.x,t.y,e.x,e.y,r,0,0,0,0,0,i.rgbaInt());else{const a=b.x/n.x|0,c=n.x/b.x,l=n.y/b.y,d=s%a*c,u=(s/a|0)*l;zt(t.x,t.y,o?-e.x:e.x,e.y,r,d+v.x,u+v.y,d-v.x+c,u-v.y+l,i.rgbaInt(),h.rgbaInt())}else!function(t,e,s,n,i,r=L){t=F(t),e=e.scale(m),r.save(),r.translate(t.x+.5|0,t.y-.5|0),r.rotate(s),r.scale(n?-e.x:e.x,e.y),i(r),r.restore()}(t,e,r,o,(t=>{if(s<0)t.fillStyle=i,t.fillRect(-.5,-.5,1,1);else{const e=b.x/n.x|0,r=s%e*n.x+g,o=(s/e|0)*n.y+g,h=n.x-.6,a=n.y-.6;t.globalAlpha=i.a,t.drawImage(E,r,o,h,a,-.5,-.5,1,1)}}))}function _(t,e,s,n,i){H(t,e,-1,f,s,n,0,0,i)}function q(t,e,s,n,i){!function(t,e=l(1),s,n,i,r,o,h,a){H(U(t),e.scale(1/m),s,n,i,r,o,h,a)}(t,e,-1,f,s,n,0,0,i)}function O(t,e,s=1,n=new u,i=0,r=new u(0,0,0),o="center",h="arial"){I.fillStyle=n,I.lineWidth=i,I.strokeStyle=r,I.textAlign=o,I.font=s+"px "+h,I.textBaseline="middle",I.lineJoin="round",e=e.copy(),(t+"").split("\n").forEach((t=>{i&&I.strokeText(t,e.x,e.y),I.fillText(t,e.x,e.y),e.y+=s}))}function G(t,e,s=1,n,i,r,o,h){O(t,F(e),s*m,n,i*m,r,o,h)}const N=(t,e=0)=>Z[e]&&1&Z[e][t]?1:0,W=N,J=(t,e=0)=>Z[e]&&2&Z[e][t]?1:0,Y=(t,e=0)=>Z[e]&&4&Z[e][t]?1:0;let j=l(),K=l(),V=0,X=0;const Q=(t,e=0)=>N(t,e+1);let Z=[[]];function tt(){document.hasFocus()||(Z=[[]]),j=U(K),function(){0;if(!navigator.getGamepads||!document.hasFocus())return;const t=navigator.getGamepads();for(let e=t.length;e--;){const s=t[e],n=Z[e+1]||(Z[e+1]=[]),i=it[e]||(it[e]=[]);if(s){const t=.3,r=.8,h=e=>e>t?o(e,t,r):e<-t?-o(-e,t,r):0;for(let t=0;t<s.axes.length-1;t+=2)i[t>>1]=l(h(s.axes[t]),h(-s.axes[t+1])).clampLength();for(let t=s.buttons.length;t--;){const i=s.buttons[t];n[t]=i.pressed?1+2*!Q(t,e):4*Q(t,e),X|=!e&&i.pressed}{const t=l(Q(15,e)-Q(14,e),Q(12,e)-Q(13,e));t.lengthSquared()&&(i[0]=t.clampLength())}}}}()}function et(){for(const t of Z)for(const e in t)t[e]&=1;V=0}onkeydown=t=>{t.repeat||(Z[X=0][st(t.keyCode)]=3)},onkeyup=t=>{Z[0][st(t.keyCode)]=4};const st=t=>87==t?38:83==t?40:65==t?37:68==t?39:t;onmousedown=t=>{Z[X=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=t=>Z[0][t.button]=2&Z[0][t.button]|4,onmousemove=t=>K=nt(t),onwheel=t=>t.ctrlKey||(V=i(t.deltaY)),oncontextmenu=t=>!1;const nt=t=>{if(!P)return l();const e=P.getBoundingClientRect();return l(P.width,P.height).multiply(l(o(t.x,e.left,e.right),o(t.y,e.top,e.bottom)))},it=[];const rt=void 0!==window.ontouchstart;if(rt){let t,e;ontouchstart=ontouchmove=ontouchend=s=>{s.button=0;const n=s.touches.length;return n?(e||ht(0,e=1),s.x=s.touches[0].clientX,s.y=s.touches[0].clientY,t?onmousemove(s):onmousedown(s)):t&&onmouseup(s),t=n,!s.cancelable}}let ot;new class{constructor(t){this.time=null==t?void 0:C+t,this.setTime=t}set(t=0){this.time=C+t,this.setTime=t}unset(){this.time=void 0}isSet(){return null!=this.time}active(){return C<=this.time}elapsed(){return C>this.time}get(){return this.isSet()?C-this.time:0}getPercent(){return this.isSet()?o(this.time-C,this.setTime,0):0}toString(){0}},l();const ht=(...t)=>function(t,e=1,s=1,n=0,i=0){if(ot||(ot=new(window.AudioContext||webkitAudioContext)),ot.resume(),"running"!=ot.state)return;const o=ot.createBuffer(t.length,t[0].length,at),h=ot.createBufferSource();t.forEach(((t,e)=>o.getChannelData(e).set(t))),h.buffer=o,h.playbackRate.value=s,h.loop=i;const a=ot.createGain();return a.gain.value=.5*e,a.connect(ot.destination),(window.StereoPannerNode?h.connect(new StereoPannerNode(ot,{pan:r(n,-1,1)})):h).connect(a),h.start(),h}([ct(...t)]),at=44100;function ct(r=1,o=.05,h=220,c=0,l=0,d=.1,u=0,p=1,y=0,f=0,g=0,x=0,m=0,w=0,b=0,v=0,S=0,M=1,z=0,C=0){let T,k,A=2*t,B=y*=500*A/at/at,D=[],E=h*=(1+o*a(-1,1))*A/at,P=0,L=0,R=0,I=1,$=0,U=0,F=0;for(f*=500*A/at**3,b*=A/at,g*=A/at,x*=at,m=m*at|0,k=(c=c*at+9)+(z*=at)+(l*=at)+(d*=at)+(S*=at)|0;R<k;D[R++]=F)++U%(100*v|0)||(F=u?u>1?u>2?u>3?Math.sin((P%A)**3):n(s(Math.tan(P),1),-1):1-(2*P/A%2+2)%2:1-4*e(Math.round(P/A)-P/A):Math.sin(P),F=(m?1-C+C*Math.sin(A*R/m):1)*i(F)*e(F)**p*r*.5*(R<c?R/c:R<c+z?1-(R-c)/z*(1-M):R<c+z+l?M:R<k-S?(k-R-S)/d*M:0),F=S?F/2+(S>R?0:(R<k-S?1:(k-R)/S)*D[R-S|0]/2):F),T=(h+=y+=f)*Math.cos(b*L++),P+=T-T*w*(1-1e9*(Math.sin(R)+1)%2),I&&++I>x&&(h+=g,E+=g,I=0),!m||++$%m||(h=E,y=B,I=I||1);return D}l();let lt,dt,ut,pt,yt,ft,gt,xt,mt,wt,bt,vt=[];function St(t,e){const s=ut.createShader(e);return ut.shaderSource(s,t),ut.compileShader(s),s}function Mt(){if(!mt)return;const t=wt?Ct:At;ut.blendFuncSeparate(kt,t,Ct,t),ut.enable(Bt),ut.bufferSubData(qt,0,gt.subarray(0,mt*Wt*Jt)),ut.drawArrays(Tt,0,mt*Wt),mt=0,wt=bt}function zt(t,e,s,n,i,r,o,h,a,c=4294967295,l=0){mt!=Yt&&wt==bt||Mt();const d=Math.cos(i)/2,u=Math.sin(i)/2,p=d*s,y=d*n,f=u*s,g=u*n;let x=mt++*Wt*Jt;gt[x++]=t-p-g,gt[x++]=e-y+f,gt[x++]=r,gt[x++]=a,xt[x++]=c,xt[x++]=l,gt[x++]=t+p+g,gt[x++]=e+y-f,gt[x++]=h,gt[x++]=o,xt[x++]=c,xt[x++]=l,gt[x++]=t-p+g,gt[x++]=e+y+f,gt[x++]=r,gt[x++]=o,xt[x++]=c,xt[x++]=l,gt[x++]=t-p-g,gt[x++]=e-y+f,gt[x++]=r,gt[x++]=a,xt[x++]=c,xt[x++]=l,gt[x++]=t+p-g,gt[x++]=e-y-f,gt[x++]=h,gt[x++]=a,xt[x++]=c,xt[x++]=l,gt[x++]=t+p+g,gt[x++]=e+y-f,gt[x++]=h,gt[x++]=o,xt[x++]=c,xt[x++]=l}const Ct=1,Tt=4,kt=770,At=771,Bt=3042,Dt=3553,Et=5121,Pt=5126,Lt=6408,Rt=9728,It=10240,$t=10241,Ut=10242,Ft=10243,Ht=16384,_t=33071,qt=34962,Ot=35048,Gt=35632,Nt=35633,Wt=6,Jt=6,Yt=65536,jt=24,Kt=0,Vt=1,Xt=2,Qt=3,Zt=4,te=5,ee=0,se=1,ne=2,ie=3,re=[[0,1],[1,0],[0,-1],[-1,0]],oe=0,he=1,ae=2,ce=3,le=4,de=5;class ue{constructor(){this.buttons=[],this.pressedButton=null}addBtn(t){this.buttons.push(t)}removeBtn(t){const e=this.buttons.indexOf(t);e>-1&&this.buttons.splice(e,1)}pressed(){this.pressedButton=null;for(let t=this.buttons.length-1;t>=0&&!this.pressedButton;t--){const e=this.buttons[t];e.cmp()&&(this.pressedButton=e)}return!!this.pressedButton}released(){return!!this.pressedButton&&(this.pressedButton.cmp()&&this.pressedButton.pressed(),this.pressedButton=null,!0)}render(){this.buttons.forEach((t=>t.render()))}}class pe{constructor(t,e,s,n,i,r,o,h=!0){this.pos=t,this.size=e,this.text=s,this.textSize=n,this.bgColor=i,this.textColor=r,this.onPressed=o||(()=>{}),this._enabled=!0,this.visible=!0,this.screenSpace=h}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this.bgColor.a=t?1:.5,this.textColor.a=t?1:.5}cmp(){if(!this.enabled||!this.visible)return!1;const t=this.screenSpace?K:j;return t.x>=this.pos.x-this.size.x/2&&t.y>=this.pos.y-this.size.y/2&&t.x<this.pos.x+this.size.x/2&&t.y<this.pos.y+this.size.y/2}pressed(){this.onPressed()}render(){if(!this.visible)return;let t,e;this.screenSpace?(t=q,e=O):(t=_,e=G),t(this.pos,this.size,this.bgColor),e(this.text,this.pos,this.textSize,this.textColor)}}const ye=new class{constructor(){this.cm=null,this.gs=oe}init(t){this.cm=t}sgs(t,e){this.gs=t,this.cc=this.cm[t],this.cc.init(e)}gameUpdate(){this.cc.gameUpdate()}gameRender(){this.cc.gameRender()}},fe=new pe(l(0,-2),l(4,2.5),"Start",1.5,new u(1,1,1),new u(0,0,0),(()=>{ye.sgs(ae)}),!1),ge=new ue;ge.addBtn(fe);const xe={init(){},gameUpdate(){J(0)&&ge.pressed(),Y(0)&&ge.released()},gameRender(){G("Death Estate",l(0,4),5,new u(1,0,0),a(1,1.2),new u(1,1,1)),ge.render()}},me=[null,null,new u(.6,.6,.6),new u(.5,.5,.5),new u(.8,.3,.3),new u(1,0,0)],we=[new u(.3,.3,.3),new u(.35,.35,.35)];class be{constructor(t,e,s){this.x=e,this.y=s,this.type=t||0}copy(){return new be(this.type,this.x,this.y)}apply(t){this.type=t.type}}class ve{constructor(t,e){this.pos=l(),this.tiles=[],this.houses=[],this.sst=[],this.arc=!1,this.hvs=!1,this.size=l(t,e);const s=this.size.x*this.size.y;for(let t=0;t<s;t+=1){const e=new be(0,t%this.size.x,Math.floor(t/this.size.y));this.tiles.push(e),this.sst.push(e.copy())}}csst(){this.tiles.forEach(((t,e)=>this.sst[e].apply(t)))}hcf(t){const e=t.gwb(),s=this.gwb();if(!(e[0].x>=s[0].x&&e[0].y>=s[0].y&&e[1].x<=s[1].x&&e[1].y<=s[1].y))return!1;const n=t.pos.divide(l(2)),i=t.tiles;for(let t=0;t<i.length;t+=1){const e=i[t];for(let s=0;s<e.length;s+=1){if(!e[s])continue;const i=n.add(l(s,t)),r=this.getTile(i.x,i.y);if(r&&r.type)return!1}}return!0}hfs(t){const e=t.copy();e.state=ie;for(const t of this.tiles){const s=l(t.x,t.y).multiply(l(2));e.pos=s;for(let t=0;t<4;t++){if(this.hcf(e)&&this.hitr(e))return e;e.rotate(1)}}return null}cvs(){const t=this.tiles.filter((t=>t.type===Xt));for(const e of t)for(const t of re){const s=l(e.x+t[0],e.y+t[1]),n=this.getTile(s.x,s.y);if(n&&n.type===Kt)return void(this.hvs=!0)}this.hvs=!1}hitr(t){const e=t.pos.divide(l(2)),s=t.tiles;for(let t=0;t<s.length;t+=1){const n=s[t];for(let s=0;s<n.length;s+=1){if(!n[s])continue;const i=e.add(l(s,t));if(re.map((t=>this.getTile(i.x+t[0],i.y+t[1]))).filter((t=>t)).some((t=>t.type===Xt)))return!0}}return!1}ah(t){t.state=se,this.houses.push(t);const e=t.pos.divide(l(2)),s=t.tiles;for(let t=0;t<s.length;t+=1){const n=s[t];for(let s=0;s<n.length;s+=1){if(!n[s])continue;const i=e.add(l(s,t));this.setTile(i.x,i.y,Vt)}}}gws(){return this.size.multiply(l(2))}gwb(){return[this.pos.copy(),this.pos.add(this.size.multiply(l(2)))]}setTile(t,e,s){this.tiles[t+e*this.size.x].type=s}getTile(t,e){return l(t,e).arrayCheck(this.size)?this.tiles[t+e*this.size.x]:null}gtfmp(){const t=this.gcfmp();return t?this.getTile(t.x,t.y):null}gcfmp(t=!1){return this.gcfp(j,t)}gcfp(t,e=!1){const s=t.subtract(this.pos).add(l(1));return e||s.arrayCheck(this.size.multiply(l(2)))?s.divide(l(2)).floor():null}setTileLine(t,e,s){const n=[];if(Math.abs(e.x-t.x)<Math.abs(e.y-t.y)){const s=Math.max(Math.min(e.y,t.y),0),i=Math.min(Math.max(e.y,t.y),this.size.y-1);for(let e=s;e<=i;e+=1)n.push(this.getTile(t.x,e))}else{const s=Math.max(Math.min(e.x,t.x),0),i=Math.min(Math.max(e.x,t.x),this.size.x-1);for(let e=s;e<=i;e+=1)n.push(this.getTile(e,t.y))}for(const t of n)t.type=s;return n}rtsst(){this.tiles.forEach(((t,e)=>t.apply(this.sst[e])))}crc(){const t=this.tiles.filter((t=>t.type===Xt||t.type===te));t.forEach((t=>t.type=te));const e=t.filter((t=>0===t.x||0===t.y||t.x===this.size.x-1||t.y===this.size.y-1));e.length?(e.forEach((t=>this.scr(t.x,t.y))),this.arc=t.every((t=>t.type===Xt))):this.arc=!1}scr(t,e){const s=this.getTile(t,e);if(s&&s.type===te){s.type=Xt;for(const s of re)this.scr(t+s[0],e+s[1])}}c(){const t=this.size.x*this.size.y;let e=0,s=0;for(const t of this.tiles)t.type===Vt?e+=1:t.type===Xt&&(s+=1);return{totalCount:t,houseTileCount:e,roadCount:s}}render(){for(const t of this.tiles){const e=l(t.x,t.y).multiply(l(2)).add(this.pos),s=me[t.type]||we[(t.x+t.y)%2];s&&_(e,l(2),s)}for(const t of this.houses)t.render()}}const Se=[new u,new u(.9,.9,.9),new u(1,.3,.3),new u(1,1,1,.5)];class Me{constructor(t,e){this.pos=t,this.tiles=e||function(t){const e=2*t-1,s=c(1,e**2+1),n=[],i=[];for(let t=0;t<e;t++)n.push(new Array(e).fill(Kt));for(let t=0;t<s;t++){let s,r;if(0===t)s=c(0,e),r=c(0,e),i.push([s,r]);else{const t=i[c(0,i.length)],o=re.map((s=>{let i=[t[0]+s[0],t[1]+s[1]];return i[0]<0||i[0]>=e||i[1]<0||i[1]>=e||n[i[1]][i[0]]!==Kt?null:i})).filter((t=>t));if(!o.length)continue;const h=o[c(0,o.length)];[s,r]=h,i.push(h)}n[r][s]=Vt}for(let t=n.length-1;t>=0;t--)n[t].every((t=>t===Kt))&&n.splice(t,1);for(let t=e-1;t>=0;t--)n.map((e=>e[t])).every((t=>t===Kt))&&n.forEach((e=>e.splice(t,1)));return n}(2),this.state=ee}copy(){const t=[];for(let e=0;e<this.tiles.length;e++)t.push([...this.tiles[e]]);return new Me(this.pos.copy(),t)}gwb(){const t=2*this.tiles[0].length,e=2*this.tiles.length;return[this.pos.copy(),this.pos.add(l(t,e))]}ic(){const t=j.subtract(this.pos).add(l(1)).divide(l(2)).floor(),e=this.tiles[t.y];return!!e&&!!e[t.x]}rotate(t){const e=this.tiles.length,s=this.tiles[0].length,n=new Array(s);for(let t=0;t<s;t++)n[t]=new Array(e).fill(Kt);for(let t=0;t<e;t++)for(let e=0;e<s;e++)n[e][t]=this.tiles[t][e];1===t?n.reverse():n.forEach((t=>t.reverse())),this.tiles=n}render(){for(let t=0;t<this.tiles.length;t+=1){const e=this.tiles[t];for(let s=0;s<e.length;s+=1){if(!e[s])continue;const n=Se[this.state]||new u(1,0,0);_(l(s,t).multiply(l(2)).add(this.pos),l(2),n)}}}}let ze,Ce,Te,ke,Ae,Be=l(),De=null,Ee=null,Pe=l(),Le=null;const Re=l(),Ie=l();let $e=l();const Ue=new ue,Fe=new pe(l(0,-4),l(5,3),"Done",1.5,new u(1,1,1),new u(0,0,0),(()=>{ze.arc&&ye.sgs(ce)}),!1);Ue.addBtn(Fe);const He=new ue,_e=new pe(l(0,-5),l(5,3),"Rotate",1.2,new u(1,1,1),new u(0,0,0),(()=>{Ae.rotate(1)}),!1);He.addBtn(_e);const qe=new pe(_e.pos.add(l(0,-4)),l(5,3),"Skip",1.5,new u(1,1,1),new u(0,0,0),(()=>{Te>0&&(Te-=1,We()),Te<=0&&(qe.enabled=!1)}),!1);He.addBtn(qe);const Oe={lower:l(),upper:l()},Ge=qe.pos.subtract(qe.size.divide(l(2))).add(l(1)),Ne=_e.pos.add(_e.size.divide(l(2))).add(l(1));function We(){Ae=new Me(Pe.copy()),Le=ze.hfs(Ae)}const Je={init(){ze=new ve(15,15),De=null,Ee=null;const t=ze.gws();x.x=ze.pos.x+t.x/2-1,x.y=ze.pos.y+t.y/2-1,Fe.pos.x=ze.pos.x+t.x/2-1,Fe.enabled=!1,Re.x=Fe.pos.x,Re.y=ze.pos.y+t.y-1+5,Ie.x=Fe.pos.x,Ie.y=Fe.pos.y-4},gameUpdate(){if(J(0)&&!Ue.pressed()&&(Ee=ze.gcfmp(),Ee)){ze.csst();const t=ze.gtfmp();Ce=t.type===Xt||t.type===te?Zt:Qt}if(Y(0)){if(Ue.released(),Ee){ze.rtsst();const t=ze.gcfmp(!0);Ce===Qt?ze.setTileLine(Ee,t,Xt):ze.setTileLine(Ee,t,Kt),ze.crc(),Fe.enabled=ze.arc}Ee=null}if(W(0)&&Ee){ze.rtsst();const t=ze.gcfmp(!0);ze.setTileLine(Ee,t,Ce)}},gameRender(){ze.render(),G("Make roads by clicking and dragging lines\non the grid. Delete by clicking and dragging\non existing roads",Re,1.5),ze.arc||G("All roads must connect to an edge of the grid",Ie,1.5),Ue.render()}},Ye={init(){const t=ze.gws();Pe.x=ze.pos.x+t.x/2-1,Pe.y=-8,Te=3,qe.enabled=!0;const e=ze.gwb();Oe.lower=e[0].subtract(l(8)),Oe.upper=e[1].add(l(8)),ze.cvs(),We()},gameUpdate(){if(Y(2)&&Ae.rotate(1),J(0)&&!He.pressed()&&Ae.ic()&&(Ae.state=ee,Be=Ae.pos.copy(),De=j.copy()),Y(0)&&(He.released(),De)){Ae.pos.x=2*Math.floor((Ae.pos.x+1)/2),Ae.pos.y=2*Math.floor((Ae.pos.y+1)/2);const t=Ae.gwb(),e=l((t[0].x+t[1].x)/2,(t[0].y+t[1].y)/2);e.x>=Ge.x&&e.x<=Ne.x&&e.y>=Ge.y&&e.y<=Ne.y&&(Ae.pos.x=Be.x,Ae.pos.y=Be.y),ze.hcf(Ae)&&ze.hitr(Ae)?(ze.ah(Ae),ze.cvs(),We()):Ae.state=ne,De=null}if(W(0)&&De){Ae.pos.x=Be.x+(j.x-De.x),Ae.pos.y=Be.y+(j.y-De.y);const t=Ae.gwb();t[0].x<Oe.lower.x?Ae.pos.x=Oe.lower.x:t[1].x>Oe.upper.x&&(Ae.pos.x=Oe.upper.x-(t[1].x-t[0].x)),t[0].y<Oe.lower.y?Ae.pos.y=Oe.lower.y:t[1].y>Oe.upper.y&&(Ae.pos.y=Oe.upper.y-(t[1].y-t[0].y))}(!ze.hvs||!Le&&Te<=0)&&ye.sgs(le)},gameRender(){ze.render(),Ae.render(),G("Place houses! Must touch a road, not overlap\nother houses, and be within the grid",Re,1.5),G("right-click\nworks too",_e.pos.add(l(3,.5)),1,void 0,void 0,void 0,"left"),G(`Skips left: ${Te}`,qe.pos.add(l(3,0)),1.5,void 0,void 0,void 0,"left"),He.render()}},je={init(){_e.enabled=!1,qe.enabled=!1,ke=Date.now()},gameUpdate(){const e=Date.now(),s=e-ke;if($e=((e=1)=>(new d).setAngle(a(2*t),e))(h(o(s,0,1e3),1,0)),s>=3e3){const t=ze.c();ye.sgs(de,{timestamp:e,totalMaxScore:t.totalCount,score:t.houseTileCount,roadCount:t.roadCount})}},gameRender(){ze.render(),Ae.render(),G("Game over! No more space or skips",Re.add($e),1.5),G("right-click\nworks too",_e.pos.add(l(3,.5)),1,new u(1,1,1,.5),void 0,void 0,"left"),G(`Skips left: ${Te}`,qe.pos.add(l(3,0)),1.5,new u(1,1,1,.5),void 0,void 0,"left"),He.render()}},Ke=new u(1,0,0),Ve=new u(1,1,1),Xe=new u(1,1,1),Qe=new u(1,1,0),Ze="deathestate_jayther_ldb",ts={};let es,ss=[],ns=0,is=0,rs=!0;const os=l(0,18),hs=os.add(l(0,-5)),as=os.add(l(0,-13)),cs=as.add(l(3,-5)),ls=new Array(5);for(let t=0;t<ls.length;t++)ls[t]=[cs.add(l(-.7,-2*t)),cs.add(l(.7,-2*t))];const ds=new ue,us=new pe(os.add(l(0,-31)),l(5,3),"Retry",1.5,new u(1,1,1),new u(0,0,0),(()=>{ye.sgs(ae)}),!1);function ps(t,e){for(es={score:t,timestamp:e,dateStr:new Date(e).toLocaleDateString(),current:!0},ss.push(es),ss.sort(((t,e)=>{const s=e.score-t.score;return 0===s?e.timestamp-t.timestamp:s}));ss.length>5;)ss.pop();!function(){const t=ss.map((t=>({score:t.score,timestamp:t.timestamp}))),e=JSON.stringify(t);if(rs)try{window.localStorage.setItem(Ze,e)}catch(t){rs=!1}rs||(ts[Ze]=e)}()}ds.addBtn(us);const ys=[{init(){},gameUpdate(){},gameRender(){}},xe,Je,Ye,je,{init(t){ns=t.totalMaxScore,is=t.roadCount,function(){let t=null;if(rs)try{t=window.localStorage.getItem(Ze)}catch(t){rs=!1}else t=ts[Ze]||null;t&&(ss=JSON.parse(t)),ss.forEach((t=>t.dateStr=new Date(t.timestamp).toLocaleDateString()))}(),ps(t.score,t.timestamp),x.x=0,x.y=0},gameUpdate(){J(0)&&ds.pressed(),Y(0)&&ds.released()},gameRender(){!function(){G("Game over",os,4,Ke,.5,Ve),G(`You covered ${es.score} tiles (${Math.floor(es.score/ns*100)}%)\n(road count: ${is}, grid total: ${ns})`,hs,2,Xe),G("High Scores",as,4,Ke,.5,Ve);for(let t=0;t<5;t++){const e=ss[t];let s,n,i;e?(s=e.dateStr,n=e.score.toString(),i=e.current?Qe:Xe):(s="-------------",n="---",i=Xe),G(s,ls[t][0],2,i,void 0,void 0,"right"),G(n,ls[t][1],2,i,void 0,void 0,"left")}}(),ds.render()}}],fs=680,gs=940,xs=m;!function(t,e,n,i,r,o){E.onerror=E.onload=()=>{v=l(g).divide(b=l(E.width,E.height)),document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-moz-user-select:none",document.body.appendChild(P=document.createElement("canvas")),L=P.getContext("2d"),P.style=B,function(){0;dt=document.createElement("canvas"),ut=dt.getContext("webgl",{antialias:!1}),dt.style=B,pt=function(t){if(!t||!t.width)return;const e=ut.createTexture();return ut.bindTexture(Dt,e),ut.texImage2D(Dt,0,Lt,Lt,Et,t),ut.texParameteri(Dt,$t,Rt),ut.texParameteri(Dt,It,Rt),ut.texParameteri(Dt,Ut,_t),ut.texParameteri(Dt,Ft,_t),e}(E),document.body.appendChild(dt),ft=function(t,e){0;const s=ut.createProgram();ut.attachShader(s,St(t,Nt)),ut.attachShader(s,St(e,Gt)),ut.linkProgram(s),0;return s}("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}","precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}");const t=new ArrayBuffer(Yt*Wt*jt);(function(t,e,s){0;const n=ut.createBuffer();ut.bindBuffer(t,n),ut.bufferData(t,e,s)})(qt,t.byteLength,Ot),gt=new Float32Array(t),xt=new Uint32Array(t);let e=mt=0;const s=(t,s,n,i,r=0)=>{const o=ut.getAttribLocation(ft,t);ut.enableVertexAttribArray(o),ut.vertexAttribPointer(o,i,s,r,jt,e),e+=i*n};s("p",Pt,4,2),s("t",Pt,4,2),s("c",Et,1,4,1),s("a",Et,1,4,1)}(),document.body.appendChild(R=document.createElement("canvas")),I=R.getContext("2d"),R.style=B,t(),h()};const h=(t=0)=>{let o=t-k;if(k=t,T+=o/1e3,A=s(A+!0*o,50),y.x){R.width=P.width=y.x,R.height=P.height=y.y;const t=innerWidth/innerHeight,e=P.width/P.height;P.style.width=R.style.width=t<e?"100%":"",P.style.height=R.style.height=t<e?"":"100%",dt&&(dt.style.width=P.style.width,dt.style.height=P.style.height)}else R.width=P.width=s(innerWidth,p.x),R.height=P.height=s(innerHeight,p.y);$=l(P.width,P.height);{let t=0;for(A<0&&A>-9&&(t=A,A=0);A>=0;A-=1e3/60)tt(),e(),D(),n(),et();A+=t}$=l(P.width,P.height),L.imageSmoothingEnabled=!1,function(t,e,s,n,i){var r;ut.viewport(0,0,dt.width=t,dt.height=e),ut.clear(Ht),ut.bindTexture(Dt,yt=pt),ut.useProgram(ft),bt=r;const o=2*i/t,h=2*i/e;ut.uniformMatrix4fv(ut.getUniformLocation(ft,"m"),0,new Float32Array([o,0,0,0,0,h,0,0,1,1,-1,1,-1-o*s,-1-h*n,0,0]))}(P.width,P.height,x.x,x.y,m),i(),S.sort(((t,e)=>t.renderOrder-e.renderOrder));for(const t of S)t.destroyed||t.render();r(),function(){if(!vt.length)return;const t=vt[0],e=T-lt;if(lt)if(e>5)vt.shift(lt=0);else{const s=4.5,n=e<w?1-e/w:e>s?(e-s)/w:0;t.render(n)}else lt=T}(),function(t,e){if(!mt&&!e)return;Mt(),e&&t.drawImage(dt,0,0)}(L),requestAnimationFrame(h)};o?E.src=o:E.onload()}((function(){ws(),ye.init(ys),ye.sgs(he)}),(function(){ye.gameUpdate()}),(function(){}),(function(){ye.gameRender()}),(function(){}));let ms=null;function ws(){const t=fs/gs>innerWidth/innerHeight?innerWidth/fs:innerHeight/gs;!function(t){m=t}(xs*t)}window.addEventListener("resize",(function(){clearTimeout(ms),ms=setTimeout(ws,200)}),!1)}();
      </script>
  </body>
</html>
