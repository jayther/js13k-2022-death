<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Death Estate</title>
      <style>
        a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:'';content:none}table{border-collapse:collapse;border-spacing:0}
      </style>
  </head>
  <body>
      <script>
        !function(){"use strict";const t=Math.PI,e=t=>t<0?-t:t,s=(t,e)=>t<e?t:e,n=(t,e)=>t>e?t:e,i=t=>t<0?-1:1,o=(t,e=0,s=1)=>t<e?e:t>s?s:t,r=(t,e=0,s=1)=>s-e?o((t-e)/(s-e)):0,h=(t=1,e=0)=>e+(t-e)*Math.random(),a=(t=1,e=0)=>0|h(t,e),l=(t=0,e)=>null==t.x?new c(t,null==e?t:e):new c(t.x,t.y);class c{constructor(t=0,e=0){this.x=t,this.y=e}copy(){return new c(this.x,this.y)}add(t){return new c(this.x+t.x,this.y+t.y)}subtract(t){return new c(this.x-t.x,this.y-t.y)}multiply(t){return new c(this.x*t.x,this.y*t.y)}divide(t){return new c(this.x/t.x,this.y/t.y)}scale(t){return new c(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const e=this.length();return e?this.scale(t/e):new c(0,t)}clampLength(t=1){const e=this.length();return e>t?this.scale(t/e):this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,e=1){return this.x=e*Math.sin(t),this.y=e*Math.cos(t),this}rotate(t){const e=Math.cos(t),s=Math.sin(t);return new c(this.x*e-this.y*s,this.x*s+this.y*e)}direction(){return e(this.x)>e(this.y)?this.x<0?3:1:this.y<0?2:0}invert(){return new c(this.y,-this.x)}floor(){return new c(Math.floor(this.x),Math.floor(this.y))}area(){return e(this.x*this.y)}lerp(t,e){return this.add(t.subtract(this).scale(o(e)))}arrayCheck(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}class u{constructor(t=1,e=1,s=1,n=1){this.r=t,this.g=e,this.b=s,this.a=n}copy(){return new u(this.r,this.g,this.b,this.a)}add(t){return new u(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new u(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new u(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new u(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,e=t){return new u(this.r*t,this.g*t,this.b*t,this.a*e)}clamp(){return new u(o(this.r),o(this.g),o(this.b),o(this.a))}lerp(t,e){return this.add(t.subtract(this).scale(o(e)))}setHSLA(t=0,e=0,s=1,n=1){const i=s<.5?s*(1+e):s+e-s*e,o=2*s-i,r=(t,e,s)=>(s=(s%1+1)%1)<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t;return this.r=r(o,i,t+1/3),this.g=r(o,i,t),this.b=r(o,i,t-1/3),this.a=n,this}getHSLA(){const t=this.r,e=this.g,s=this.b,n=this.a,i=Math.max(t,e,s),o=Math.min(t,e,s),r=(i+o)/2;let h=0,a=0;if(i!=o){let n=i-o;a=r>.5?n/(2-i-o):n/(i+o),t==i?h=(e-s)/n+(e<s?6:0):e==i?h=(s-t)/n+2:s==i&&(h=(t-e)/n+4)}return[h/6,a,r,n]}mutate(t=.05,e=0){return new u(this.r+h(t,-t),this.g+h(t,-t),this.b+h(t,-t),this.a+h(e,-e)).clamp()}toString(){return`rgb(${255*this.r|0},${255*this.g|0},${255*this.b|0},${this.a})`}rgbaInt(){return(255*this.r|0)+(255*this.g<<8)+(255*this.b<<16)+(255*this.a<<24)}setHex(t){const e=e=>parseInt(t.slice(e,e+2),16)/255;return this.r=e(1),this.g=e(3),this.b=e(5),this.a=1,this}getHex(){const t=t=>((t=255*t|0)<16?"0":"")+t.toString(16);return"#"+t(this.r)+t(this.g)+t(this.b)}}let d=l(1920,1200),y=l(),f=l(16),p=.3,g=(l(1),l()),m=n(f.x,f.y),x=.5;let w,b,v=[],S=[],C=0,M=0,T=0,z=0,P=0;const B="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";function R(){S=v.filter((t=>t.collideSolidObjects));const t=e=>{if(!e.destroyed){e.update();for(const s of e.children)t(s)}};for(const e of v)e.parent||t(e);v=v.filter((t=>!t.destroyed)),M=++C/60}const A=new Image;let F,k,E,I,L=l();const D=t=>t.add(l(.5)).subtract(L.scale(.5)).multiply(l(1/m,-1/m)).add(g),$=t=>t.subtract(g).multiply(l(m,-m)).add(L.scale(.5)).subtract(l(.5));function G(t,e=l(1),s=-1,n=f,i=new u,o=0,r,h=new u(0,0,0,0),a=1){if(a)if(s<0||!A.width)Mt(t.x,t.y,e.x,e.y,o,0,0,0,0,0,i.rgbaInt());else{const a=w.x/n.x|0,l=n.x/w.x,c=n.y/w.y,u=s%a*l,d=(s/a|0)*c;Mt(t.x,t.y,r?-e.x:e.x,e.y,o,u+b.x,d+b.y,u-b.x+l,d-b.y+c,i.rgbaInt(),h.rgbaInt())}else!function(t,e,s,n,i,o=k){t=$(t),e=e.scale(m),o.save(),o.translate(t.x+.5|0,t.y-.5|0),o.rotate(s),o.scale(n?-e.x:e.x,e.y),i(o),o.restore()}(t,e,o,r,(t=>{if(s<0)t.fillStyle=i,t.fillRect(-.5,-.5,1,1);else{const e=w.x/n.x|0,o=s%e*n.x+p,r=(s/e|0)*n.y+p,h=n.x-.6,a=n.y-.6;t.globalAlpha=i.a,t.drawImage(A,o,r,h,a,-.5,-.5,1,1)}}))}function U(t,e,s,n,i){G(t,e,-1,f,s,n,0,0,i)}function H(t,e,s,n,i){!function(t,e=l(1),s,n,i,o,r,h,a){G(D(t),e.scale(1/m),s,n,i,o,r,h,a)}(t,e,-1,f,s,n,0,0,i)}function W(t,e,s=1,n=new u,i=0,o=new u(0,0,0),r="center",h="arial"){I.fillStyle=n,I.lineWidth=i,I.strokeStyle=o,I.textAlign=r,I.font=s+"px "+h,I.textBaseline="middle",I.lineJoin="round",e=e.copy(),(t+"").split("\n").forEach((t=>{i&&I.strokeText(t,e.x,e.y),I.fillText(t,e.x,e.y),e.y+=s}))}function q(t,e,s=1,n,i,o,r,h){W(t,$(e),s*m,n,i*m,o,r,h)}const O=(t,e=0)=>Z[e]&&1&Z[e][t]?1:0,N=(t,e=0)=>Z[e]&&2&Z[e][t]?1:0,_=O,J=N,Y=(t,e=0)=>Z[e]&&4&Z[e][t]?1:0;let j=l(),K=l(),V=0,X=0;const Q=(t,e=0)=>O(t,e+1);let Z=[[]];function tt(){document.hasFocus()||(Z=[[]]),j=D(K),function(){0;if(!navigator.getGamepads||!document.hasFocus())return;const t=navigator.getGamepads();for(let e=t.length;e--;){const s=t[e],n=Z[e+1]||(Z[e+1]=[]),i=it[e]||(it[e]=[]);if(s){const t=.3,o=.8,h=e=>e>t?r(e,t,o):e<-t?-r(-e,t,o):0;for(let t=0;t<s.axes.length-1;t+=2)i[t>>1]=l(h(s.axes[t]),h(-s.axes[t+1])).clampLength();for(let t=s.buttons.length;t--;){const i=s.buttons[t];n[t]=i.pressed?1+2*!Q(t,e):4*Q(t,e),X|=!e&&i.pressed}{const t=l(Q(15,e)-Q(14,e),Q(12,e)-Q(13,e));t.lengthSquared()&&(i[0]=t.clampLength())}}}}()}function et(){for(const t of Z)for(const e in t)t[e]&=1;V=0}onkeydown=t=>{t.repeat||(Z[X=0][st(t.keyCode)]=3)},onkeyup=t=>{Z[0][st(t.keyCode)]=4};const st=t=>87==t?38:83==t?40:65==t?37:68==t?39:t;onmousedown=t=>{Z[X=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=t=>Z[0][t.button]=2&Z[0][t.button]|4,onmousemove=t=>K=nt(t),onwheel=t=>t.ctrlKey||(V=i(t.deltaY)),oncontextmenu=t=>!1;const nt=t=>{if(!F)return l();const e=F.getBoundingClientRect();return l(F.width,F.height).multiply(l(r(t.x,e.left,e.right),r(t.y,e.top,e.bottom)))},it=[];const ot=void 0!==window.ontouchstart;if(ot){let t,e;ontouchstart=ontouchmove=ontouchend=s=>{s.button=0;const n=s.touches.length;return n?(e||ht(0,e=1),s.x=s.touches[0].clientX,s.y=s.touches[0].clientY,t?onmousemove(s):onmousedown(s)):t&&onmouseup(s),t=n,!s.cancelable}}let rt;new class{constructor(t){this.time=null==t?void 0:M+t,this.setTime=t}set(t=0){this.time=M+t,this.setTime=t}unset(){this.time=void 0}isSet(){return null!=this.time}active(){return M<=this.time}elapsed(){return M>this.time}get(){return this.isSet()?M-this.time:0}getPercent(){return this.isSet()?r(this.time-M,this.setTime,0):0}toString(){0}},l();const ht=(...t)=>function(t,e=1,s=1,n=0,i=0){if(rt||(rt=new(window.AudioContext||webkitAudioContext)),rt.resume(),"running"!=rt.state)return;const r=rt.createBuffer(t.length,t[0].length,at),h=rt.createBufferSource();t.forEach(((t,e)=>r.getChannelData(e).set(t))),h.buffer=r,h.playbackRate.value=s,h.loop=i;const a=rt.createGain();return a.gain.value=.5*e,a.connect(rt.destination),(window.StereoPannerNode?h.connect(new StereoPannerNode(rt,{pan:o(n,-1,1)})):h).connect(a),h.start(),h}([lt(...t)]),at=44100;function lt(o=1,r=.05,a=220,l=0,c=0,u=.1,d=0,y=1,f=0,p=0,g=0,m=0,x=0,w=0,b=0,v=0,S=0,C=1,M=0,T=0){let z,P,B=2*t,R=f*=500*B/at/at,A=[],F=a*=(1+r*h(-1,1))*B/at,k=0,E=0,I=0,L=1,D=0,$=0,G=0;for(p*=500*B/at**3,b*=B/at,g*=B/at,m*=at,x=x*at|0,P=(l=l*at+9)+(M*=at)+(c*=at)+(u*=at)+(S*=at)|0;I<P;A[I++]=G)++$%(100*v|0)||(G=d?d>1?d>2?d>3?Math.sin((k%B)**3):n(s(Math.tan(k),1),-1):1-(2*k/B%2+2)%2:1-4*e(Math.round(k/B)-k/B):Math.sin(k),G=(x?1-T+T*Math.sin(B*I/x):1)*i(G)*e(G)**y*o*.5*(I<l?I/l:I<l+M?1-(I-l)/M*(1-C):I<l+M+c?C:I<P-S?(P-I-S)/u*C:0),G=S?G/2+(S>I?0:(I<P-S?1:(P-I)/S)*A[I-S|0]/2):G),z=(a+=f+=p)*Math.cos(b*E++),k+=z-z*w*(1-1e9*(Math.sin(I)+1)%2),L&&++L>m&&(a+=g,F+=g,L=0),!x||++D%x||(a=F,f=R,L=L||1);return A}l();let ct,ut,dt,yt,ft,pt,gt,mt,xt,wt,bt,vt=[];function St(t,e){const s=dt.createShader(e);return dt.shaderSource(s,t),dt.compileShader(s),s}function Ct(){if(!xt)return;const t=wt?Tt:Bt;dt.blendFuncSeparate(Pt,t,Tt,t),dt.enable(Rt),dt.bufferSubData(Wt,0,gt.subarray(0,xt*_t*Jt)),dt.drawArrays(zt,0,xt*_t),xt=0,wt=bt}function Mt(t,e,s,n,i,o,r,h,a,l=4294967295,c=0){xt!=Yt&&wt==bt||Ct();const u=Math.cos(i)/2,d=Math.sin(i)/2,y=u*s,f=u*n,p=d*s,g=d*n;let m=xt++*_t*Jt;gt[m++]=t-y-g,gt[m++]=e-f+p,gt[m++]=o,gt[m++]=a,mt[m++]=l,mt[m++]=c,gt[m++]=t+y+g,gt[m++]=e+f-p,gt[m++]=h,gt[m++]=r,mt[m++]=l,mt[m++]=c,gt[m++]=t-y+g,gt[m++]=e+f+p,gt[m++]=o,gt[m++]=r,mt[m++]=l,mt[m++]=c,gt[m++]=t-y-g,gt[m++]=e-f+p,gt[m++]=o,gt[m++]=a,mt[m++]=l,mt[m++]=c,gt[m++]=t+y-g,gt[m++]=e-f-p,gt[m++]=h,gt[m++]=a,mt[m++]=l,mt[m++]=c,gt[m++]=t+y+g,gt[m++]=e+f-p,gt[m++]=h,gt[m++]=r,mt[m++]=l,mt[m++]=c}const Tt=1,zt=4,Pt=770,Bt=771,Rt=3042,At=3553,Ft=5121,kt=5126,Et=6408,It=9728,Lt=10240,Dt=10241,$t=10242,Gt=10243,Ut=16384,Ht=33071,Wt=34962,qt=35048,Ot=35632,Nt=35633,_t=6,Jt=6,Yt=65536,jt=24,Kt=0,Vt=1,Xt=2,Qt=3,Zt=4,te=5,ee=0,se=1,ne=2,ie=[[0,1],[1,0],[0,-1],[-1,0]],oe=0,re=1,he=2,ae=3,le=4;class ce{constructor(){this.buttons=[],this.pressedButton=null}addBtn(t){this.buttons.push(t)}removeBtn(t){const e=this.buttons.indexOf(t);e>-1&&this.buttons.splice(e,1)}pressed(){this.pressedButton=null;for(let t=this.buttons.length-1;t>=0&&!this.pressedButton;t--){const e=this.buttons[t];e.containsMousePos()&&(this.pressedButton=e)}return!!this.pressedButton}released(){return!!this.pressedButton&&(this.pressedButton.containsMousePos()&&this.pressedButton.pressed(),this.pressedButton=null,!0)}render(){this.buttons.forEach((t=>t.render()))}}class ue{constructor(t,e,s,n,i,o,r,h=!0){this.pos=t,this.size=e,this.text=s,this.textSize=n,this.bgColor=i,this.textColor=o,this.onPressed=r||(()=>{}),this.screenSpace=h}containsMousePos(){const t=this.screenSpace?K:j;return t.x>=this.pos.x-this.size.x/2&&t.y>=this.pos.y-this.size.y/2&&t.x<this.pos.x+this.size.x/2&&t.y<this.pos.y+this.size.y/2}pressed(){this.onPressed()}render(){let t,e;this.screenSpace?(t=H,e=W):(t=U,e=q),t(this.pos,this.size,this.bgColor),e(this.text,this.pos,this.textSize,this.textColor)}}const de=new class{constructor(){this.controllerMap=null,this.gameState=oe}init(t){this.controllerMap=t}setGameState(t,e){this.gameState=t,this.curController=this.controllerMap[t],this.curController.init(e)}gameUpdate(){this.curController.gameUpdate()}gameRender(){this.curController.gameRender()}},ye=l(0,4),fe=new u(1,0,0),pe=new u(1,1,1),ge=new ue(l(0,-2),l(4,2.5),"Start",1.5,new u(1,1,1),new u(0,0,0),(()=>{de.setGameState(he)}),!1),me=new ce;me.addBtn(ge);const xe={init(){},gameUpdate(){J(0)&&me.pressed(),Y(0)&&me.released()},gameRender(){q("Death Estate",ye,5,fe,h(1,1.2),pe),me.render()}},we=[null,null,new u(.6,.6,.6),new u(.5,.5,.5),new u(.8,.3,.3),new u(1,0,0)],be=[new u(.3,.3,.3),new u(.35,.35,.35)];class ve{constructor(t,e,s){this.x=e,this.y=s,this.type=t||0}copy(){return new ve(this.type,this.x,this.y)}apply(t){this.type=t.type}}class Se{constructor(t,e){this.pos=l(),this.tiles=[],this.size=l(t,e);const s=this.size.x*this.size.y;for(let t=0;t<s;t+=1)this.tiles.push(new ve(0,t%this.size.x,Math.floor(t/this.size.y)));this.allRoadsConnected=!1,this.houses=[],this.snapshotTiles=[];for(const t of this.tiles)this.snapshotTiles.push(t.copy())}createSnapshot(){this.tiles.forEach(((t,e)=>this.snapshotTiles[e].apply(t)))}houseCanFit(t){const e=t.getWorldBounds(),s=this.getWorldBounds();if(!(e[0].x>=s[0].x&&e[0].y>=s[0].y&&e[1].x<=s[1].x&&e[1].y<=s[1].y))return!1;const n=t.pos.divide(l(2)),i=t.tiles;for(let t=0;t<i.length;t+=1){const e=i[t];for(let s=0;s<e.length;s+=1){if(!e[s])continue;const i=n.add(l(s,t));if(this.getTile(i.x,i.y).type)return!1}}return!0}houseIsTouchingRoad(t){const e=t.pos.divide(l(2)),s=t.tiles;for(let t=0;t<s.length;t+=1){const n=s[t];for(let s=0;s<n.length;s+=1){if(!n[s])continue;const i=e.add(l(s,t));if(ie.map((t=>this.getTile(i.x+t[0],i.y+t[1]))).filter((t=>t)).some((t=>t.type===Xt)))return!0}}return!1}addHouse(t){t.state=se,this.houses.push(t);const e=t.pos.divide(l(2)),s=t.tiles;for(let t=0;t<s.length;t+=1){const n=s[t];for(let s=0;s<n.length;s+=1){if(!n[s])continue;const i=e.add(l(s,t));this.setTile(i.x,i.y,Vt)}}}getWorldSize(){return this.size.multiply(l(2))}getWorldBounds(){return[this.pos.copy(),this.pos.add(this.size.multiply(l(2)))]}setTile(t,e,s){this.tiles[t+e*this.size.x].type=s}getTile(t,e){return this.tiles[t+e*this.size.x]}getTileFromMousePos(){const t=this.getCoordsFromMousePos();return t?this.getTile(t.x,t.y):null}getCoordsFromMousePos(t=!1){return this.getCoordsFromPos(j,t)}getCoordsFromPos(t,e=!1){const s=t.subtract(this.pos).add(l(1));if(!e){if(s.x<0)return null;if(s.x>=2*this.size.x)return null;if(s.y<0)return null;if(s.y>=2*this.size.y)return null}return s.divide(l(2)).floor()}setTileLine(t,e,s){const n=[];if(Math.abs(e.x-t.x)<Math.abs(e.y-t.y)){const s=Math.max(Math.min(e.y,t.y),0),i=Math.min(Math.max(e.y,t.y),this.size.y-1);for(let e=s;e<=i;e+=1)n.push(this.getTile(t.x,e))}else{const s=Math.max(Math.min(e.x,t.x),0),i=Math.min(Math.max(e.x,t.x),this.size.x-1);for(let e=s;e<=i;e+=1)n.push(this.getTile(e,t.y))}for(const t of n)t.type=s;return n}resetToSnapshot(){this.tiles.forEach(((t,e)=>t.apply(this.snapshotTiles[e])))}checkRoadConnection(){const t=this.tiles.filter((t=>t.type===Xt||t.type===te));t.forEach((t=>t.type=te));const e=t.filter((t=>0===t.x||0===t.y||t.x===this.size.x-1||t.y===this.size.y-1));e.length?(e.forEach((t=>this.setConnectedRoads(t.x,t.y))),this.allRoadsConnected=t.every((t=>t.type===Xt))):this.allRoadsConnected=!1}setConnectedRoads(t,e){const s=this.getTile(t,e);if(s&&s.type===te){s.type=Xt;for(const s of ie)this.setConnectedRoads(t+s[0],e+s[1])}}getCounts(){const t=this.size.x*this.size.y;let e=0,s=0;for(const t of this.tiles)t.type===Vt?e+=1:t.type===Xt&&(s+=1);return{totalCount:t,houseTileCount:e,roadCount:s}}render(){for(let t=0;t<this.size.y;t+=1)for(let e=0;e<this.size.x;e+=1){const s=l(e,t).multiply(l(2)).add(this.pos),n=this.getTile(e,t),i=we[n.type]||be[(e+t)%2];i&&U(s,l(2),i)}for(const t of this.houses)t.render()}}const Ce=[new u,new u(.9,.9,.9),new u(1,.3,.3)];class Me{constructor(t,e){this.pos=l(t,e),this.tiles=function(t){const e=2*t-1,s=a(1,e**2+1),n=[],i=[];for(let t=0;t<e;t++)n.push(new Array(e).fill(Kt));for(let t=0;t<s;t++){let s,o;if(0===t)s=a(0,e),o=a(0,e),i.push([s,o]);else{const t=i[a(0,i.length)],r=ie.map((s=>{let i=[t[0]+s[0],t[1]+s[1]];return i[0]<0||i[0]>=e||i[1]<0||i[1]>=e||n[i[1]][i[0]]!==Kt?null:i})).filter((t=>t));if(!r.length)continue;const h=r[a(0,r.length)];[s,o]=h,i.push(h)}n[o][s]=Vt}for(let t=n.length-1;t>=0;t--)n[t].every((t=>t===Kt))&&n.splice(t,1);for(let t=e-1;t>=0;t--)n.map((e=>e[t])).every((t=>t===Kt))&&n.forEach((e=>e.splice(t,1)));return n}(2),this.state=ee}getWorldBounds(){const t=2*this.tiles[0].length,e=2*this.tiles.length;return[this.pos.copy(),this.pos.add(l(t,e))]}isClicked(){const t=j.subtract(this.pos).add(l(1)).divide(l(2)).floor(),e=this.tiles[t.y];return!!e&&!!e[t.x]}rotate(t){const e=this.tiles.length,s=this.tiles[0].length,n=new Array(s);for(let t=0;t<s;t++)n[t]=new Array(e).fill(Kt);for(let t=0;t<e;t++)for(let e=0;e<s;e++)n[e][t]=this.tiles[t][e];1===t?n.reverse():n.forEach((t=>t.reverse())),this.tiles=n}render(){for(let t=0;t<this.tiles.length;t+=1){const e=this.tiles[t];for(let s=0;s<e.length;s+=1){if(!e[s])continue;const n=Ce[this.state]||new u(1,0,0);U(l(s,t).multiply(l(2)).add(this.pos),l(2),n)}}}}let Te,ze,Pe,Be,Re=l(),Ae=l(),Fe=!1,ke=!1,Ee=!1,Ie=null;function Le(){Be=new Me(-8,-8)}const De={init(){Te=new Se(15,15),ke=!1,Fe=!1,Ee=!1,Ie=null;const t=Te.getWorldSize();g.x=Te.pos.x+t.x/2-1,g.y=Te.pos.y+t.y/2-1},gameUpdate(){if(J(0)&&(Ie=Te.getCoordsFromMousePos(),Ie)){Te.createSnapshot();const t=Te.getTileFromMousePos();ze=t.type===Xt||t.type===te?Zt:Qt}if(_(0)&&Ie){Te.resetToSnapshot();const t=Te.getCoordsFromMousePos(!0);Te.setTileLine(Ie,t,ze)}if(Y(0)&&Ie){Te.resetToSnapshot();const t=Te.getCoordsFromMousePos(!0);ze===Qt?Te.setTileLine(Ie,t,Xt):Te.setTileLine(Ie,t,Kt),Te.checkRoadConnection()}Y(2)&&Te.allRoadsConnected&&de.setGameState(ae)},gameRender(){Te.render(),W("Place roads",l(15,15),20,new u(1,1,1),void 0,void 0,"left")}},$e={init(){Pe=3,Le()},gameUpdate(){if(_(2)?Ee=!0:Ee&&(Ee=!1,Be.rotate(1)),N(40)&&Pe>0&&(Le(),Pe-=1),N(69)){const t=Te.getCounts();de.setGameState(le,{timestamp:Date.now(),totalMaxScore:t.totalCount,score:t.houseTileCount,roadCount:t.roadCount})}_(0)?(ke||(ke=!0,Be.isClicked()&&(Be.state=ee,Re=Be.pos.copy(),Ae=j.copy(),Fe=!0)),Fe&&(Be.pos.x=Re.x+(j.x-Ae.x),Be.pos.y=Re.y+(j.y-Ae.y))):ke&&(ke=!1,Fe&&(Be.pos.x=2*Math.floor((Be.pos.x+1)/2),Be.pos.y=2*Math.floor((Be.pos.y+1)/2),Te.houseCanFit(Be)&&Te.houseIsTouchingRoad(Be)?(Te.addHouse(Be),Le()):Be.state=ne,Fe=!1))},gameRender(){Te.render(),Be.render(),W(`Skips left: ${Pe}`,l(15,15),20,new u(1,1,1),void 0,void 0,"left")}},Ge=new u(1,0,0),Ue=new u(1,1,1),He=new u(1,1,1),We=new u(1,1,0),qe="deathestate_jayther_ldb",Oe={};let Ne,_e=[],Je=0,Ye=0,je=!0;const Ke=l(0,18),Ve=Ke.add(l(0,-5)),Xe=Ke.add(l(0,-13)),Qe=Xe.add(l(3,-5)),Ze=new Array(5);for(let t=0;t<Ze.length;t++)Ze[t]=[Qe.add(l(-.7,-2*t)),Qe.add(l(.7,-2*t))];const ts=new ce,es=new ue(Ke.add(l(0,-31)),l(5,3),"Retry",1.5,new u(1,1,1),new u(0,0,0),(()=>{de.setGameState(he)}),!1);function ss(t,e){for(Ne={score:t,timestamp:e,dateStr:new Date(e).toLocaleDateString(),current:!0},_e.push(Ne),_e.sort(((t,e)=>{const s=e.score-t.score;return 0===s?e.timestamp-t.timestamp:s}));_e.length>5;)_e.pop();!function(){const t=_e.map((t=>({score:t.score,timestamp:t.timestamp}))),e=JSON.stringify(t);if(je)try{window.localStorage.setItem(qe,e)}catch(t){je=!1}je||(Oe[qe]=e)}()}ts.addBtn(es);const ns=[{init(){},gameUpdate(){},gameRender(){}},xe,De,$e,{init(t){Je=t.totalMaxScore,Ye=t.roadCount,function(){let t=null;if(je)try{t=window.localStorage.getItem(qe)}catch(t){je=!1}else t=Oe[qe]||null;t&&(_e=JSON.parse(t)),_e.forEach((t=>t.dateStr=new Date(t.timestamp).toLocaleDateString()))}(),ss(t.score,t.timestamp),g.x=0,g.y=0},gameUpdate(){J(0)&&ts.pressed(),Y(0)&&ts.released()},gameRender(){!function(){q("Game over",Ke,4,Ge,.5,Ue),q(`You covered ${Ne.score} tiles (${Math.floor(Ne.score/Je*100)}%)\n(road count: ${Ye}, grid total: ${Je})`,Ve,2,He),q("High Scores",Xe,4,Ge,.5,Ue);for(let t=0;t<5;t++){const e=_e[t];let s,n,i;e?(s=e.dateStr,n=e.score.toString(),i=e.current?We:He):(s="-------------",n="---",i=He),q(s,Ze[t][0],2,i,void 0,void 0,"right"),q(n,Ze[t][1],2,i,void 0,void 0,"left")}}(),ts.render()}}];!function(t,e,n,i,o,r){A.onerror=A.onload=()=>{b=l(p).divide(w=l(A.width,A.height)),document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-moz-user-select:none",document.body.appendChild(F=document.createElement("canvas")),k=F.getContext("2d"),F.style=B,function(){0;ut=document.createElement("canvas"),dt=ut.getContext("webgl",{antialias:!1}),ut.style=B,yt=function(t){if(!t||!t.width)return;const e=dt.createTexture();return dt.bindTexture(At,e),dt.texImage2D(At,0,Et,Et,Ft,t),dt.texParameteri(At,Dt,It),dt.texParameteri(At,Lt,It),dt.texParameteri(At,$t,Ht),dt.texParameteri(At,Gt,Ht),e}(A),document.body.appendChild(ut),pt=function(t,e){0;const s=dt.createProgram();dt.attachShader(s,St(t,Nt)),dt.attachShader(s,St(e,Ot)),dt.linkProgram(s),0;return s}("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}","precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}");const t=new ArrayBuffer(Yt*_t*jt);(function(t,e,s){0;const n=dt.createBuffer();dt.bindBuffer(t,n),dt.bufferData(t,e,s)})(Wt,t.byteLength,qt),gt=new Float32Array(t),mt=new Uint32Array(t);let e=xt=0;const s=(t,s,n,i,o=0)=>{const r=dt.getAttribLocation(pt,t);dt.enableVertexAttribArray(r),dt.vertexAttribPointer(r,i,s,o,jt,e),e+=i*n};s("p",kt,4,2),s("t",kt,4,2),s("c",Ft,1,4,1),s("a",Ft,1,4,1)}(),document.body.appendChild(E=document.createElement("canvas")),I=E.getContext("2d"),E.style=B,t(),h()};const h=(t=0)=>{let r=t-z;if(z=t,T+=r/1e3,P=s(P+!0*r,50),y.x){E.width=F.width=y.x,E.height=F.height=y.y;const t=innerWidth/innerHeight,e=F.width/F.height;F.style.width=E.style.width=t<e?"100%":"",F.style.height=E.style.height=t<e?"":"100%",ut&&(ut.style.width=F.style.width,ut.style.height=F.style.height)}else E.width=F.width=s(innerWidth,d.x),E.height=F.height=s(innerHeight,d.y);L=l(F.width,F.height);{let t=0;for(P<0&&P>-9&&(t=P,P=0);P>=0;P-=1e3/60)tt(),e(),R(),n(),et();P+=t}L=l(F.width,F.height),k.imageSmoothingEnabled=!1,function(t,e,s,n,i){var o;dt.viewport(0,0,ut.width=t,ut.height=e),dt.clear(Ut),dt.bindTexture(At,ft=yt),dt.useProgram(pt),bt=o;const r=2*i/t,h=2*i/e;dt.uniformMatrix4fv(dt.getUniformLocation(pt,"m"),0,new Float32Array([r,0,0,0,0,h,0,0,1,1,-1,1,-1-r*s,-1-h*n,0,0]))}(F.width,F.height,g.x,g.y,m),i(),v.sort(((t,e)=>t.renderOrder-e.renderOrder));for(const t of v)t.destroyed||t.render();o(),function(){if(!vt.length)return;const t=vt[0],e=T-ct;if(ct)if(e>5)vt.shift(ct=0);else{const s=4.5,n=e<x?1-e/x:e>s?(e-s)/x:0;t.render(n)}else ct=T}(),function(t,e){if(!xt&&!e)return;Ct(),e&&t.drawImage(ut,0,0)}(k),requestAnimationFrame(h)};r?A.src=r:A.onload()}((function(){de.init(ns),de.setGameState(re)}),(function(){de.gameUpdate()}),(function(){}),(function(){de.gameRender()}),(function(){}))}();
      </script>
  </body>
</html>
