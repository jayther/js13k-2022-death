<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Death Estate</title>
      <style>
        a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:'';content:none}table{border-collapse:collapse;border-spacing:0}
      </style>
  </head>
  <body>
      <script>
        !function(){"use strict";let t,e,s=1,i=0,n=[],o=0,r=0,l=0,a=0;const h=(...t)=>console.assert(...t),c=(t,e=P(),s="#fff",i=0,o=0,r=0)=>{h("string"==typeof s),n.push({pos:t,size:P(e),color:s,time:new A(i),angle:o,fill:r})},u=(t,e=0,s="#fff",i=0,o=0)=>{h("string"==typeof s),n.push({pos:t,size:e,color:s,time:new A(i),angle:0,fill:o})},f=(t,e,s,i)=>c(t,0,e,s,i),d=(t,e,s,i=.1,n)=>{const o=P((e.x-t.x)/2,(e.y-t.y)/2),r=P(i,2*o.length());c(t.add(o),r,s,n,o.angle(),1)},y=(t,e,s=1,i="#fff",o=0,r=0,l="monospace")=>{h("string"==typeof i),n.push({text:t,pos:e,size:s,color:i,time:new A(o),angle:r,font:l})},g=()=>{X(192)&&(o=!o),o&&(X(48)&&(s=!s),X(49)&&(r=!r,l=0),X(50)&&(l=!l,r=0),X(51)&&(a=!a),X(52)&&(i=!i),X(53)&&(t=1))},x=()=>{var s;if(It(q),t&&(It(q,1),q.drawImage($,0,0),$.width|=0,s=H,e.download="screenshot.png",e.href=s.toDataURL("image/png").replace("image/png","image/octet-stream"),e.click(),t=0),a&&G&&navigator.getGamepads){const t=navigator.getGamepads();for(let e=t.length;e--;){const s=t[e];if(s){const t=1,i=.2,n=E,o=ut[e];for(let s=o.length;s--;){const i=n.add(P(s*t*2,e*t*3)),r=i.add(o[s].scale(t));u(i,t,"#fff7",0,1),d(i,r,"#f00"),f(r,"#f00")}for(let o=s.buttons.length;o--;){const r=n.add(P(o*i*2,e*t*3-t-i)),l=s.buttons[o].pressed;u(r,i,l?"#f00":"#fff7",0,1),y(o,r,.2)}}}}if(o){let t,e=1/0;for(const s of ge){if(s.canvas||s.destroyed)continue;const i=s.size.copy();if(!i.x||!i.y)continue;const n=et.distanceSquared(s.pos);n<e&&(e=n,t=s);const o=new k(s.collideTiles?1:0,s.collideSolidObjects?1:0,s.isSolid?1:0,s.parent?.2:.5);i.x=b(i.x,.2),i.y=b(i.y,.2),N(s.pos,i,o),N(s.pos,i.scale(.8),s.parent?new k(1,1,1,.5):new k(0,0,0,.8)),s.parent&&Y(s.pos,s.parent.pos,.1,new k(0,0,1,.5))}if(t){const e=q;q=O;const s=function(t,e,s){t=t.floor();const i=(e=e.floor()).subtract(t),n=m(i.x),o=-m(i.y),r=v(i.x),l=v(i.y);let a=n+o;for(let i=t.x,h=t.y;;){const t=wt(P(i,h));if(t&&(s?s.collideWithTileRaycast(t,new R(i,h)):t>0))return new R(i+.5,h+.5);if(i==e.x&h==e.y)break;const c=2*a;c>=o&&(a+=o,i+=r),c<=n&&(a+=n,h+=l)}}(t.pos,et);s&&N(s.floor().add(P(.5)),P(1),new k(0,1,1,.3)),N(et.floor().add(P(.5)),P(1),new k(0,0,1,.5)),Y(et,t.pos,.1,s?new k(1,0,0,.5):new k(0,1,0,.5));_("mouse pos = "+et+"\nmouse collision = "+wt(et)+"\n\n--- object info ---\n"+t.toString(),st,24,new k,.05,void 0,void 0,"monospace"),q=e}It(q)}{O.lineWidth=2;const t=.5*I;n.forEach((e=>{O.save();const s=J(e.pos);if(O.translate(0|s.x,0|s.y),O.rotate(e.angle),O.fillStyle=O.strokeStyle=e.color,null!=e.text)O.font=e.size*I+"px "+e.font,O.textAlign="center",O.textBaseline="middle",O.fillText(e.text,0,0);else if(0==e.size||0===e.size.x&&0===e.size.y)O.fillRect(-t/2,-1,t,3),O.fillRect(-1,-t/2,3,t);else if(null!=e.size.x){const t=e.size.x*I|0,s=e.size.y*I|0;e.fill&&O.fillRect(-t/2|0,-s/2|0,t,s),O.strokeRect(-t/2|0,-s/2|0,t,s)}else O.beginPath(),O.arc(0,0,e.size*I,0,9),e.fill&&O.fill(),O.stroke();O.restore()})),n=n.filter((t=>t.time.get()<0))}{O.save(),O.fillStyle="#fff",O.textAlign="left",O.textBaseline="top",O.font="28px monospace",O.shadowColor="#000",O.shadowBlur=9;let t=9,e=-20,s=30;if(o){O.fillText(ce,t,e+=s),O.fillText("Objects: "+ge.length,t,e+=s),O.fillText("Time: "+M(me),t,e+=s),O.fillText("---------",t,e+=s),O.fillStyle="#f00",O.fillText("~: Debug Overlay",t,e+=s),O.fillStyle=r?"#f00":"#fff",O.fillText("1: Debug Physics",t,e+=s),O.fillStyle=l?"#f00":"#fff",O.fillText("2: Debug Particles",t,e+=s),O.fillStyle=a?"#f00":"#fff",O.fillText("3: Debug Gamepads",t,e+=s),O.fillStyle=i?"#f00":"#fff",O.fillText("4: God Mode",t,e+=s),O.fillStyle="#fff",O.fillText("5: Save Screenshot",t,e+=s);let n="";for(const t in rt[0])t&&V(t,0)&&(n+=t+" ");n&&O.fillText("Keys Down: "+n,t,e+=s);let o="";if(rt[1])for(const t in rt[1])t&&V(t,1)&&(o+=t+" ");o&&O.fillText("Gamepad: "+o,t,e+=s)}else O.fillText(r?"Debug Physics":"",t,e+=s),O.fillText(l?"Debug Particles":"",t,e+=s),O.fillText(i?"God Mode":"",t,e+=s),O.fillText(a?"Debug Gamepads":"",t,e+=s);O.restore()}},p=Math.PI,m=t=>t<0?-t:t,w=(t,e)=>t<e?t:e,b=(t,e)=>t>e?t:e,v=t=>t<0?-1:1,S=(t,e=0,s=1)=>t<e?e:t>s?s:t,T=(t,e=0,s=1)=>s-e?S((t-e)/(s-e)):0,M=t=>(t/60|0)+":"+(t%60<10?"0":"")+(t%60|0),C=(t=1,e=0)=>e+(t-e)*Math.random(),z=(t=1,e=0)=>0|C(t,e),P=(t=0,e)=>null==t.x?new R(t,null==e?t:e):new R(t.x,t.y);class R{constructor(t=0,e=0){this.x=t,this.y=e}copy(){return new R(this.x,this.y)}add(t){return h(null!=t.x),new R(this.x+t.x,this.y+t.y)}subtract(t){return h(null!=t.x),new R(this.x-t.x,this.y-t.y)}multiply(t){return h(null!=t.x),new R(this.x*t.x,this.y*t.y)}divide(t){return h(null!=t.x),new R(this.x/t.x,this.y/t.y)}scale(t){return h(null==t.x),new R(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const e=this.length();return e?this.scale(t/e):new R(0,t)}clampLength(t=1){const e=this.length();return e>t?this.scale(t/e):this}dot(t){return h(null!=t.x),this.x*t.x+this.y*t.y}cross(t){return h(null!=t.x),this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,e=1){return this.x=e*Math.sin(t),this.y=e*Math.cos(t),this}rotate(t){const e=Math.cos(t),s=Math.sin(t);return new R(this.x*e-this.y*s,this.x*s+this.y*e)}direction(){return m(this.x)>m(this.y)?this.x<0?3:1:this.y<0?2:0}invert(){return new R(this.y,-this.x)}floor(){return new R(Math.floor(this.x),Math.floor(this.y))}area(){return m(this.x*this.y)}lerp(t,e){return h(null!=t.x),this.add(t.subtract(this).scale(S(e)))}arrayCheck(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}class k{constructor(t=1,e=1,s=1,i=1){this.r=t,this.g=e,this.b=s,this.a=i}copy(){return new k(this.r,this.g,this.b,this.a)}add(t){return new k(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new k(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new k(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new k(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,e=t){return new k(this.r*t,this.g*t,this.b*t,this.a*e)}clamp(){return new k(S(this.r),S(this.g),S(this.b),S(this.a))}lerp(t,e){return this.add(t.subtract(this).scale(S(e)))}setHSLA(t=0,e=0,s=1,i=1){const n=s<.5?s*(1+e):s+e-s*e,o=2*s-n,r=(t,e,s)=>(s=(s%1+1)%1)<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t;return this.r=r(o,n,t+1/3),this.g=r(o,n,t),this.b=r(o,n,t-1/3),this.a=i,this}getHSLA(){const t=this.r,e=this.g,s=this.b,i=this.a,n=Math.max(t,e,s),o=Math.min(t,e,s),r=(n+o)/2;let l=0,a=0;if(n!=o){let i=n-o;a=r>.5?i/(2-n-o):i/(n+o),t==n?l=(e-s)/i+(e<s?6:0):e==n?l=(s-t)/i+2:s==n&&(l=(t-e)/i+4)}return[l/6,a,r,i]}mutate(t=.05,e=0){return new k(this.r+C(t,-t),this.g+C(t,-t),this.b+C(t,-t),this.a+C(e,-e)).clamp()}toString(){return h(this.r>=0&&this.r<=1&&this.g>=0&&this.g<=1&&this.b>=0&&this.b<=1&&this.a>=0&&this.a<=1),`rgb(${255*this.r|0},${255*this.g|0},${255*this.b|0},${this.a})`}rgbaInt(){return h(this.r>=0&&this.r<=1&&this.g>=0&&this.g<=1&&this.b>=0&&this.b<=1&&this.a>=0&&this.a<=1),(255*this.r|0)+(255*this.g<<8)+(255*this.b<<16)+(255*this.a<<24)}setHex(t){const e=e=>parseInt(t.slice(e,e+2),16)/255;return this.r=e(1),this.g=e(3),this.b=e(5),this.a=1,h(this.r>=0&&this.r<=1&&this.g>=0&&this.g<=1&&this.b>=0&&this.b<=1),this}getHex(){const t=t=>((t=255*t|0)<16?"0":"")+t.toString(16);return"#"+t(this.r)+t(this.g)+t(this.b)}}class A{constructor(t){this.time=null==t?void 0:me+t,this.setTime=t}set(t=0){this.time=me+t,this.setTime=t}unset(){this.time=void 0}isSet(){return null!=this.time}active(){return me<=this.time}elapsed(){return me>this.time}get(){return this.isSet()?me-this.time:0}getPercent(){return this.isSet()?T(this.time-me,this.setTime,0):0}toString(){return this.unset()?"unset":Math.abs(this.get())+" seconds "+(this.get()<0?"before":"after")}}let F=P(1920,1200),L=P(),D=P(16),B=.3,E=(P(1),P()),I=b(D.x,D.y),G=1,W=.5;const U=new Image;let H,q,$,O,j=P();const J=t=>(h(j.x&&j.y,"mainCanvasSize is invalid"),t.subtract(E).multiply(P(I,-I)).add(j.scale(.5)).subtract(P(.5)));function K(t,e=P(1),i=-1,n=D,o=new k,r=0,l,a=new k(0,0,0,0),h=1){if(s&&++ye,h)if(i<0||!U.width)Gt(t.x,t.y,e.x,e.y,r,0,0,0,0,0,o.rgbaInt());else{const s=ue.x/n.x|0,h=n.x/ue.x,c=n.y/ue.y,u=i%s*h,f=(i/s|0)*c;Gt(t.x,t.y,l?-e.x:e.x,e.y,r,u+fe.x,f+fe.y,u-fe.x+h,f-fe.y+c,o.rgbaInt(),a.rgbaInt())}else!function(t,e,s,i,n,o=q){t=J(t),e=e.scale(I),o.save(),o.translate(t.x+.5|0,t.y-.5|0),o.rotate(s),o.scale(i?-e.x:e.x,e.y),n(o),o.restore()}(t,e,r,l,(t=>{if(i<0)t.fillStyle=o,t.fillRect(-.5,-.5,1,1);else{const e=ue.x/n.x|0,s=i%e*n.x+B,r=(i/e|0)*n.y+B,l=n.x-.6,a=n.y-.6;t.globalAlpha=o.a,t.drawImage(U,s,r,l,a,-.5,-.5,1,1)}}))}function N(t,e,s,i,n){K(t,e,-1,D,s,i,0,0,n)}function Y(t,e,s=.1,i,n){const o=P((e.x-t.x)/2,(e.y-t.y)/2),r=P(s,2*o.length());N(t.add(o),r,i,o.angle(),0)}function _(t,e,s=1,i=new k,n=0,o=new k(0,0,0),r="center",l="arial"){O.fillStyle=i,O.lineWidth=n,O.strokeStyle=o,O.textAlign=r,O.font=s+"px "+l,O.textBaseline="middle",O.lineJoin="round",e=e.copy(),(t+"").split("\n").forEach((t=>{n&&O.strokeText(t,e.x,e.y),O.fillText(t,e.x,e.y),e.y+=s}))}const V=(t,e=0)=>rt[e]&&1&rt[e][t]?1:0,X=(t,e=0)=>rt[e]&&2&rt[e][t]?1:0,Q=V,Z=X,tt=(t,e=0)=>rt[e]&&4&rt[e][t]?1:0;let et=P(),st=P(),it=0,nt=0;const ot=(t,e=0)=>V(t,e+1);let rt=[[]];function lt(){var t;document.hasFocus()||(rt=[[]]),t=st,h(j.x&&j.y,"mainCanvasSize is invalid"),et=t.add(P(.5)).subtract(j.scale(.5)).multiply(P(1/I,-1/I)).add(E),function(){0;if(!G||!navigator.getGamepads||(document.hasFocus(),0))return;const t=navigator.getGamepads();for(let e=t.length;e--;){const s=t[e],i=rt[e+1]||(rt[e+1]=[]),n=ut[e]||(ut[e]=[]);if(s){const t=.3,o=.8,r=e=>e>t?T(e,t,o):e<-t?-T(-e,t,o):0;for(let t=0;t<s.axes.length-1;t+=2)n[t>>1]=P(r(s.axes[t]),r(-s.axes[t+1])).clampLength();for(let t=s.buttons.length;t--;){const n=s.buttons[t];i[t]=n.pressed?1+2*!ot(t,e):4*ot(t,e),nt|=!e&&n.pressed}{const t=P(ot(15,e)-ot(14,e),ot(12,e)-ot(13,e));t.lengthSquared()&&(n[0]=t.clampLength())}}}}()}function at(){for(const t of rt)for(const e in t)t[e]&=1;it=0}onkeydown=t=>{t.target==document.body&&(t.repeat||(rt[nt=0][ht(t.keyCode)]=3))},onkeyup=t=>{t.target==document.body&&(rt[0][ht(t.keyCode)]=4)};const ht=t=>87==t?38:83==t?40:65==t?37:68==t?39:t;onmousedown=t=>{rt[nt=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=t=>rt[0][t.button]=2&rt[0][t.button]|4,onmousemove=t=>st=ct(t),onwheel=t=>t.ctrlKey||(it=v(t.deltaY)),oncontextmenu=t=>!1;const ct=t=>{if(!H)return P();const e=H.getBoundingClientRect();return P(H.width,H.height).multiply(P(T(t.x,e.left,e.right),T(t.y,e.top,e.bottom)))},ut=[];const ft=void 0!==window.ontouchstart;if(ft){let t,e;ontouchstart=ontouchmove=ontouchend=s=>{s.button=0;const i=s.touches.length;return i?(e||yt(0,e=1),s.x=s.touches[0].clientX,s.y=s.touches[0].clientY,t?onmousemove(s):onmousedown(s)):t&&onmouseup(s),t=i,!s.cancelable}}let dt;new A,P();const yt=(...t)=>function(t,e=1,s=1,i=0,n=0){if(dt||(dt=new(window.AudioContext||webkitAudioContext)),dt.resume(),"running"!=dt.state)return;const o=dt.createBuffer(t.length,t[0].length,gt),r=dt.createBufferSource();t.forEach(((t,e)=>o.getChannelData(e).set(t))),r.buffer=o,r.playbackRate.value=s,r.loop=n;const l=dt.createGain();return l.gain.value=.5*e,l.connect(dt.destination),(window.StereoPannerNode?r.connect(new StereoPannerNode(dt,{pan:S(i,-1,1)})):r).connect(l),r.start(),r}([xt(...t)]),gt=44100;function xt(t=1,e=.05,s=220,i=0,n=0,o=.1,r=0,l=1,a=0,h=0,c=0,u=0,f=0,d=0,y=0,g=0,x=0,S=1,T=0,M=0){let z,P,R=2*p,k=a*=500*R/gt/gt,A=[],F=s*=(1+e*C(-1,1))*R/gt,L=0,D=0,B=0,E=1,I=0,G=0,W=0;for(h*=500*R/gt**3,y*=R/gt,c*=R/gt,u*=gt,f=f*gt|0,P=(i=i*gt+9)+(T*=gt)+(n*=gt)+(o*=gt)+(x*=gt)|0;B<P;A[B++]=W)++G%(100*g|0)||(W=r?r>1?r>2?r>3?Math.sin((L%R)**3):b(w(Math.tan(L),1),-1):1-(2*L/R%2+2)%2:1-4*m(Math.round(L/R)-L/R):Math.sin(L),W=(f?1-M+M*Math.sin(R*B/f):1)*v(W)*m(W)**l*t*.5*(B<i?B/i:B<i+T?1-(B-i)/T*(1-S):B<i+T+n?S:B<P-x?(P-B-x)/o*S:0),W=x?W/2+(x>B?0:(B<P-x?1:(P-B)/x)*A[B-x|0]/2):W),z=(s+=a+=h)*Math.cos(y*D++),L+=z-z*d*(1-1e9*(Math.sin(B)+1)%2),E&&++E>u&&(s+=c,F+=c,E=0),!f||++I%f||(s=F,a=k,E=E||1);return A}let pt=[],mt=P();const wt=t=>t.arrayCheck(mt)?pt[(0|t.y)*mt.x+t.x|0]:0;let bt,vt,St,Tt,Mt,Ct,zt,Pt,Rt,kt,At,Ft=[];function Lt(){vt=document.createElement("canvas"),St=vt.getContext("webgl",{antialias:!1}),vt.style=Te,Tt=function(t){if(!t||!t.width)return;const e=St.createTexture();return St.bindTexture(Ot,e),St.texImage2D(Ot,0,Kt,Kt,jt,t),St.texParameteri(Ot,_t,Nt),St.texParameteri(Ot,Yt,Nt),St.texParameteri(Ot,Vt,Zt),St.texParameteri(Ot,Xt,Zt),e}(U),document.body.appendChild(vt),Ct=function(t,e){0;const s=St.createProgram();if(St.attachShader(s,Dt(t,ie)),St.attachShader(s,Dt(e,se)),St.linkProgram(s),!St.getProgramParameter(s,oe))throw St.getProgramInfoLog(s);return s}("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}","precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}");const t=new ArrayBuffer(ae*re*he);!function(t,e,s){0;const i=St.createBuffer();St.bindBuffer(t,i),St.bufferData(t,e,s)}(te,t.byteLength,ee),zt=new Float32Array(t),Pt=new Uint32Array(t);let e=Rt=0;const s=(t,s,i,n,o=0)=>{const r=St.getAttribLocation(Ct,t);St.enableVertexAttribArray(r),St.vertexAttribPointer(r,n,s,o,he,e),e+=n*i};s("p",Jt,4,2),s("t",Jt,4,2),s("c",jt,1,4,1),s("a",jt,1,4,1)}function Dt(t,e){const s=St.createShader(e);if(St.shaderSource(s,t),St.compileShader(s),!St.getShaderParameter(s,ne))throw St.getShaderInfoLog(s);return s}function Bt(t,e,s,i,n){var o;St.viewport(0,0,vt.width=t,vt.height=e),St.clear(Qt),St.bindTexture(Ot,Mt=Tt),St.useProgram(Ct),At=o;const r=2*n/t,l=2*n/e;St.uniformMatrix4fv(St.getUniformLocation(Ct,"m"),0,new Float32Array([r,0,0,0,0,l,0,0,1,1,-1,1,-1-r*s,-1-l*i,0,0]))}function Et(){if(!Rt)return;const t=kt?Wt:qt;St.blendFuncSeparate(Ht,t,Wt,t),St.enable($t),St.bufferSubData(te,0,zt.subarray(0,Rt*re*le)),St.drawArrays(Ut,0,Rt*re),Rt=0,kt=At}function It(t,e){(Rt||e)&&(Et(),e&&t.drawImage(vt,0,0))}function Gt(t,e,s,i,n,o,r,l,a,h=4294967295,c=0){Rt!=ae&&kt==At||Et();const u=Math.cos(n)/2,f=Math.sin(n)/2,d=u*s,y=u*i,g=f*s,x=f*i;let p=Rt++*re*le;zt[p++]=t-d-x,zt[p++]=e-y+g,zt[p++]=o,zt[p++]=a,Pt[p++]=h,Pt[p++]=c,zt[p++]=t+d+x,zt[p++]=e+y-g,zt[p++]=l,zt[p++]=r,Pt[p++]=h,Pt[p++]=c,zt[p++]=t-d+x,zt[p++]=e+y+g,zt[p++]=o,zt[p++]=r,Pt[p++]=h,Pt[p++]=c,zt[p++]=t-d-x,zt[p++]=e-y+g,zt[p++]=o,zt[p++]=a,Pt[p++]=h,Pt[p++]=c,zt[p++]=t+d-x,zt[p++]=e-y-g,zt[p++]=l,zt[p++]=a,Pt[p++]=h,Pt[p++]=c,zt[p++]=t+d+x,zt[p++]=e+y-g,zt[p++]=l,zt[p++]=r,Pt[p++]=h,Pt[p++]=c}const Wt=1,Ut=4,Ht=770,qt=771,$t=3042,Ot=3553,jt=5121,Jt=5126,Kt=6408,Nt=9728,Yt=10240,_t=10241,Vt=10242,Xt=10243,Qt=16384,Zt=33071,te=34962,ee=35048,se=35632,ie=35633,ne=35713,oe=35714,re=6,le=6,ae=65536,he=24,ce="LittleJS";let ue,fe,de,ye,ge=[],xe=[],pe=0,me=0,we=0,be=0,ve=0,Se=0;const Te="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";function Me(){xe=ge.filter((t=>t.collideSolidObjects));const t=e=>{if(!e.destroyed){e.update();for(const s of e.children)t(s)}};for(const e of ge)e.parent||t(e);ge=ge.filter((t=>!t.destroyed)),me=++pe/60}const Ce=0,ze=1,Pe=2,Re=3,ke=4,Ae=5,Fe=0,Le=1,De=2,Be=[[0,1],[1,0],[0,-1],[-1,0]],Ee=0,Ie=2,Ge=3,We=[null,null,new k(.6,.6,.6),new k(.5,.5,.5),new k(.8,.3,.3),new k(1,0,0)],Ue=[new k(.3,.3,.3),new k(.35,.35,.35)];class He{constructor(t,e,s){this.x=e,this.y=s,this.type=t||0}copy(){return new He(this.type,this.x,this.y)}apply(t){this.type=t.type}}const qe=[new k,new k(.9,.9,.9),new k(1,.3,.3)];class $e{constructor(t,e){this.pos=P(t,e),this.tiles=function(t){const e=2*t-1,s=z(1,e**2+1),i=[],n=[];for(let t=0;t<e;t++)i.push(new Array(e).fill(Ce));for(let t=0;t<s;t++){let s,o;if(0===t)s=z(0,e),o=z(0,e),n.push([s,o]);else{const t=n[z(0,n.length)],r=Be.map((s=>{let n=[t[0]+s[0],t[1]+s[1]];return n[0]<0||n[0]>=e||n[1]<0||n[1]>=e||i[n[1]][n[0]]!==Ce?null:n})).filter((t=>t));if(!r.length)continue;const l=r[z(0,r.length)];[s,o]=l,n.push(l)}i[o][s]=ze}for(let t=i.length-1;t>=0;t--)i[t].every((t=>t===Ce))&&i.splice(t,1);for(let t=e-1;t>=0;t--)i.map((e=>e[t])).every((t=>t===Ce))&&i.forEach((e=>e.splice(t,1)));return i}(2),this.state=Fe}getWorldBounds(){const t=2*this.tiles[0].length,e=2*this.tiles.length;return[this.pos.copy(),this.pos.add(P(t,e))]}isClicked(){const t=et.subtract(this.pos).add(P(1)).divide(P(2)).floor(),e=this.tiles[t.y];return!!e&&!!e[t.x]}rotate(t){const e=this.tiles.length,s=this.tiles[0].length,i=new Array(s);for(let t=0;t<s;t++)i[t]=new Array(e).fill(Ce);for(let t=0;t<e;t++)for(let e=0;e<s;e++)i[e][t]=this.tiles[t][e];1===t?i.reverse():i.forEach((t=>t.reverse())),this.tiles=i}render(){for(let t=0;t<this.tiles.length;t+=1){const e=this.tiles[t];for(let s=0;s<e.length;s+=1){if(!e[s])continue;const i=qe[this.state]||new k(1,0,0);N(P(s,t).multiply(P(2)).add(this.pos),P(2),i)}}}}const Oe=new class{constructor(t,e){this.pos=P(),this.tiles=[],this.size=P(t,e);const s=this.size.x*this.size.y;for(let t=0;t<s;t+=1)this.tiles.push(new He(0,t%this.size.x,Math.floor(t/this.size.y)));this.allRoadsConnected=!1,this.houses=[],this.snapshotTiles=[];for(const t of this.tiles)this.snapshotTiles.push(t.copy())}createSnapshot(){this.tiles.forEach(((t,e)=>this.snapshotTiles[e].apply(t)))}houseCanFit(t){const e=t.getWorldBounds(),s=this.getWorldBounds();if(!(e[0].x>=s[0].x&&e[0].y>=s[0].y&&e[1].x<=s[1].x&&e[1].y<=s[1].y))return!1;const i=t.pos.divide(P(2)),n=t.tiles;for(let t=0;t<n.length;t+=1){const e=n[t];for(let s=0;s<e.length;s+=1){if(!e[s])continue;const n=i.add(P(s,t));if(this.getTile(n.x,n.y).type)return!1}}return!0}houseIsTouchingRoad(t){const e=t.pos.divide(P(2)),s=t.tiles;for(let t=0;t<s.length;t+=1){const i=s[t];for(let s=0;s<i.length;s+=1){if(!i[s])continue;const n=e.add(P(s,t));if(Be.map((t=>this.getTile(n.x+t[0],n.y+t[1]))).filter((t=>t)).some((t=>t.type===Pe)))return!0}}return!1}addHouse(t){t.state=Le,this.houses.push(t);const e=t.pos.divide(P(2)),s=t.tiles;for(let t=0;t<s.length;t+=1){const i=s[t];for(let s=0;s<i.length;s+=1){if(!i[s])continue;const n=e.add(P(s,t));this.setTile(n.x,n.y,ze)}}}getWorldSize(){return this.size.multiply(P(2))}getWorldBounds(){return[this.pos.copy(),this.pos.add(this.size.multiply(P(2)))]}setTile(t,e,s){this.tiles[t+e*this.size.x].type=s}getTile(t,e){return this.tiles[t+e*this.size.x]}getTileFromMousePos(){const t=this.getCoordsFromMousePos();return t?this.getTile(t.x,t.y):null}getCoordsFromMousePos(t=!1){return this.getCoordsFromPos(et,t)}getCoordsFromPos(t,e=!1){const s=t.subtract(this.pos).add(P(1));if(!e){if(s.x<0)return null;if(s.x>=2*this.size.x)return null;if(s.y<0)return null;if(s.y>=2*this.size.y)return null}return s.divide(P(2)).floor()}setTileLine(t,e,s){const i=[];if(Math.abs(e.x-t.x)<Math.abs(e.y-t.y)){const s=Math.max(Math.min(e.y,t.y),0),n=Math.min(Math.max(e.y,t.y),this.size.y-1);for(let e=s;e<=n;e+=1)i.push(this.getTile(t.x,e))}else{const s=Math.max(Math.min(e.x,t.x),0),n=Math.min(Math.max(e.x,t.x),this.size.x-1);for(let e=s;e<=n;e+=1)i.push(this.getTile(e,t.y))}for(const t of i)t.type=s;return i}resetToSnapshot(){this.tiles.forEach(((t,e)=>t.apply(this.snapshotTiles[e])))}checkRoadConnection(){const t=this.tiles.filter((t=>t.type===Pe||t.type===Ae));t.forEach((t=>t.type=Ae));const e=t.filter((t=>0===t.x||0===t.y||t.x===this.size.x-1||t.y===this.size.y-1));e.length?(e.forEach((t=>this.setConnectedRoads(t.x,t.y))),this.allRoadsConnected=t.every((t=>t.type===Pe))):this.allRoadsConnected=!1}setConnectedRoads(t,e){const s=this.getTile(t,e);if(s&&s.type===Ae){s.type=Pe;for(const s of Be)this.setConnectedRoads(t+s[0],e+s[1])}}render(){for(let t=0;t<this.size.y;t+=1)for(let e=0;e<this.size.x;e+=1){const s=P(e,t).multiply(P(2)).add(this.pos),i=this.getTile(e,t),n=We[i.type]||Ue[(e+t)%2];n&&N(s,P(2),n)}for(const t of this.houses)t.render()}}(15,15);let je,Je,Ke,Ne,Ye=P(),_e=P(),Ve=!1,Xe=!1,Qe=!1,Ze=()=>{throw new Error("game state setter not set")};function ts(){Ne=new $e(-8,-8)}const es=[{init(){},gameUpdate(){},gameRender(){}},{init(){},gameUpdate(){},gameRender(){}},{init(){},gameUpdate(){if(Z(0)&&(je=Oe.getCoordsFromMousePos(),je)){Oe.createSnapshot();const t=Oe.getTileFromMousePos();Je=t.type===Pe||t.type===Ae?ke:Re}if(Q(0)&&je){Oe.resetToSnapshot();const t=Oe.getCoordsFromMousePos(!0);Oe.setTileLine(je,t,Je)}if(tt(0)&&je){Oe.resetToSnapshot();const t=Oe.getCoordsFromMousePos(!0);Je===Re?Oe.setTileLine(je,t,Pe):Oe.setTileLine(je,t,Ce),Oe.checkRoadConnection()}tt(2)&&Oe.allRoadsConnected&&Ze(Ge)},gameRender(){Oe.render()}},{init(){Ke=3,ts()},gameUpdate(){Q(2)?Qe=!0:Qe&&(Qe=!1,Ne.rotate(1)),X(40)&&Ke>0&&(ts(),Ke-=1),Q(0)?(Xe||(Xe=!0,Ne.isClicked()&&(Ne.state=Fe,Ye=Ne.pos.copy(),_e=et.copy(),Ve=!0)),Ve&&(Ne.pos.x=Ye.x+(et.x-_e.x),Ne.pos.y=Ye.y+(et.y-_e.y))):Xe&&(Xe=!1,Ve&&(Ne.pos.x=2*Math.floor((Ne.pos.x+1)/2),Ne.pos.y=2*Math.floor((Ne.pos.y+1)/2),Oe.houseCanFit(Ne)&&Oe.houseIsTouchingRoad(Ne)?(Oe.addHouse(Ne),ts()):Ne.state=De,Ve=!1))},gameRender(){Oe.render(),Ne.render(),_(`Skips left: ${Ke}`,P(15,15),20,new k(1,1,1),void 0,void 0,"left")}},{init(){},gameUpdate(){},gameRender(){}}];let ss,is=Ee;Ze=function(t){is=t,ss=es[is],ss.init()},function(t,i,n,o,r,l){U.onerror=U.onload=()=>{fe=P(B).divide(ue=P(U.width,U.height)),U.onload=()=>h(1),document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-moz-user-select:none",document.body.appendChild(H=document.createElement("canvas")),q=H.getContext("2d"),H.style=Te,document.body.appendChild(e=document.createElement("a")),e.style.display="none",Lt(),document.body.appendChild($=document.createElement("canvas")),O=$.getContext("2d"),$.style=Te,t(),a()};const a=(t=0)=>{let e=t-ve;if(ve=t,de=((t,e=0,s=1)=>e+S(t)*(s-e))(.05,de||0,1e3/(e||1)),e*=V(107)?5:V(109)?.2:1,we+=e/1e3,Se=w(Se+!be*e,50),L.x){$.width=H.width=L.x,$.height=H.height=L.y;const t=innerWidth/innerHeight,e=H.width/H.height;H.style.width=$.style.width=t<e?"100%":"",H.style.height=$.style.height=t<e?"":"100%",vt&&(vt.style.width=H.style.width,vt.style.height=H.style.height)}else $.width=H.width=w(innerWidth,F.x),$.height=H.height=w(innerHeight,F.y);if(j=P(H.width,H.height),be)lt(),g(),n(),at();else{let t=0;for(Se<0&&Se>-9&&(t=Se,Se=0);Se>=0;Se-=1e3/60)lt(),i(),Me(),g(),n(),at();Se+=t}j=P(H.width,H.height),q.imageSmoothingEnabled=!1,Bt(H.width,H.height,E.x,E.y,I),o(),ge.sort(((t,e)=>t.renderOrder-e.renderOrder));for(const t of ge)t.destroyed||t.render();if(r(),function(){if(!Ft.length)return;const t=Ft[0],e=we-bt;if(bt)if(e>5)Ft.shift(bt=0);else{const s=4.5,i=e<W?1-e/W:e>s?(e-s)/W:0;t.render(i)}else bt=we}(),x(),It(q),s){O.textAlign="right",O.textBaseline="top",O.font="1em monospace",O.fillStyle="#000";const t=ce+" v1.3.8 / "+ye+" / "+ge.length+" / "+de.toFixed(1)+" GL";O.fillText(t,H.width-3,3),O.fillStyle="#fff",O.fillText(t,H.width-2,2),ye=0}requestAnimationFrame(a)};l?U.src=l:U.onload()}((function(){Ze(Ie);const t=Oe.getWorldSize();E.x=Oe.pos.x+t.x/2-1,E.y=Oe.pos.y+t.y/2-1}),(function(){ss.gameUpdate()}),(function(){}),(function(){ss.gameRender()}),(function(){}))}();
      </script>
  </body>
</html>
