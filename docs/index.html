<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Death Estate</title>
      <style>
        a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:'';content:none}table{border-collapse:collapse;border-spacing:0}
      </style>
  </head>
  <body>
      <script>
        !function(){"use strict";let t,e,s=1,n=0,i=[],o=0,r=0,l=0,a=0;const h=(...t)=>console.assert(...t),c=(t,e=P(),s="#fff",n=0,o=0,r=0)=>{h("string"==typeof s),i.push({pos:t,size:P(e),color:s,time:new A(n),angle:o,fill:r})},u=(t,e=0,s="#fff",n=0,o=0)=>{h("string"==typeof s),i.push({pos:t,size:e,color:s,time:new A(n),angle:0,fill:o})},d=(t,e,s,n)=>c(t,0,e,s,n),f=(t,e,s,n=.1,i)=>{const o=P((e.x-t.x)/2,(e.y-t.y)/2),r=P(n,2*o.length());c(t.add(o),r,s,i,o.angle(),1)},g=(t,e,s=1,n="#fff",o=0,r=0,l="monospace")=>{h("string"==typeof n),i.push({text:t,pos:e,size:s,color:n,time:new A(o),angle:r,font:l})},y=()=>{tt(192)&&(o=!o),o&&(tt(48)&&(s=!s),tt(49)&&(r=!r,l=0),tt(50)&&(l=!l,r=0),tt(51)&&(a=!a),tt(52)&&(n=!n),tt(53)&&(t=1))},p=()=>{var s;if(Wt(H),t&&(Wt(H,1),H.drawImage(O,0,0),O.width|=0,s=$,e.download="screenshot.png",e.href=s.toDataURL("image/png").replace("image/png","image/octet-stream"),e.click(),t=0),a&&I&&navigator.getGamepads){const t=navigator.getGamepads();for(let e=t.length;e--;){const s=t[e];if(s){const t=1,n=.2,i=G,o=gt[e];for(let s=o.length;s--;){const n=i.add(P(s*t*2,e*t*3)),r=n.add(o[s].scale(t));u(n,t,"#fff7",0,1),f(n,r,"#f00"),d(r,"#f00")}for(let o=s.buttons.length;o--;){const r=i.add(P(o*n*2,e*t*3-t-n)),l=s.buttons[o].pressed;u(r,n,l?"#f00":"#fff7",0,1),g(o,r,.2)}}}}if(o){let t,e=1/0;for(const s of me){if(s.canvas||s.destroyed)continue;const n=s.size.copy();if(!n.x||!n.y)continue;const i=it.distanceSquared(s.pos);i<e&&(e=i,t=s);const o=new B(s.collideTiles?1:0,s.collideSolidObjects?1:0,s.isSolid?1:0,s.parent?.2:.5);n.x=b(n.x,.2),n.y=b(n.y,.2),Y(s.pos,n,o),Y(s.pos,n.scale(.8),s.parent?new B(1,1,1,.5):new B(0,0,0,.8)),s.parent&&V(s.pos,s.parent.pos,.1,new B(0,0,1,.5))}if(t){const e=H;H=q;const s=function(t,e,s){t=t.floor();const n=(e=e.floor()).subtract(t),i=m(n.x),o=-m(n.y),r=S(n.x),l=S(n.y);let a=i+o;for(let n=t.x,h=t.y;;){const t=vt(P(n,h));if(t&&(s?s.collideWithTileRaycast(t,new R(n,h)):t>0))return new R(n+.5,h+.5);if(n==e.x&h==e.y)break;const c=2*a;c>=o&&(a+=o,n+=r),c<=i&&(a+=i,h+=l)}}(t.pos,it);s&&Y(s.floor().add(P(.5)),P(1),new B(0,1,1,.3)),Y(it.floor().add(P(.5)),P(1),new B(0,0,1,.5)),V(it,t.pos,.1,s?new B(1,0,0,.5):new B(0,1,0,.5));X("mouse pos = "+it+"\nmouse collision = "+vt(it)+"\n\n--- object info ---\n"+t.toString(),ot,24,new B,.05,void 0,void 0,"monospace"),H=e}Wt(H)}{q.lineWidth=2;const t=.5*E;i.forEach((e=>{q.save();const s=N(e.pos);if(q.translate(0|s.x,0|s.y),q.rotate(e.angle),q.fillStyle=q.strokeStyle=e.color,null!=e.text)q.font=e.size*E+"px "+e.font,q.textAlign="center",q.textBaseline="middle",q.fillText(e.text,0,0);else if(0==e.size||0===e.size.x&&0===e.size.y)q.fillRect(-t/2,-1,t,3),q.fillRect(-1,-t/2,3,t);else if(null!=e.size.x){const t=e.size.x*E|0,s=e.size.y*E|0;e.fill&&q.fillRect(-t/2|0,-s/2|0,t,s),q.strokeRect(-t/2|0,-s/2|0,t,s)}else q.beginPath(),q.arc(0,0,e.size*E,0,9),e.fill&&q.fill(),q.stroke();q.restore()})),i=i.filter((t=>t.time.get()<0))}{q.save(),q.fillStyle="#fff",q.textAlign="left",q.textBaseline="top",q.font="28px monospace",q.shadowColor="#000",q.shadowBlur=9;let t=9,e=-20,s=30;if(o){q.fillText(fe,t,e+=s),q.fillText("Objects: "+me.length,t,e+=s),q.fillText("Time: "+T(Se),t,e+=s),q.fillText("---------",t,e+=s),q.fillStyle="#f00",q.fillText("~: Debug Overlay",t,e+=s),q.fillStyle=r?"#f00":"#fff",q.fillText("1: Debug Physics",t,e+=s),q.fillStyle=l?"#f00":"#fff",q.fillText("2: Debug Particles",t,e+=s),q.fillStyle=a?"#f00":"#fff",q.fillText("3: Debug Gamepads",t,e+=s),q.fillStyle=n?"#f00":"#fff",q.fillText("4: God Mode",t,e+=s),q.fillStyle="#fff",q.fillText("5: Save Screenshot",t,e+=s);let i="";for(const t in ht[0])t&&Z(t,0)&&(i+=t+" ");i&&q.fillText("Keys Down: "+i,t,e+=s);let o="";if(ht[1])for(const t in ht[1])t&&Z(t,1)&&(o+=t+" ");o&&q.fillText("Gamepad: "+o,t,e+=s)}else q.fillText(r?"Debug Physics":"",t,e+=s),q.fillText(l?"Debug Particles":"",t,e+=s),q.fillText(n?"God Mode":"",t,e+=s),q.fillText(a?"Debug Gamepads":"",t,e+=s);q.restore()}},x=Math.PI,m=t=>t<0?-t:t,w=(t,e)=>t<e?t:e,b=(t,e)=>t>e?t:e,S=t=>t<0?-1:1,v=(t,e=0,s=1)=>t<e?e:t>s?s:t,C=(t,e=0,s=1)=>s-e?v((t-e)/(s-e)):0,T=t=>(t/60|0)+":"+(t%60<10?"0":"")+(t%60|0),M=(t=1,e=0)=>e+(t-e)*Math.random(),z=(t=1,e=0)=>0|M(t,e),P=(t=0,e)=>null==t.x?new R(t,null==e?t:e):new R(t.x,t.y);class R{constructor(t=0,e=0){this.x=t,this.y=e}copy(){return new R(this.x,this.y)}add(t){return h(null!=t.x),new R(this.x+t.x,this.y+t.y)}subtract(t){return h(null!=t.x),new R(this.x-t.x,this.y-t.y)}multiply(t){return h(null!=t.x),new R(this.x*t.x,this.y*t.y)}divide(t){return h(null!=t.x),new R(this.x/t.x,this.y/t.y)}scale(t){return h(null==t.x),new R(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const e=this.length();return e?this.scale(t/e):new R(0,t)}clampLength(t=1){const e=this.length();return e>t?this.scale(t/e):this}dot(t){return h(null!=t.x),this.x*t.x+this.y*t.y}cross(t){return h(null!=t.x),this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,e=1){return this.x=e*Math.sin(t),this.y=e*Math.cos(t),this}rotate(t){const e=Math.cos(t),s=Math.sin(t);return new R(this.x*e-this.y*s,this.x*s+this.y*e)}direction(){return m(this.x)>m(this.y)?this.x<0?3:1:this.y<0?2:0}invert(){return new R(this.y,-this.x)}floor(){return new R(Math.floor(this.x),Math.floor(this.y))}area(){return m(this.x*this.y)}lerp(t,e){return h(null!=t.x),this.add(t.subtract(this).scale(v(e)))}arrayCheck(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}class B{constructor(t=1,e=1,s=1,n=1){this.r=t,this.g=e,this.b=s,this.a=n}copy(){return new B(this.r,this.g,this.b,this.a)}add(t){return new B(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new B(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new B(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new B(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,e=t){return new B(this.r*t,this.g*t,this.b*t,this.a*e)}clamp(){return new B(v(this.r),v(this.g),v(this.b),v(this.a))}lerp(t,e){return this.add(t.subtract(this).scale(v(e)))}setHSLA(t=0,e=0,s=1,n=1){const i=s<.5?s*(1+e):s+e-s*e,o=2*s-i,r=(t,e,s)=>(s=(s%1+1)%1)<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t;return this.r=r(o,i,t+1/3),this.g=r(o,i,t),this.b=r(o,i,t-1/3),this.a=n,this}getHSLA(){const t=this.r,e=this.g,s=this.b,n=this.a,i=Math.max(t,e,s),o=Math.min(t,e,s),r=(i+o)/2;let l=0,a=0;if(i!=o){let n=i-o;a=r>.5?n/(2-i-o):n/(i+o),t==i?l=(e-s)/n+(e<s?6:0):e==i?l=(s-t)/n+2:s==i&&(l=(t-e)/n+4)}return[l/6,a,r,n]}mutate(t=.05,e=0){return new B(this.r+M(t,-t),this.g+M(t,-t),this.b+M(t,-t),this.a+M(e,-e)).clamp()}toString(){return h(this.r>=0&&this.r<=1&&this.g>=0&&this.g<=1&&this.b>=0&&this.b<=1&&this.a>=0&&this.a<=1),`rgb(${255*this.r|0},${255*this.g|0},${255*this.b|0},${this.a})`}rgbaInt(){return h(this.r>=0&&this.r<=1&&this.g>=0&&this.g<=1&&this.b>=0&&this.b<=1&&this.a>=0&&this.a<=1),(255*this.r|0)+(255*this.g<<8)+(255*this.b<<16)+(255*this.a<<24)}setHex(t){const e=e=>parseInt(t.slice(e,e+2),16)/255;return this.r=e(1),this.g=e(3),this.b=e(5),this.a=1,h(this.r>=0&&this.r<=1&&this.g>=0&&this.g<=1&&this.b>=0&&this.b<=1),this}getHex(){const t=t=>((t=255*t|0)<16?"0":"")+t.toString(16);return"#"+t(this.r)+t(this.g)+t(this.b)}}class A{constructor(t){this.time=null==t?void 0:Se+t,this.setTime=t}set(t=0){this.time=Se+t,this.setTime=t}unset(){this.time=void 0}isSet(){return null!=this.time}active(){return Se<=this.time}elapsed(){return Se>this.time}get(){return this.isSet()?Se-this.time:0}getPercent(){return this.isSet()?C(this.time-Se,this.setTime,0):0}toString(){return this.unset()?"unset":Math.abs(this.get())+" seconds "+(this.get()<0?"before":"after")}}let k=P(1920,1200),D=P(),F=P(16),L=.3,G=(P(1),P()),E=b(F.x,F.y),I=1,U=.5;const W=new Image;let $,H,O,q,j=P();const J=t=>(h(j.x&&j.y,"mainCanvasSize is invalid"),t.add(P(.5)).subtract(j.scale(.5)).multiply(P(1/E,-1/E)).add(G)),N=t=>(h(j.x&&j.y,"mainCanvasSize is invalid"),t.subtract(G).multiply(P(E,-E)).add(j.scale(.5)).subtract(P(.5)));function _(t,e=P(1),n=-1,i=F,o=new B,r=0,l,a=new B(0,0,0,0),h=1){if(s&&++xe,h)if(n<0||!W.width)$t(t.x,t.y,e.x,e.y,r,0,0,0,0,0,o.rgbaInt());else{const s=ge.x/i.x|0,h=i.x/ge.x,c=i.y/ge.y,u=n%s*h,d=(n/s|0)*c;$t(t.x,t.y,l?-e.x:e.x,e.y,r,u+ye.x,d+ye.y,u-ye.x+h,d-ye.y+c,o.rgbaInt(),a.rgbaInt())}else!function(t,e,s,n,i,o=H){t=N(t),e=e.scale(E),o.save(),o.translate(t.x+.5|0,t.y-.5|0),o.rotate(s),o.scale(n?-e.x:e.x,e.y),i(o),o.restore()}(t,e,r,l,(t=>{if(n<0)t.fillStyle=o,t.fillRect(-.5,-.5,1,1);else{const e=ge.x/i.x|0,s=n%e*i.x+L,r=(n/e|0)*i.y+L,l=i.x-.6,a=i.y-.6;t.globalAlpha=o.a,t.drawImage(W,s,r,l,a,-.5,-.5,1,1)}}))}function Y(t,e,s,n,i){_(t,e,-1,F,s,n,0,0,i)}function K(t,e,s,n,i){!function(t,e=P(1),s,n,i,o,r,l,a){_(J(t),e.scale(1/E),s,n,i,o,r,l,a)}(t,e,-1,F,s,n,0,0,i)}function V(t,e,s=.1,n,i){const o=P((e.x-t.x)/2,(e.y-t.y)/2),r=P(s,2*o.length());Y(t.add(o),r,n,o.angle(),0)}function X(t,e,s=1,n=new B,i=0,o=new B(0,0,0),r="center",l="arial"){q.fillStyle=n,q.lineWidth=i,q.strokeStyle=o,q.textAlign=r,q.font=s+"px "+l,q.textBaseline="middle",q.lineJoin="round",e=e.copy(),(t+"").split("\n").forEach((t=>{i&&q.strokeText(t,e.x,e.y),q.fillText(t,e.x,e.y),e.y+=s}))}function Q(t,e,s=1,n,i,o,r,l){X(t,N(e),s*E,n,i*E,o,r,l)}const Z=(t,e=0)=>ht[e]&&1&ht[e][t]?1:0,tt=(t,e=0)=>ht[e]&&2&ht[e][t]?1:0,et=Z,st=tt,nt=(t,e=0)=>ht[e]&&4&ht[e][t]?1:0;let it=P(),ot=P(),rt=0,lt=0;const at=(t,e=0)=>Z(t,e+1);let ht=[[]];function ct(){document.hasFocus()||(ht=[[]]),it=J(ot),function(){0;if(!I||!navigator.getGamepads||(document.hasFocus(),0))return;const t=navigator.getGamepads();for(let e=t.length;e--;){const s=t[e],n=ht[e+1]||(ht[e+1]=[]),i=gt[e]||(gt[e]=[]);if(s){const t=.3,o=.8,r=e=>e>t?C(e,t,o):e<-t?-C(-e,t,o):0;for(let t=0;t<s.axes.length-1;t+=2)i[t>>1]=P(r(s.axes[t]),r(-s.axes[t+1])).clampLength();for(let t=s.buttons.length;t--;){const i=s.buttons[t];n[t]=i.pressed?1+2*!at(t,e):4*at(t,e),lt|=!e&&i.pressed}{const t=P(at(15,e)-at(14,e),at(12,e)-at(13,e));t.lengthSquared()&&(i[0]=t.clampLength())}}}}()}function ut(){for(const t of ht)for(const e in t)t[e]&=1;rt=0}onkeydown=t=>{t.target==document.body&&(t.repeat||(ht[lt=0][dt(t.keyCode)]=3))},onkeyup=t=>{t.target==document.body&&(ht[0][dt(t.keyCode)]=4)};const dt=t=>87==t?38:83==t?40:65==t?37:68==t?39:t;onmousedown=t=>{ht[lt=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=t=>ht[0][t.button]=2&ht[0][t.button]|4,onmousemove=t=>ot=ft(t),onwheel=t=>t.ctrlKey||(rt=S(t.deltaY)),oncontextmenu=t=>!1;const ft=t=>{if(!$)return P();const e=$.getBoundingClientRect();return P($.width,$.height).multiply(P(C(t.x,e.left,e.right),C(t.y,e.top,e.bottom)))},gt=[];const yt=void 0!==window.ontouchstart;if(yt){let t,e;ontouchstart=ontouchmove=ontouchend=s=>{s.button=0;const n=s.touches.length;return n?(e||xt(0,e=1),s.x=s.touches[0].clientX,s.y=s.touches[0].clientY,t?onmousemove(s):onmousedown(s)):t&&onmouseup(s),t=n,!s.cancelable}}let pt;new A,P();const xt=(...t)=>function(t,e=1,s=1,n=0,i=0){if(pt||(pt=new(window.AudioContext||webkitAudioContext)),pt.resume(),"running"!=pt.state)return;const o=pt.createBuffer(t.length,t[0].length,mt),r=pt.createBufferSource();t.forEach(((t,e)=>o.getChannelData(e).set(t))),r.buffer=o,r.playbackRate.value=s,r.loop=i;const l=pt.createGain();return l.gain.value=.5*e,l.connect(pt.destination),(window.StereoPannerNode?r.connect(new StereoPannerNode(pt,{pan:v(n,-1,1)})):r).connect(l),r.start(),r}([wt(...t)]),mt=44100;function wt(t=1,e=.05,s=220,n=0,i=0,o=.1,r=0,l=1,a=0,h=0,c=0,u=0,d=0,f=0,g=0,y=0,p=0,v=1,C=0,T=0){let z,P,R=2*x,B=a*=500*R/mt/mt,A=[],k=s*=(1+e*M(-1,1))*R/mt,D=0,F=0,L=0,G=1,E=0,I=0,U=0;for(h*=500*R/mt**3,g*=R/mt,c*=R/mt,u*=mt,d=d*mt|0,P=(n=n*mt+9)+(C*=mt)+(i*=mt)+(o*=mt)+(p*=mt)|0;L<P;A[L++]=U)++I%(100*y|0)||(U=r?r>1?r>2?r>3?Math.sin((D%R)**3):b(w(Math.tan(D),1),-1):1-(2*D/R%2+2)%2:1-4*m(Math.round(D/R)-D/R):Math.sin(D),U=(d?1-T+T*Math.sin(R*L/d):1)*S(U)*m(U)**l*t*.5*(L<n?L/n:L<n+C?1-(L-n)/C*(1-v):L<n+C+i?v:L<P-p?(P-L-p)/o*v:0),U=p?U/2+(p>L?0:(L<P-p?1:(P-L)/p)*A[L-p|0]/2):U),z=(s+=a+=h)*Math.cos(g*F++),D+=z-z*f*(1-1e9*(Math.sin(L)+1)%2),G&&++G>u&&(s+=c,k+=c,G=0),!d||++E%d||(s=k,a=B,G=G||1);return A}let bt=[],St=P();const vt=t=>t.arrayCheck(St)?bt[(0|t.y)*St.x+t.x|0]:0;let Ct,Tt,Mt,zt,Pt,Rt,Bt,At,kt,Dt,Ft,Lt=[];function Gt(){Tt=document.createElement("canvas"),Mt=Tt.getContext("webgl",{antialias:!1}),Tt.style=ze,zt=function(t){if(!t||!t.width)return;const e=Mt.createTexture();return Mt.bindTexture(Nt,e),Mt.texImage2D(Nt,0,Kt,Kt,_t,t),Mt.texParameteri(Nt,Qt,Vt),Mt.texParameteri(Nt,Xt,Vt),Mt.texParameteri(Nt,Zt,se),Mt.texParameteri(Nt,te,se),e}(W),document.body.appendChild(Tt),Rt=function(t,e){0;const s=Mt.createProgram();if(Mt.attachShader(s,Et(t,re)),Mt.attachShader(s,Et(e,oe)),Mt.linkProgram(s),!Mt.getProgramParameter(s,ae))throw Mt.getProgramInfoLog(s);return s}("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}","precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}");const t=new ArrayBuffer(ue*he*de);!function(t,e,s){0;const n=Mt.createBuffer();Mt.bindBuffer(t,n),Mt.bufferData(t,e,s)}(ne,t.byteLength,ie),Bt=new Float32Array(t),At=new Uint32Array(t);let e=kt=0;const s=(t,s,n,i,o=0)=>{const r=Mt.getAttribLocation(Rt,t);Mt.enableVertexAttribArray(r),Mt.vertexAttribPointer(r,i,s,o,de,e),e+=i*n};s("p",Yt,4,2),s("t",Yt,4,2),s("c",_t,1,4,1),s("a",_t,1,4,1)}function Et(t,e){const s=Mt.createShader(e);if(Mt.shaderSource(s,t),Mt.compileShader(s),!Mt.getShaderParameter(s,le))throw Mt.getShaderInfoLog(s);return s}function It(t,e,s,n,i){var o;Mt.viewport(0,0,Tt.width=t,Tt.height=e),Mt.clear(ee),Mt.bindTexture(Nt,Pt=zt),Mt.useProgram(Rt),Ft=o;const r=2*i/t,l=2*i/e;Mt.uniformMatrix4fv(Mt.getUniformLocation(Rt,"m"),0,new Float32Array([r,0,0,0,0,l,0,0,1,1,-1,1,-1-r*s,-1-l*n,0,0]))}function Ut(){if(!kt)return;const t=Dt?Ht:jt;Mt.blendFuncSeparate(qt,t,Ht,t),Mt.enable(Jt),Mt.bufferSubData(ne,0,Bt.subarray(0,kt*he*ce)),Mt.drawArrays(Ot,0,kt*he),kt=0,Dt=Ft}function Wt(t,e){(kt||e)&&(Ut(),e&&t.drawImage(Tt,0,0))}function $t(t,e,s,n,i,o,r,l,a,h=4294967295,c=0){kt!=ue&&Dt==Ft||Ut();const u=Math.cos(i)/2,d=Math.sin(i)/2,f=u*s,g=u*n,y=d*s,p=d*n;let x=kt++*he*ce;Bt[x++]=t-f-p,Bt[x++]=e-g+y,Bt[x++]=o,Bt[x++]=a,At[x++]=h,At[x++]=c,Bt[x++]=t+f+p,Bt[x++]=e+g-y,Bt[x++]=l,Bt[x++]=r,At[x++]=h,At[x++]=c,Bt[x++]=t-f+p,Bt[x++]=e+g+y,Bt[x++]=o,Bt[x++]=r,At[x++]=h,At[x++]=c,Bt[x++]=t-f-p,Bt[x++]=e-g+y,Bt[x++]=o,Bt[x++]=a,At[x++]=h,At[x++]=c,Bt[x++]=t+f-p,Bt[x++]=e-g-y,Bt[x++]=l,Bt[x++]=a,At[x++]=h,At[x++]=c,Bt[x++]=t+f+p,Bt[x++]=e+g-y,Bt[x++]=l,Bt[x++]=r,At[x++]=h,At[x++]=c}const Ht=1,Ot=4,qt=770,jt=771,Jt=3042,Nt=3553,_t=5121,Yt=5126,Kt=6408,Vt=9728,Xt=10240,Qt=10241,Zt=10242,te=10243,ee=16384,se=33071,ne=34962,ie=35048,oe=35632,re=35633,le=35713,ae=35714,he=6,ce=6,ue=65536,de=24,fe="LittleJS";let ge,ye,pe,xe,me=[],we=[],be=0,Se=0,ve=0,Ce=0,Te=0,Me=0;const ze="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";function Pe(){we=me.filter((t=>t.collideSolidObjects));const t=e=>{if(!e.destroyed){e.update();for(const s of e.children)t(s)}};for(const e of me)e.parent||t(e);me=me.filter((t=>!t.destroyed)),Se=++be/60}const Re=0,Be=1,Ae=2,ke=3,De=4,Fe=5,Le=0,Ge=1,Ee=2,Ie=[[0,1],[1,0],[0,-1],[-1,0]],Ue=0,We=1,$e=2,He=3,Oe=4;class qe{constructor(){this.buttons=[],this.pressedButton=null}addBtn(t){this.buttons.push(t)}removeBtn(t){const e=this.buttons.indexOf(t);e>-1&&this.buttons.splice(e,1)}pressed(){this.pressedButton=null;for(let t=this.buttons.length-1;t>=0&&!this.pressedButton;t--){const e=this.buttons[t];e.containsMousePos()&&(this.pressedButton=e)}return!!this.pressedButton}released(){return!!this.pressedButton&&(this.pressedButton.containsMousePos()&&this.pressedButton.pressed(),this.pressedButton=null,!0)}render(){this.buttons.forEach((t=>t.render()))}}class je{constructor(t,e,s,n,i,o,r,l=!0){this.pos=t,this.size=e,this.text=s,this.textSize=n,this.bgColor=i,this.textColor=o,this.onPressed=r||(()=>{}),this.screenSpace=l}containsMousePos(){const t=this.screenSpace?ot:it;return t.x>=this.pos.x-this.size.x/2&&t.y>=this.pos.y-this.size.y/2&&t.x<this.pos.x+this.size.x/2&&t.y<this.pos.y+this.size.y/2}pressed(){this.onPressed()}render(){let t,e;this.screenSpace?(t=K,e=X):(t=Y,e=Q),t(this.pos,this.size,this.bgColor),e(this.text,this.pos,this.textSize,this.textColor)}}const Je=new class{constructor(){this.controllerMap=null,this.gameState=Ue}init(t){this.controllerMap=t}setGameState(t,e){this.gameState=t,this.curController=this.controllerMap[t],this.curController.init(e)}gameUpdate(){this.curController.gameUpdate()}gameRender(){this.curController.gameRender()}},Ne=P(0,4),_e=new B(1,0,0),Ye=new B(1,1,1),Ke=new je(P(0,-2),P(4,2.5),"Start",1.5,new B(1,1,1),new B(0,0,0),(()=>{Je.setGameState($e)}),!1),Ve=new qe;Ve.addBtn(Ke);const Xe={init(){},gameUpdate(){st(0)&&Ve.pressed(),nt(0)&&Ve.released()},gameRender(){Q("Death Estate",Ne,5,_e,M(1,1.2),Ye),Ve.render()}},Qe=[null,null,new B(.6,.6,.6),new B(.5,.5,.5),new B(.8,.3,.3),new B(1,0,0)],Ze=[new B(.3,.3,.3),new B(.35,.35,.35)];class ts{constructor(t,e,s){this.x=e,this.y=s,this.type=t||0}copy(){return new ts(this.type,this.x,this.y)}apply(t){this.type=t.type}}class es{constructor(t,e){this.pos=P(),this.tiles=[],this.size=P(t,e);const s=this.size.x*this.size.y;for(let t=0;t<s;t+=1)this.tiles.push(new ts(0,t%this.size.x,Math.floor(t/this.size.y)));this.allRoadsConnected=!1,this.houses=[],this.snapshotTiles=[];for(const t of this.tiles)this.snapshotTiles.push(t.copy())}createSnapshot(){this.tiles.forEach(((t,e)=>this.snapshotTiles[e].apply(t)))}houseCanFit(t){const e=t.getWorldBounds(),s=this.getWorldBounds();if(!(e[0].x>=s[0].x&&e[0].y>=s[0].y&&e[1].x<=s[1].x&&e[1].y<=s[1].y))return!1;const n=t.pos.divide(P(2)),i=t.tiles;for(let t=0;t<i.length;t+=1){const e=i[t];for(let s=0;s<e.length;s+=1){if(!e[s])continue;const i=n.add(P(s,t));if(this.getTile(i.x,i.y).type)return!1}}return!0}houseIsTouchingRoad(t){const e=t.pos.divide(P(2)),s=t.tiles;for(let t=0;t<s.length;t+=1){const n=s[t];for(let s=0;s<n.length;s+=1){if(!n[s])continue;const i=e.add(P(s,t));if(Ie.map((t=>this.getTile(i.x+t[0],i.y+t[1]))).filter((t=>t)).some((t=>t.type===Ae)))return!0}}return!1}addHouse(t){t.state=Ge,this.houses.push(t);const e=t.pos.divide(P(2)),s=t.tiles;for(let t=0;t<s.length;t+=1){const n=s[t];for(let s=0;s<n.length;s+=1){if(!n[s])continue;const i=e.add(P(s,t));this.setTile(i.x,i.y,Be)}}}getWorldSize(){return this.size.multiply(P(2))}getWorldBounds(){return[this.pos.copy(),this.pos.add(this.size.multiply(P(2)))]}setTile(t,e,s){this.tiles[t+e*this.size.x].type=s}getTile(t,e){return this.tiles[t+e*this.size.x]}getTileFromMousePos(){const t=this.getCoordsFromMousePos();return t?this.getTile(t.x,t.y):null}getCoordsFromMousePos(t=!1){return this.getCoordsFromPos(it,t)}getCoordsFromPos(t,e=!1){const s=t.subtract(this.pos).add(P(1));if(!e){if(s.x<0)return null;if(s.x>=2*this.size.x)return null;if(s.y<0)return null;if(s.y>=2*this.size.y)return null}return s.divide(P(2)).floor()}setTileLine(t,e,s){const n=[];if(Math.abs(e.x-t.x)<Math.abs(e.y-t.y)){const s=Math.max(Math.min(e.y,t.y),0),i=Math.min(Math.max(e.y,t.y),this.size.y-1);for(let e=s;e<=i;e+=1)n.push(this.getTile(t.x,e))}else{const s=Math.max(Math.min(e.x,t.x),0),i=Math.min(Math.max(e.x,t.x),this.size.x-1);for(let e=s;e<=i;e+=1)n.push(this.getTile(e,t.y))}for(const t of n)t.type=s;return n}resetToSnapshot(){this.tiles.forEach(((t,e)=>t.apply(this.snapshotTiles[e])))}checkRoadConnection(){const t=this.tiles.filter((t=>t.type===Ae||t.type===Fe));t.forEach((t=>t.type=Fe));const e=t.filter((t=>0===t.x||0===t.y||t.x===this.size.x-1||t.y===this.size.y-1));e.length?(e.forEach((t=>this.setConnectedRoads(t.x,t.y))),this.allRoadsConnected=t.every((t=>t.type===Ae))):this.allRoadsConnected=!1}setConnectedRoads(t,e){const s=this.getTile(t,e);if(s&&s.type===Fe){s.type=Ae;for(const s of Ie)this.setConnectedRoads(t+s[0],e+s[1])}}getCounts(){const t=this.size.x*this.size.y;let e=0,s=0;for(const t of this.tiles)t.type===Be?e+=1:t.type===Ae&&(s+=1);return{totalCount:t,houseTileCount:e,roadCount:s}}render(){for(let t=0;t<this.size.y;t+=1)for(let e=0;e<this.size.x;e+=1){const s=P(e,t).multiply(P(2)).add(this.pos),n=this.getTile(e,t),i=Qe[n.type]||Ze[(e+t)%2];i&&Y(s,P(2),i)}for(const t of this.houses)t.render()}}const ss=[new B,new B(.9,.9,.9),new B(1,.3,.3)];class ns{constructor(t,e){this.pos=P(t,e),this.tiles=function(t){const e=2*t-1,s=z(1,e**2+1),n=[],i=[];for(let t=0;t<e;t++)n.push(new Array(e).fill(Re));for(let t=0;t<s;t++){let s,o;if(0===t)s=z(0,e),o=z(0,e),i.push([s,o]);else{const t=i[z(0,i.length)],r=Ie.map((s=>{let i=[t[0]+s[0],t[1]+s[1]];return i[0]<0||i[0]>=e||i[1]<0||i[1]>=e||n[i[1]][i[0]]!==Re?null:i})).filter((t=>t));if(!r.length)continue;const l=r[z(0,r.length)];[s,o]=l,i.push(l)}n[o][s]=Be}for(let t=n.length-1;t>=0;t--)n[t].every((t=>t===Re))&&n.splice(t,1);for(let t=e-1;t>=0;t--)n.map((e=>e[t])).every((t=>t===Re))&&n.forEach((e=>e.splice(t,1)));return n}(2),this.state=Le}getWorldBounds(){const t=2*this.tiles[0].length,e=2*this.tiles.length;return[this.pos.copy(),this.pos.add(P(t,e))]}isClicked(){const t=it.subtract(this.pos).add(P(1)).divide(P(2)).floor(),e=this.tiles[t.y];return!!e&&!!e[t.x]}rotate(t){const e=this.tiles.length,s=this.tiles[0].length,n=new Array(s);for(let t=0;t<s;t++)n[t]=new Array(e).fill(Re);for(let t=0;t<e;t++)for(let e=0;e<s;e++)n[e][t]=this.tiles[t][e];1===t?n.reverse():n.forEach((t=>t.reverse())),this.tiles=n}render(){for(let t=0;t<this.tiles.length;t+=1){const e=this.tiles[t];for(let s=0;s<e.length;s+=1){if(!e[s])continue;const n=ss[this.state]||new B(1,0,0);Y(P(s,t).multiply(P(2)).add(this.pos),P(2),n)}}}}let is,os,rs,ls,as=P(),hs=P(),cs=!1,us=!1,ds=!1,fs=null;function gs(){ls=new ns(-8,-8)}const ys={init(){is=new es(15,15),us=!1,cs=!1,ds=!1,fs=null;const t=is.getWorldSize();G.x=is.pos.x+t.x/2-1,G.y=is.pos.y+t.y/2-1},gameUpdate(){if(st(0)&&(fs=is.getCoordsFromMousePos(),fs)){is.createSnapshot();const t=is.getTileFromMousePos();os=t.type===Ae||t.type===Fe?De:ke}if(et(0)&&fs){is.resetToSnapshot();const t=is.getCoordsFromMousePos(!0);is.setTileLine(fs,t,os)}if(nt(0)&&fs){is.resetToSnapshot();const t=is.getCoordsFromMousePos(!0);os===ke?is.setTileLine(fs,t,Ae):is.setTileLine(fs,t,Re),is.checkRoadConnection()}nt(2)&&is.allRoadsConnected&&Je.setGameState(He)},gameRender(){is.render(),X("Place roads",P(15,15),20,new B(1,1,1),void 0,void 0,"left")}},ps={init(){rs=3,gs()},gameUpdate(){if(et(2)?ds=!0:ds&&(ds=!1,ls.rotate(1)),tt(40)&&rs>0&&(gs(),rs-=1),tt(69)){const t=is.getCounts();Je.setGameState(Oe,{timestamp:Date.now(),totalMaxScore:t.totalCount,score:t.houseTileCount,roadCount:t.roadCount})}et(0)?(us||(us=!0,ls.isClicked()&&(ls.state=Le,as=ls.pos.copy(),hs=it.copy(),cs=!0)),cs&&(ls.pos.x=as.x+(it.x-hs.x),ls.pos.y=as.y+(it.y-hs.y))):us&&(us=!1,cs&&(ls.pos.x=2*Math.floor((ls.pos.x+1)/2),ls.pos.y=2*Math.floor((ls.pos.y+1)/2),is.houseCanFit(ls)&&is.houseIsTouchingRoad(ls)?(is.addHouse(ls),gs()):ls.state=Ee,cs=!1))},gameRender(){is.render(),ls.render(),X(`Skips left: ${rs}`,P(15,15),20,new B(1,1,1),void 0,void 0,"left")}},xs=new B(1,0,0),ms=new B(1,1,1),ws=new B(1,1,1),bs=new B(1,1,0),Ss="deathestate_jayther_ldb",vs={};let Cs,Ts=[],Ms=0,zs=0,Ps=!0;const Rs=P(0,18),Bs=Rs.add(P(0,-5)),As=Rs.add(P(0,-13)),ks=As.add(P(3,-5)),Ds=new Array(5);for(let t=0;t<Ds.length;t++)Ds[t]=[ks.add(P(-.7,-2*t)),ks.add(P(.7,-2*t))];const Fs=new qe,Ls=new je(Rs.add(P(0,-31)),P(5,3),"Retry",1.5,new B(1,1,1),new B(0,0,0),(()=>{Je.setGameState($e)}),!1);function Gs(t,e){for(Cs={score:t,timestamp:e,dateStr:new Date(e).toLocaleDateString(),current:!0},Ts.push(Cs),Ts.sort(((t,e)=>{const s=e.score-t.score;return 0===s?e.timestamp-t.timestamp:s}));Ts.length>5;)Ts.pop();!function(){const t=Ts.map((t=>({score:t.score,timestamp:t.timestamp}))),e=JSON.stringify(t);if(Ps)try{window.localStorage.setItem(Ss,e)}catch(t){Ps=!1}Ps||(vs[Ss]=e)}()}Fs.addBtn(Ls);const Es=[{init(){},gameUpdate(){},gameRender(){}},Xe,ys,ps,{init(t){Ms=t.totalMaxScore,zs=t.roadCount,function(){let t=null;if(Ps)try{t=window.localStorage.getItem(Ss)}catch(t){Ps=!1}else t=vs[Ss]||null;t&&(Ts=JSON.parse(t)),Ts.forEach((t=>t.dateStr=new Date(t.timestamp).toLocaleDateString()))}(),Gs(t.score,t.timestamp),G.x=0,G.y=0},gameUpdate(){st(0)&&Fs.pressed(),nt(0)&&Fs.released()},gameRender(){!function(){Q("Game over",Rs,4,xs,.5,ms),Q(`You covered ${Cs.score} tiles (${Math.floor(Cs.score/Ms*100)}%)\n(road count: ${zs}, grid total: ${Ms})`,Bs,2,ws),Q("High Scores",As,4,xs,.5,ms);for(let t=0;t<5;t++){const e=Ts[t];let s,n,i;e?(s=e.dateStr,n=e.score.toString(),i=e.current?bs:ws):(s="-------------",n="---",i=ws),Q(s,Ds[t][0],2,i,void 0,void 0,"right"),Q(n,Ds[t][1],2,i,void 0,void 0,"left")}}(),Fs.render()}}];!function(t,n,i,o,r,l){W.onerror=W.onload=()=>{ye=P(L).divide(ge=P(W.width,W.height)),W.onload=()=>h(1),document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-moz-user-select:none",document.body.appendChild($=document.createElement("canvas")),H=$.getContext("2d"),$.style=ze,document.body.appendChild(e=document.createElement("a")),e.style.display="none",Gt(),document.body.appendChild(O=document.createElement("canvas")),q=O.getContext("2d"),O.style=ze,t(),a()};const a=(t=0)=>{let e=t-Te;if(Te=t,pe=((t,e=0,s=1)=>e+v(t)*(s-e))(.05,pe||0,1e3/(e||1)),e*=Z(107)?5:Z(109)?.2:1,ve+=e/1e3,Me=w(Me+!Ce*e,50),D.x){O.width=$.width=D.x,O.height=$.height=D.y;const t=innerWidth/innerHeight,e=$.width/$.height;$.style.width=O.style.width=t<e?"100%":"",$.style.height=O.style.height=t<e?"":"100%",Tt&&(Tt.style.width=$.style.width,Tt.style.height=$.style.height)}else O.width=$.width=w(innerWidth,k.x),O.height=$.height=w(innerHeight,k.y);if(j=P($.width,$.height),Ce)ct(),y(),i(),ut();else{let t=0;for(Me<0&&Me>-9&&(t=Me,Me=0);Me>=0;Me-=1e3/60)ct(),n(),Pe(),y(),i(),ut();Me+=t}j=P($.width,$.height),H.imageSmoothingEnabled=!1,It($.width,$.height,G.x,G.y,E),o(),me.sort(((t,e)=>t.renderOrder-e.renderOrder));for(const t of me)t.destroyed||t.render();if(r(),function(){if(!Lt.length)return;const t=Lt[0],e=ve-Ct;if(Ct)if(e>5)Lt.shift(Ct=0);else{const s=4.5,n=e<U?1-e/U:e>s?(e-s)/U:0;t.render(n)}else Ct=ve}(),p(),Wt(H),s){q.textAlign="right",q.textBaseline="top",q.font="1em monospace",q.fillStyle="#000";const t=fe+" v1.3.8 / "+xe+" / "+me.length+" / "+pe.toFixed(1)+" GL";q.fillText(t,$.width-3,3),q.fillStyle="#fff",q.fillText(t,$.width-2,2),xe=0}requestAnimationFrame(a)};l?W.src=l:W.onload()}((function(){Je.init(Es),Je.setGameState(We)}),(function(){Je.gameUpdate()}),(function(){}),(function(){Je.gameRender()}),(function(){}))}();
      </script>
  </body>
</html>
