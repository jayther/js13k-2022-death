<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Death Estate</title>
      <style>
        a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:'';content:none}table{border-collapse:collapse;border-spacing:0}
      </style>
  </head>
  <body>
      <script>
        !function(){"use strict";const t=Math.PI,e=t=>t<0?-t:t,s=(t,e)=>t<e?t:e,n=(t,e)=>t>e?t:e,i=t=>t<0?-1:1,o=(t,e=0,s=1)=>t<e?e:t>s?s:t,r=(t,e=0,s=1)=>s-e?o((t-e)/(s-e)):0,a=(t,e=0,s=1)=>e+o(t)*(s-e),h=(t=1,e=0)=>e+(t-e)*Math.random(),l=(t=1,e=0)=>0|h(t,e),c=(t=0,e)=>null==t.x?new d(t,null==e?t:e):new d(t.x,t.y);class d{constructor(t=0,e=0){this.x=t,this.y=e}copy(){return new d(this.x,this.y)}add(t){return new d(this.x+t.x,this.y+t.y)}subtract(t){return new d(this.x-t.x,this.y-t.y)}multiply(t){return new d(this.x*t.x,this.y*t.y)}divide(t){return new d(this.x/t.x,this.y/t.y)}scale(t){return new d(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const e=this.length();return e?this.scale(t/e):new d(0,t)}clampLength(t=1){const e=this.length();return e>t?this.scale(t/e):this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,e=1){return this.x=e*Math.sin(t),this.y=e*Math.cos(t),this}rotate(t){const e=Math.cos(t),s=Math.sin(t);return new d(this.x*e-this.y*s,this.x*s+this.y*e)}direction(){return e(this.x)>e(this.y)?this.x<0?3:1:this.y<0?2:0}invert(){return new d(this.y,-this.x)}floor(){return new d(Math.floor(this.x),Math.floor(this.y))}area(){return e(this.x*this.y)}lerp(t,e){return this.add(t.subtract(this).scale(o(e)))}arrayCheck(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}class u{constructor(t=1,e=1,s=1,n=1){this.r=t,this.g=e,this.b=s,this.a=n}copy(){return new u(this.r,this.g,this.b,this.a)}add(t){return new u(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new u(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new u(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new u(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,e=t){return new u(this.r*t,this.g*t,this.b*t,this.a*e)}clamp(){return new u(o(this.r),o(this.g),o(this.b),o(this.a))}lerp(t,e){return this.add(t.subtract(this).scale(o(e)))}setHSLA(t=0,e=0,s=1,n=1){const i=s<.5?s*(1+e):s+e-s*e,o=2*s-i,r=(t,e,s)=>(s=(s%1+1)%1)<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t;return this.r=r(o,i,t+1/3),this.g=r(o,i,t),this.b=r(o,i,t-1/3),this.a=n,this}getHSLA(){const t=this.r,e=this.g,s=this.b,n=this.a,i=Math.max(t,e,s),o=Math.min(t,e,s),r=(i+o)/2;let a=0,h=0;if(i!=o){let n=i-o;h=r>.5?n/(2-i-o):n/(i+o),t==i?a=(e-s)/n+(e<s?6:0):e==i?a=(s-t)/n+2:s==i&&(a=(t-e)/n+4)}return[a/6,h,r,n]}mutate(t=.05,e=0){return new u(this.r+h(t,-t),this.g+h(t,-t),this.b+h(t,-t),this.a+h(e,-e)).clamp()}toString(){return`rgb(${255*this.r|0},${255*this.g|0},${255*this.b|0},${this.a})`}rgbaInt(){return(255*this.r|0)+(255*this.g<<8)+(255*this.b<<16)+(255*this.a<<24)}setHex(t){const e=e=>parseInt(t.slice(e,e+2),16)/255;return this.r=e(1),this.g=e(3),this.b=e(5),this.a=1,this}getHex(){const t=t=>((t=255*t|0)<16?"0":"")+t.toString(16);return"#"+t(this.r)+t(this.g)+t(this.b)}}let p=c(1920,1200),y=c(),g=c(16),f=.3,x=(c(1),c()),m=n(g.x,g.y);let w=.5;let b,v,S=[],C=[],M=0,T=0,z=0,k=0,A=0;const B="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";function P(){C=S.filter((t=>t.collideSolidObjects));const t=e=>{if(!e.destroyed){e.update();for(const s of e.children)t(s)}};for(const e of S)e.parent||t(e);S=S.filter((t=>!t.destroyed)),T=++M/60}const R=new Image;let F,D,E,I,L=c();const W=t=>t.add(c(.5)).subtract(L.scale(.5)).multiply(c(1/m,-1/m)).add(x),G=t=>t.subtract(x).multiply(c(m,-m)).add(L.scale(.5)).subtract(c(.5));function $(t,e=c(1),s=-1,n=g,i=new u,o=0,r,a=new u(0,0,0,0),h=1){if(h)if(s<0||!R.width)Mt(t.x,t.y,e.x,e.y,o,0,0,0,0,0,i.rgbaInt());else{const h=b.x/n.x|0,l=n.x/b.x,c=n.y/b.y,d=s%h*l,u=(s/h|0)*c;Mt(t.x,t.y,r?-e.x:e.x,e.y,o,d+v.x,u+v.y,d-v.x+l,u-v.y+c,i.rgbaInt(),a.rgbaInt())}else!function(t,e,s,n,i,o=D){t=G(t),e=e.scale(m),o.save(),o.translate(t.x+.5|0,t.y-.5|0),o.rotate(s),o.scale(n?-e.x:e.x,e.y),i(o),o.restore()}(t,e,o,r,(t=>{if(s<0)t.fillStyle=i,t.fillRect(-.5,-.5,1,1);else{const e=b.x/n.x|0,o=s%e*n.x+f,r=(s/e|0)*n.y+f,a=n.x-.6,h=n.y-.6;t.globalAlpha=i.a,t.drawImage(R,o,r,a,h,-.5,-.5,1,1)}}))}function H(t,e,s,n,i){$(t,e,-1,g,s,n,0,0,i)}function U(t,e,s,n,i){!function(t,e=c(1),s,n,i,o,r,a,h){$(W(t),e.scale(1/m),s,n,i,o,r,a,h)}(t,e,-1,g,s,n,0,0,i)}function _(t,e,s=1,n=new u,i=0,o=new u(0,0,0),r="center",a="arial"){I.fillStyle=n,I.lineWidth=i,I.strokeStyle=o,I.textAlign=r,I.font=s+"px "+a,I.textBaseline="middle",I.lineJoin="round",e=e.copy(),(t+"").split("\n").forEach((t=>{i&&I.strokeText(t,e.x,e.y),I.fillText(t,e.x,e.y),e.y+=s}))}function q(t,e,s=1,n,i,o,r,a){_(t,G(e),s*m,n,i*m,o,r,a)}const O=(t,e=0)=>Z[e]&&1&Z[e][t]?1:0,N=O,J=(t,e=0)=>Z[e]&&2&Z[e][t]?1:0,Y=(t,e=0)=>Z[e]&&4&Z[e][t]?1:0;let j=c(),K=c(),V=0,X=0;const Q=(t,e=0)=>O(t,e+1);let Z=[[]];function tt(){document.hasFocus()||(Z=[[]]),j=W(K),function(){0;if(!navigator.getGamepads||!document.hasFocus())return;const t=navigator.getGamepads();for(let e=t.length;e--;){const s=t[e],n=Z[e+1]||(Z[e+1]=[]),i=it[e]||(it[e]=[]);if(s){const t=.3,o=.8,a=e=>e>t?r(e,t,o):e<-t?-r(-e,t,o):0;for(let t=0;t<s.axes.length-1;t+=2)i[t>>1]=c(a(s.axes[t]),a(-s.axes[t+1])).clampLength();for(let t=s.buttons.length;t--;){const i=s.buttons[t];n[t]=i.pressed?1+2*!Q(t,e):4*Q(t,e),X|=!e&&i.pressed}{const t=c(Q(15,e)-Q(14,e),Q(12,e)-Q(13,e));t.lengthSquared()&&(i[0]=t.clampLength())}}}}()}function et(){for(const t of Z)for(const e in t)t[e]&=1;V=0}onkeydown=t=>{t.repeat||(Z[X=0][st(t.keyCode)]=3)},onkeyup=t=>{Z[0][st(t.keyCode)]=4};const st=t=>87==t?38:83==t?40:65==t?37:68==t?39:t;onmousedown=t=>{Z[X=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=t=>Z[0][t.button]=2&Z[0][t.button]|4,onmousemove=t=>K=nt(t),onwheel=t=>t.ctrlKey||(V=i(t.deltaY)),oncontextmenu=t=>!1;const nt=t=>{if(!F)return c();const e=F.getBoundingClientRect();return c(F.width,F.height).multiply(c(r(t.x,e.left,e.right),r(t.y,e.top,e.bottom)))},it=[];const ot=void 0!==window.ontouchstart;if(ot){let t,e;ontouchstart=ontouchmove=ontouchend=s=>{s.button=0;const n=s.touches.length;return n?(e||at(0,e=1),s.x=s.touches[0].clientX,s.y=s.touches[0].clientY,t?onmousemove(s):onmousedown(s)):t&&onmouseup(s),t=n,!s.cancelable}}let rt;new class{constructor(t){this.time=null==t?void 0:T+t,this.setTime=t}set(t=0){this.time=T+t,this.setTime=t}unset(){this.time=void 0}isSet(){return null!=this.time}active(){return T<=this.time}elapsed(){return T>this.time}get(){return this.isSet()?T-this.time:0}getPercent(){return this.isSet()?r(this.time-T,this.setTime,0):0}toString(){0}},c();const at=(...t)=>function(t,e=1,s=1,n=0,i=0){if(rt||(rt=new(window.AudioContext||webkitAudioContext)),rt.resume(),"running"!=rt.state)return;const r=rt.createBuffer(t.length,t[0].length,ht),a=rt.createBufferSource();t.forEach(((t,e)=>r.getChannelData(e).set(t))),a.buffer=r,a.playbackRate.value=s,a.loop=i;const h=rt.createGain();return h.gain.value=.5*e,h.connect(rt.destination),(window.StereoPannerNode?a.connect(new StereoPannerNode(rt,{pan:o(n,-1,1)})):a).connect(h),a.start(),a}([lt(...t)]),ht=44100;function lt(o=1,r=.05,a=220,l=0,c=0,d=.1,u=0,p=1,y=0,g=0,f=0,x=0,m=0,w=0,b=0,v=0,S=0,C=1,M=0,T=0){let z,k,A=2*t,B=y*=500*A/ht/ht,P=[],R=a*=(1+r*h(-1,1))*A/ht,F=0,D=0,E=0,I=1,L=0,W=0,G=0;for(g*=500*A/ht**3,b*=A/ht,f*=A/ht,x*=ht,m=m*ht|0,k=(l=l*ht+9)+(M*=ht)+(c*=ht)+(d*=ht)+(S*=ht)|0;E<k;P[E++]=G)++W%(100*v|0)||(G=u?u>1?u>2?u>3?Math.sin((F%A)**3):n(s(Math.tan(F),1),-1):1-(2*F/A%2+2)%2:1-4*e(Math.round(F/A)-F/A):Math.sin(F),G=(m?1-T+T*Math.sin(A*E/m):1)*i(G)*e(G)**p*o*.5*(E<l?E/l:E<l+M?1-(E-l)/M*(1-C):E<l+M+c?C:E<k-S?(k-E-S)/d*C:0),G=S?G/2+(S>E?0:(E<k-S?1:(k-E)/S)*P[E-S|0]/2):G),z=(a+=y+=g)*Math.cos(b*D++),F+=z-z*w*(1-1e9*(Math.sin(E)+1)%2),I&&++I>x&&(a+=f,R+=f,I=0),!m||++L%m||(a=R,y=B,I=I||1);return P}c();let ct,dt,ut,pt,yt,gt,ft,xt,mt,wt,bt,vt=[];function St(t,e){const s=ut.createShader(e);return ut.shaderSource(s,t),ut.compileShader(s),s}function Ct(){if(!mt)return;const t=wt?Tt:At;ut.blendFuncSeparate(kt,t,Tt,t),ut.enable(Bt),ut.bufferSubData(Ut,0,ft.subarray(0,mt*Nt*Jt)),ut.drawArrays(zt,0,mt*Nt),mt=0,wt=bt}function Mt(t,e,s,n,i,o,r,a,h,l=4294967295,c=0){mt!=Yt&&wt==bt||Ct();const d=Math.cos(i)/2,u=Math.sin(i)/2,p=d*s,y=d*n,g=u*s,f=u*n;let x=mt++*Nt*Jt;ft[x++]=t-p-f,ft[x++]=e-y+g,ft[x++]=o,ft[x++]=h,xt[x++]=l,xt[x++]=c,ft[x++]=t+p+f,ft[x++]=e+y-g,ft[x++]=a,ft[x++]=r,xt[x++]=l,xt[x++]=c,ft[x++]=t-p+f,ft[x++]=e+y+g,ft[x++]=o,ft[x++]=r,xt[x++]=l,xt[x++]=c,ft[x++]=t-p-f,ft[x++]=e-y+g,ft[x++]=o,ft[x++]=h,xt[x++]=l,xt[x++]=c,ft[x++]=t+p-f,ft[x++]=e-y-g,ft[x++]=a,ft[x++]=h,xt[x++]=l,xt[x++]=c,ft[x++]=t+p+f,ft[x++]=e+y-g,ft[x++]=a,ft[x++]=r,xt[x++]=l,xt[x++]=c}const Tt=1,zt=4,kt=770,At=771,Bt=3042,Pt=3553,Rt=5121,Ft=5126,Dt=6408,Et=9728,It=10240,Lt=10241,Wt=10242,Gt=10243,$t=16384,Ht=33071,Ut=34962,_t=35048,qt=35632,Ot=35633,Nt=6,Jt=6,Yt=65536,jt=24,Kt=0,Vt=1,Xt=2,Qt=3,Zt=4,te=5,ee=0,se=1,ne=2,ie=3,oe=[[0,1],[1,0],[0,-1],[-1,0]],re=0,ae=1,he=2,le=3,ce=4,de=5;class ue{constructor(){this.buttons=[],this.pressedButton=null}addBtn(t){this.buttons.push(t)}removeBtn(t){const e=this.buttons.indexOf(t);e>-1&&this.buttons.splice(e,1)}pressed(){this.pressedButton=null;for(let t=this.buttons.length-1;t>=0&&!this.pressedButton;t--){const e=this.buttons[t];e.containsMousePos()&&(this.pressedButton=e)}return!!this.pressedButton}released(){return!!this.pressedButton&&(this.pressedButton.containsMousePos()&&this.pressedButton.pressed(),this.pressedButton=null,!0)}render(){this.buttons.forEach((t=>t.render()))}}class pe{constructor(t,e,s,n,i,o,r,a=!0){this.pos=t,this.size=e,this.text=s,this.textSize=n,this.bgColor=i,this.textColor=o,this.onPressed=r||(()=>{}),this._enabled=!0,this.visible=!0,this.screenSpace=a}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this.bgColor.a=t?1:.5,this.textColor.a=t?1:.5}containsMousePos(){if(!this.enabled||!this.visible)return!1;const t=this.screenSpace?K:j;return t.x>=this.pos.x-this.size.x/2&&t.y>=this.pos.y-this.size.y/2&&t.x<this.pos.x+this.size.x/2&&t.y<this.pos.y+this.size.y/2}pressed(){this.onPressed()}render(){if(!this.visible)return;let t,e;this.screenSpace?(t=U,e=_):(t=H,e=q),t(this.pos,this.size,this.bgColor),e(this.text,this.pos,this.textSize,this.textColor)}}const ye=new class{constructor(){this.controllerMap=null,this.gameState=re}init(t){this.controllerMap=t}setGameState(t,e){this.gameState=t,this.curController=this.controllerMap[t],this.curController.init(e)}gameUpdate(){this.curController.gameUpdate()}gameRender(){this.curController.gameRender()}},ge=new pe(c(0,-2),c(4,2.5),"Start",1.5,new u(1,1,1),new u(0,0,0),(()=>{ye.setGameState(he)}),!1),fe=new ue;fe.addBtn(ge);const xe={init(){},gameUpdate(){J(0)&&fe.pressed(),Y(0)&&fe.released()},gameRender(){q("Death Estate",c(0,4),5,new u(1,0,0),h(1,1.2),new u(1,1,1)),fe.render()}},me=[null,null,new u(.6,.6,.6),new u(.5,.5,.5),new u(.8,.3,.3),new u(1,0,0)],we=[new u(.3,.3,.3),new u(.35,.35,.35)];class be{constructor(t,e,s){this.x=e,this.y=s,this.type=t||0}copy(){return new be(this.type,this.x,this.y)}apply(t){this.type=t.type}}class ve{constructor(t,e){this.pos=c(),this.tiles=[],this.houses=[],this.snapshotTiles=[],this.allRoadsConnected=!1,this.hasAvailableSpaces=!1,this.size=c(t,e);const s=this.size.x*this.size.y;for(let t=0;t<s;t+=1){const e=new be(0,t%this.size.x,Math.floor(t/this.size.y));this.tiles.push(e),this.snapshotTiles.push(e.copy())}}createSnapshot(){this.tiles.forEach(((t,e)=>this.snapshotTiles[e].apply(t)))}houseCanFit(t){const e=t.getWorldBounds(),s=this.getWorldBounds();if(!(e[0].x>=s[0].x&&e[0].y>=s[0].y&&e[1].x<=s[1].x&&e[1].y<=s[1].y))return!1;const n=t.pos.divide(c(2)),i=t.tiles;for(let t=0;t<i.length;t+=1){const e=i[t];for(let s=0;s<e.length;s+=1){if(!e[s])continue;const i=n.add(c(s,t)),o=this.getTile(i.x,i.y);if(o&&o.type)return!1}}return!0}houseFitsSomewhere(t){const e=t.copy();e.state=ie;for(const t of this.tiles){const s=c(t.x,t.y).multiply(c(2));e.pos=s;for(let t=0;t<4;t++){if(this.houseCanFit(e)&&this.houseIsTouchingRoad(e))return e;e.rotate(1)}}return null}checkAvailableSpaces(){const t=this.tiles.filter((t=>t.type===Xt));for(const e of t)for(const t of oe){const s=c(e.x+t[0],e.y+t[1]),n=this.getTile(s.x,s.y);if(n&&n.type===Kt)return void(this.hasAvailableSpaces=!0)}this.hasAvailableSpaces=!1}houseIsTouchingRoad(t){const e=t.pos.divide(c(2)),s=t.tiles;for(let t=0;t<s.length;t+=1){const n=s[t];for(let s=0;s<n.length;s+=1){if(!n[s])continue;const i=e.add(c(s,t));if(oe.map((t=>this.getTile(i.x+t[0],i.y+t[1]))).filter((t=>t)).some((t=>t.type===Xt)))return!0}}return!1}addHouse(t){t.state=se,this.houses.push(t);const e=t.pos.divide(c(2)),s=t.tiles;for(let t=0;t<s.length;t+=1){const n=s[t];for(let s=0;s<n.length;s+=1){if(!n[s])continue;const i=e.add(c(s,t));this.setTile(i.x,i.y,Vt)}}}getWorldSize(){return this.size.multiply(c(2))}getWorldBounds(){return[this.pos.copy(),this.pos.add(this.size.multiply(c(2)))]}setTile(t,e,s){this.tiles[t+e*this.size.x].type=s}getTile(t,e){return c(t,e).arrayCheck(this.size)?this.tiles[t+e*this.size.x]:null}getTileFromMousePos(){const t=this.getCoordsFromMousePos();return t?this.getTile(t.x,t.y):null}getCoordsFromMousePos(t=!1){return this.getCoordsFromPos(j,t)}getCoordsFromPos(t,e=!1){const s=t.subtract(this.pos).add(c(1));return e||s.arrayCheck(this.size.multiply(c(2)))?s.divide(c(2)).floor():null}setTileLine(t,e,s){const n=[];if(Math.abs(e.x-t.x)<Math.abs(e.y-t.y)){const s=Math.max(Math.min(e.y,t.y),0),i=Math.min(Math.max(e.y,t.y),this.size.y-1);for(let e=s;e<=i;e+=1)n.push(this.getTile(t.x,e))}else{const s=Math.max(Math.min(e.x,t.x),0),i=Math.min(Math.max(e.x,t.x),this.size.x-1);for(let e=s;e<=i;e+=1)n.push(this.getTile(e,t.y))}for(const t of n)t.type=s;return n}resetToSnapshot(){this.tiles.forEach(((t,e)=>t.apply(this.snapshotTiles[e])))}checkRoadConnection(){const t=this.tiles.filter((t=>t.type===Xt||t.type===te));t.forEach((t=>t.type=te));const e=t.filter((t=>0===t.x||0===t.y||t.x===this.size.x-1||t.y===this.size.y-1));e.length?(e.forEach((t=>this.setConnectedRoads(t.x,t.y))),this.allRoadsConnected=t.every((t=>t.type===Xt))):this.allRoadsConnected=!1}setConnectedRoads(t,e){const s=this.getTile(t,e);if(s&&s.type===te){s.type=Xt;for(const s of oe)this.setConnectedRoads(t+s[0],e+s[1])}}getCounts(){const t=this.size.x*this.size.y;let e=0,s=0;for(const t of this.tiles)t.type===Vt?e+=1:t.type===Xt&&(s+=1);return{totalCount:t,houseTileCount:e,roadCount:s}}render(){for(const t of this.tiles){const e=c(t.x,t.y).multiply(c(2)).add(this.pos),s=me[t.type]||we[(t.x+t.y)%2];s&&H(e,c(2),s)}for(const t of this.houses)t.render()}}const Se=[new u,new u(.9,.9,.9),new u(1,.3,.3),new u(1,1,1,.5)];class Ce{constructor(t,e){this.pos=t,this.tiles=e||function(t){const e=2*t-1,s=l(1,e**2+1),n=[],i=[];for(let t=0;t<e;t++)n.push(new Array(e).fill(Kt));for(let t=0;t<s;t++){let s,o;if(0===t)s=l(0,e),o=l(0,e),i.push([s,o]);else{const t=i[l(0,i.length)],r=oe.map((s=>{let i=[t[0]+s[0],t[1]+s[1]];return i[0]<0||i[0]>=e||i[1]<0||i[1]>=e||n[i[1]][i[0]]!==Kt?null:i})).filter((t=>t));if(!r.length)continue;const a=r[l(0,r.length)];[s,o]=a,i.push(a)}n[o][s]=Vt}for(let t=n.length-1;t>=0;t--)n[t].every((t=>t===Kt))&&n.splice(t,1);for(let t=e-1;t>=0;t--)n.map((e=>e[t])).every((t=>t===Kt))&&n.forEach((e=>e.splice(t,1)));return n}(2),this.state=ee}copy(){const t=[];for(let e=0;e<this.tiles.length;e++)t.push([...this.tiles[e]]);return new Ce(this.pos.copy(),t)}getWorldBounds(){const t=2*this.tiles[0].length,e=2*this.tiles.length;return[this.pos.copy(),this.pos.add(c(t,e))]}isClicked(){const t=j.subtract(this.pos).add(c(1)).divide(c(2)).floor(),e=this.tiles[t.y];return!!e&&!!e[t.x]}rotate(t){const e=this.tiles.length,s=this.tiles[0].length,n=new Array(s);for(let t=0;t<s;t++)n[t]=new Array(e).fill(Kt);for(let t=0;t<e;t++)for(let e=0;e<s;e++)n[e][t]=this.tiles[t][e];1===t?n.reverse():n.forEach((t=>t.reverse())),this.tiles=n}render(){for(let t=0;t<this.tiles.length;t+=1){const e=this.tiles[t];for(let s=0;s<e.length;s+=1){if(!e[s])continue;const n=Se[this.state]||new u(1,0,0);H(c(s,t).multiply(c(2)).add(this.pos),c(2),n)}}}}let Me,Te,ze,ke,Ae,Be=c(),Pe=null,Re=null,Fe=c(),De=null;const Ee=c(),Ie=c();let Le=c();const We=new ue,Ge=new pe(c(0,-4),c(5,3),"Done",1.5,new u(1,1,1),new u(0,0,0),(()=>{Me.allRoadsConnected&&ye.setGameState(le)}),!1);We.addBtn(Ge);const $e=new ue,He=new pe(c(0,-5),c(5,3),"Rotate",1.2,new u(1,1,1),new u(0,0,0),(()=>{Ae.rotate(1)}),!1);$e.addBtn(He);const Ue=new pe(He.pos.add(c(0,-4)),c(5,3),"Skip",1.5,new u(1,1,1),new u(0,0,0),(()=>{ze>0&&(ze-=1,Ne()),ze<=0&&(Ue.enabled=!1)}),!1);$e.addBtn(Ue);const _e={lower:c(),upper:c()},qe=Ue.pos.subtract(Ue.size.divide(c(2))).add(c(1)),Oe=He.pos.add(He.size.divide(c(2))).add(c(1));function Ne(){Ae=new Ce(Fe.copy()),De=Me.houseFitsSomewhere(Ae)}const Je={init(){Me=new ve(15,15),Pe=null,Re=null;const t=Me.getWorldSize();x.x=Me.pos.x+t.x/2-1,x.y=Me.pos.y+t.y/2-1,Ge.pos.x=Me.pos.x+t.x/2-1,Ge.enabled=!1,Ee.x=Ge.pos.x,Ee.y=Me.pos.y+t.y-1+5,Ie.x=Ge.pos.x,Ie.y=Ge.pos.y-4},gameUpdate(){if(J(0)&&!We.pressed()&&(Re=Me.getCoordsFromMousePos(),Re)){Me.createSnapshot();const t=Me.getTileFromMousePos();Te=t.type===Xt||t.type===te?Zt:Qt}if(Y(0)){if(We.released(),Re){Me.resetToSnapshot();const t=Me.getCoordsFromMousePos(!0);Te===Qt?Me.setTileLine(Re,t,Xt):Me.setTileLine(Re,t,Kt),Me.checkRoadConnection(),Ge.enabled=Me.allRoadsConnected}Re=null}if(N(0)&&Re){Me.resetToSnapshot();const t=Me.getCoordsFromMousePos(!0);Me.setTileLine(Re,t,Te)}},gameRender(){Me.render(),q("Make roads by clicking and dragging lines\non the grid. Delete by clicking and dragging\non existing roads",Ee,1.5),Me.allRoadsConnected||q("All roads must connect to an edge of the grid",Ie,1.5),We.render()}},Ye={init(){const t=Me.getWorldSize();Fe.x=Me.pos.x+t.x/2-1,Fe.y=-8,ze=3,Ue.enabled=!0;const e=Me.getWorldBounds();_e.lower=e[0].subtract(c(8)),_e.upper=e[1].add(c(8)),Me.checkAvailableSpaces(),Ne()},gameUpdate(){if(Y(2)&&Ae.rotate(1),J(0)&&!$e.pressed()&&Ae.isClicked()&&(Ae.state=ee,Be=Ae.pos.copy(),Pe=j.copy()),Y(0)&&($e.released(),Pe)){Ae.pos.x=2*Math.floor((Ae.pos.x+1)/2),Ae.pos.y=2*Math.floor((Ae.pos.y+1)/2);const t=Ae.getWorldBounds(),e=c((t[0].x+t[1].x)/2,(t[0].y+t[1].y)/2);e.x>=qe.x&&e.x<=Oe.x&&e.y>=qe.y&&e.y<=Oe.y&&(Ae.pos.x=Be.x,Ae.pos.y=Be.y),Me.houseCanFit(Ae)&&Me.houseIsTouchingRoad(Ae)?(Me.addHouse(Ae),Me.checkAvailableSpaces(),Ne()):Ae.state=ne,Pe=null}if(N(0)&&Pe){Ae.pos.x=Be.x+(j.x-Pe.x),Ae.pos.y=Be.y+(j.y-Pe.y);const t=Ae.getWorldBounds();t[0].x<_e.lower.x?Ae.pos.x=_e.lower.x:t[1].x>_e.upper.x&&(Ae.pos.x=_e.upper.x-(t[1].x-t[0].x)),t[0].y<_e.lower.y?Ae.pos.y=_e.lower.y:t[1].y>_e.upper.y&&(Ae.pos.y=_e.upper.y-(t[1].y-t[0].y))}(!Me.hasAvailableSpaces||!De&&ze<=0)&&ye.setGameState(ce)},gameRender(){Me.render(),Ae.render(),q("Place houses! Must touch a road, not overlap\nother houses, and be within the grid",Ee,1.5),q("right-click\nworks too",He.pos.add(c(3,.5)),1,void 0,void 0,void 0,"left"),q(`Skips left: ${ze}`,Ue.pos.add(c(3,0)),1.5,void 0,void 0,void 0,"left"),$e.render()}},je={init(){He.enabled=!1,Ue.enabled=!1,ke=Date.now()},gameUpdate(){const e=Date.now(),s=e-ke;if(Le=((e=1)=>(new d).setAngle(h(2*t),e))(a(r(s,0,1e3),1,0)),s>=3e3){const t=Me.getCounts();ye.setGameState(de,{timestamp:e,totalMaxScore:t.totalCount,score:t.houseTileCount,roadCount:t.roadCount})}},gameRender(){Me.render(),Ae.render(),q("Game over! No more space or skips",Ee.add(Le),1.5),q("right-click\nworks too",He.pos.add(c(3,.5)),1,new u(1,1,1,.5),void 0,void 0,"left"),q(`Skips left: ${ze}`,Ue.pos.add(c(3,0)),1.5,new u(1,1,1,.5),void 0,void 0,"left"),$e.render()}},Ke=new u(1,0,0),Ve=new u(1,1,1),Xe=new u(1,1,1),Qe=new u(1,1,0),Ze="deathestate_jayther_ldb",ts={};let es,ss=[],ns=0,is=0,os=!0;const rs=c(0,18),as=rs.add(c(0,-5)),hs=rs.add(c(0,-13)),ls=hs.add(c(3,-5)),cs=new Array(5);for(let t=0;t<cs.length;t++)cs[t]=[ls.add(c(-.7,-2*t)),ls.add(c(.7,-2*t))];const ds=new ue,us=new pe(rs.add(c(0,-31)),c(5,3),"Retry",1.5,new u(1,1,1),new u(0,0,0),(()=>{ye.setGameState(he)}),!1);function ps(t,e){for(es={score:t,timestamp:e,dateStr:new Date(e).toLocaleDateString(),current:!0},ss.push(es),ss.sort(((t,e)=>{const s=e.score-t.score;return 0===s?e.timestamp-t.timestamp:s}));ss.length>5;)ss.pop();!function(){const t=ss.map((t=>({score:t.score,timestamp:t.timestamp}))),e=JSON.stringify(t);if(os)try{window.localStorage.setItem(Ze,e)}catch(t){os=!1}os||(ts[Ze]=e)}()}ds.addBtn(us);const ys=[{init(){},gameUpdate(){},gameRender(){}},xe,Je,Ye,je,{init(t){ns=t.totalMaxScore,is=t.roadCount,function(){let t=null;if(os)try{t=window.localStorage.getItem(Ze)}catch(t){os=!1}else t=ts[Ze]||null;t&&(ss=JSON.parse(t)),ss.forEach((t=>t.dateStr=new Date(t.timestamp).toLocaleDateString()))}(),ps(t.score,t.timestamp),x.x=0,x.y=0},gameUpdate(){J(0)&&ds.pressed(),Y(0)&&ds.released()},gameRender(){!function(){q("Game over",rs,4,Ke,.5,Ve),q(`You covered ${es.score} tiles (${Math.floor(es.score/ns*100)}%)\n(road count: ${is}, grid total: ${ns})`,as,2,Xe),q("High Scores",hs,4,Ke,.5,Ve);for(let t=0;t<5;t++){const e=ss[t];let s,n,i;e?(s=e.dateStr,n=e.score.toString(),i=e.current?Qe:Xe):(s="-------------",n="---",i=Xe),q(s,cs[t][0],2,i,void 0,void 0,"right"),q(n,cs[t][1],2,i,void 0,void 0,"left")}}(),ds.render()}}],gs=680,fs=940,xs=m;!function(t,e,n,i,o,r){R.onerror=R.onload=()=>{v=c(f).divide(b=c(R.width,R.height)),document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-moz-user-select:none",document.body.appendChild(F=document.createElement("canvas")),D=F.getContext("2d"),F.style=B,function(){0;dt=document.createElement("canvas"),ut=dt.getContext("webgl",{antialias:!1}),dt.style=B,pt=function(t){if(!t||!t.width)return;const e=ut.createTexture();return ut.bindTexture(Pt,e),ut.texImage2D(Pt,0,Dt,Dt,Rt,t),ut.texParameteri(Pt,Lt,Et),ut.texParameteri(Pt,It,Et),ut.texParameteri(Pt,Wt,Ht),ut.texParameteri(Pt,Gt,Ht),e}(R),document.body.appendChild(dt),gt=function(t,e){0;const s=ut.createProgram();ut.attachShader(s,St(t,Ot)),ut.attachShader(s,St(e,qt)),ut.linkProgram(s),0;return s}("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}","precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}");const t=new ArrayBuffer(Yt*Nt*jt);(function(t,e,s){0;const n=ut.createBuffer();ut.bindBuffer(t,n),ut.bufferData(t,e,s)})(Ut,t.byteLength,_t),ft=new Float32Array(t),xt=new Uint32Array(t);let e=mt=0;const s=(t,s,n,i,o=0)=>{const r=ut.getAttribLocation(gt,t);ut.enableVertexAttribArray(r),ut.vertexAttribPointer(r,i,s,o,jt,e),e+=i*n};s("p",Ft,4,2),s("t",Ft,4,2),s("c",Rt,1,4,1),s("a",Rt,1,4,1)}(),document.body.appendChild(E=document.createElement("canvas")),I=E.getContext("2d"),E.style=B,t(),a()};const a=(t=0)=>{let r=t-k;if(k=t,z+=r/1e3,A=s(A+!0*r,50),y.x){E.width=F.width=y.x,E.height=F.height=y.y;const t=innerWidth/innerHeight,e=F.width/F.height;F.style.width=E.style.width=t<e?"100%":"",F.style.height=E.style.height=t<e?"":"100%",dt&&(dt.style.width=F.style.width,dt.style.height=F.style.height)}else E.width=F.width=s(innerWidth,p.x),E.height=F.height=s(innerHeight,p.y);L=c(F.width,F.height);{let t=0;for(A<0&&A>-9&&(t=A,A=0);A>=0;A-=1e3/60)tt(),e(),P(),n(),et();A+=t}L=c(F.width,F.height),D.imageSmoothingEnabled=!1,function(t,e,s,n,i){var o;ut.viewport(0,0,dt.width=t,dt.height=e),ut.clear($t),ut.bindTexture(Pt,yt=pt),ut.useProgram(gt),bt=o;const r=2*i/t,a=2*i/e;ut.uniformMatrix4fv(ut.getUniformLocation(gt,"m"),0,new Float32Array([r,0,0,0,0,a,0,0,1,1,-1,1,-1-r*s,-1-a*n,0,0]))}(F.width,F.height,x.x,x.y,m),i(),S.sort(((t,e)=>t.renderOrder-e.renderOrder));for(const t of S)t.destroyed||t.render();o(),function(){if(!vt.length)return;const t=vt[0],e=z-ct;if(ct)if(e>5)vt.shift(ct=0);else{const s=4.5,n=e<w?1-e/w:e>s?(e-s)/w:0;t.render(n)}else ct=z}(),function(t,e){if(!mt&&!e)return;Ct(),e&&t.drawImage(dt,0,0)}(D),requestAnimationFrame(a)};r?R.src=r:R.onload()}((function(){ws(),ye.init(ys),ye.setGameState(ae)}),(function(){ye.gameUpdate()}),(function(){}),(function(){ye.gameRender()}),(function(){}));let ms=null;function ws(){const t=gs/fs>innerWidth/innerHeight?innerWidth/gs:innerHeight/fs;!function(t){m=t}(xs*t)}window.addEventListener("resize",(function(){clearTimeout(ms),ms=setTimeout(ws,200)}),!1)}();
      </script>
  </body>
</html>
