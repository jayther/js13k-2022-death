<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Death Estate</title>
      <style>
        a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:'';content:none}table{border-collapse:collapse;border-spacing:0}
      </style>
  </head>
  <body>
      <script>
        !function(){"use strict";const t=Math.PI,n=t=>t<0?-t:t,s=(t,n)=>t<n?t:n,e=(t,n)=>t>n?t:n,i=t=>t<0?-1:1,o=(t,n=0,s=1)=>t<n?n:t>s?s:t,r=(t,n=0,s=1)=>s-n?o((t-n)/(s-n)):0,h=(t,n=0,s=1)=>n+o(t)*(s-n),c=(t=1,n=0)=>n+(t-n)*Math.random(),u=(t=1,n=0)=>0|c(t,n),a=(t=0,n)=>null==t.x?new l(t,null==n?t:n):new l(t.x,t.y);class l{constructor(t=0,n=0){this.x=t,this.y=n}t(){return new l(this.x,this.y)}add(t){return new l(this.x+t.x,this.y+t.y)}i(t){return new l(this.x-t.x,this.y-t.y)}multiply(t){return new l(this.x*t.x,this.y*t.y)}o(t){return new l(this.x/t.x,this.y/t.y)}scale(t){return new l(this.x*t,this.y*t)}length(){return this.h()**.5}h(){return this.x**2+this.y**2}u(t){return this.l(t)**.5}l(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const n=this.length();return n?this.scale(t/n):new l(0,t)}g(t=1){const n=this.length();return n>t?this.scale(t/n):this}m(t){return this.x*t.x+this.y*t.y}v(t){return this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}p(t=0,n=1){return this.x=n*Math.sin(t),this.y=n*Math.cos(t),this}rotate(t){const n=Math.cos(t),s=Math.sin(t);return new l(this.x*n-this.y*s,this.x*s+this.y*n)}direction(){return n(this.x)>n(this.y)?this.x<0?3:1:this.y<0?2:0}M(){return new l(this.y,-this.x)}floor(){return new l(Math.floor(this.x),Math.floor(this.y))}S(){return n(this.x*this.y)}k(t,n){return this.add(t.i(this).scale(o(n)))}A(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}class f{constructor(t=1,n=1,s=1,e=1){this.r=t,this.C=n,this.b=s,this.a=e}t(){return new f(this.r,this.C,this.b,this.a)}add(t){return new f(this.r+t.r,this.C+t.C,this.b+t.b,this.a+t.a)}i(t){return new f(this.r-t.r,this.C-t.C,this.b-t.b,this.a-t.a)}multiply(t){return new f(this.r*t.r,this.C*t.C,this.b*t.b,this.a*t.a)}o(t){return new f(this.r/t.r,this.C/t.C,this.b/t.b,this.a/t.a)}scale(t,n=t){return new f(this.r*t,this.C*t,this.b*t,this.a*n)}R(){return new f(o(this.r),o(this.C),o(this.b),o(this.a))}k(t,n){return this.add(t.i(this).scale(o(n)))}$(t=0,n=0,s=1,e=1){const i=s<.5?s*(1+n):s+n-s*n,o=2*s-i,r=(t,n,s)=>(s=(s%1+1)%1)<1/6?t+6*(n-t)*s:s<.5?n:s<2/3?t+(n-t)*(2/3-s)*6:t;return this.r=r(o,i,t+1/3),this.C=r(o,i,t),this.b=r(o,i,t-1/3),this.a=e,this}D(){const t=this.r,n=this.C,s=this.b,e=this.a,i=Math.max(t,n,s),o=Math.min(t,n,s),r=(i+o)/2;let h=0,c=0;if(i!=o){let e=i-o;c=r>.5?e/(2-i-o):e/(i+o),t==i?h=(n-s)/e+(n<s?6:0):n==i?h=(s-t)/e+2:s==i&&(h=(t-n)/e+4)}return[h/6,c,r,e]}H(t=.05,n=0){return new f(this.r+c(t,-t),this.C+c(t,-t),this.b+c(t,-t),this.a+c(n,-n)).R()}toString(){return`rgb(${255*this.r|0},${255*this.C|0},${255*this.b|0},${this.a})`}W(){return(255*this.r|0)+(255*this.C<<8)+(255*this.b<<16)+(255*this.a<<24)}F(t){const n=n=>parseInt(t.slice(n,n+2),16)/255;return this.r=n(1),this.C=n(3),this.b=n(5),this.a=1,this}T(){const t=t=>((t=255*t|0)<16?"0":"")+t.toString(16);return"#"+t(this.r)+t(this.C)+t(this.b)}}let d=a(1920,1200),w=a(),g=a(16),m=.3,v=(a(1),a()),p=e(g.x,g.y);let M=.5;let y,S,k=[],b=[],A=0,C=0,R=0,$=0,D=0;const H="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";function W(){b=k.filter((t=>t.P));const t=n=>{if(!n.U){n.update();for(const s of n.children)t(s)}};for(const n of k)n.parent||t(n);k=k.filter((t=>!t.U)),C=++A/60}const F=new Image;let T,x,P,U,N=a();const B=t=>t.add(a(.5)).i(N.scale(.5)).multiply(a(1/p,-1/p)).add(v),z=t=>t.i(v).multiply(a(p,-p)).add(N.scale(.5)).i(a(.5));function E(t,n=a(1),s=-1,e=g,i=new f,o=0,r,h=new f(0,0,0,0),c=1){if(c)if(s<0||!F.width)At(t.x,t.y,n.x,n.y,o,0,0,0,0,0,i.W());else{const c=y.x/e.x|0,u=e.x/y.x,a=e.y/y.y,l=s%c*u,f=(s/c|0)*a;At(t.x,t.y,r?-n.x:n.x,n.y,o,l+S.x,f+S.y,l-S.x+u,f-S.y+a,i.W(),h.W())}else!function(t,n,s,e,i,o=x){t=z(t),n=n.scale(p),o.save(),o.translate(t.x+.5|0,t.y-.5|0),o.rotate(s),o.scale(e?-n.x:n.x,n.y),i(o),o.restore()}(t,n,o,r,(t=>{if(s<0)t.fillStyle=i,t.fillRect(-.5,-.5,1,1);else{const n=y.x/e.x|0,o=s%n*e.x+m,r=(s/n|0)*e.y+m,h=e.x-.6,c=e.y-.6;t.globalAlpha=i.a,t.drawImage(F,o,r,h,c,-.5,-.5,1,1)}}))}function I(t,n,s,e,i){E(t,n,-1,g,s,e,0,0,i)}function L(t,n,s,e,i){!function(t,n=a(1),s,e,i,o,r,h,c){E(B(t),n.scale(1/p),s,e,i,o,r,h,c)}(t,n,-1,g,s,e,0,0,i)}function _(t,n,s=1,e=new f,i=0,o=new f(0,0,0),r="center",h="arial"){U.fillStyle=e,U.lineWidth=i,U.strokeStyle=o,U.textAlign=r,U.font=s+"px "+h,U.textBaseline="middle",U.lineJoin="round",n=n.t(),(t+"").split("\n").forEach((t=>{i&&U.strokeText(t,n.x,n.y),U.fillText(t,n.x,n.y),n.y+=s}))}function q(t,n,s=1,e,i,o,r,h){_(t,z(n),s*p,e,i*p,o,r,h)}const G=(t,n=0)=>Z[n]&&1&Z[n][t]?1:0,J=G,O=(t,n=0)=>Z[n]&&2&Z[n][t]?1:0,j=(t,n=0)=>Z[n]&&4&Z[n][t]?1:0;let Y=a(),K=a(),Q=0,V=0;const X=(t,n=0)=>G(t,n+1);let Z=[[]];function tt(){document.hasFocus()||(Z=[[]]),Y=B(K),function(){0;if(!navigator.getGamepads||!document.hasFocus())return;const t=navigator.getGamepads();for(let n=t.length;n--;){const s=t[n],e=Z[n+1]||(Z[n+1]=[]),i=it[n]||(it[n]=[]);if(s){const t=.3,o=.8,h=n=>n>t?r(n,t,o):n<-t?-r(-n,t,o):0;for(let t=0;t<s.axes.length-1;t+=2)i[t>>1]=a(h(s.axes[t]),h(-s.axes[t+1])).g();for(let t=s.buttons.length;t--;){const i=s.buttons[t];e[t]=i.pressed?1+2*!X(t,n):4*X(t,n),V|=!n&&i.pressed}{const t=a(X(15,n)-X(14,n),X(12,n)-X(13,n));t.h()&&(i[0]=t.g())}}}}()}function nt(){for(const t of Z)for(const n in t)t[n]&=1;Q=0}onkeydown=t=>{t.repeat||(Z[V=0][st(t.keyCode)]=3)},onkeyup=t=>{Z[0][st(t.keyCode)]=4};const st=t=>87==t?38:83==t?40:65==t?37:68==t?39:t;onmousedown=t=>{Z[V=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=t=>Z[0][t.button]=2&Z[0][t.button]|4,onmousemove=t=>K=et(t),onwheel=t=>t.ctrlKey||(Q=i(t.deltaY)),oncontextmenu=t=>!1;const et=t=>{if(!T)return a();const n=T.getBoundingClientRect();return a(T.width,T.height).multiply(a(r(t.x,n.left,n.right),r(t.y,n.top,n.bottom)))},it=[];const ot=void 0!==window.ontouchstart;if(ot){let t,n;ontouchstart=ontouchmove=ontouchend=s=>{s.button=0;const e=s.touches.length;return e?(n||ht(0,n=1),s.x=s.touches[0].clientX,s.y=s.touches[0].clientY,t?onmousemove(s):onmousedown(s)):t&&onmouseup(s),t=e,!s.cancelable}}let rt;new class{constructor(t){this.time=null==t?void 0:C+t,this.setTime=t}set(t=0){this.time=C+t,this.setTime=t}N(){this.time=void 0}B(){return null!=this.time}active(){return C<=this.time}I(){return C>this.time}get(){return this.B()?C-this.time:0}L(){return this.B()?r(this.time-C,this.setTime,0):0}toString(){0}},a();const ht=(...t)=>function(t,n=1,s=1,e=0,i=0){if(rt||(rt=new(window.AudioContext||webkitAudioContext)),rt.resume(),"running"!=rt.state)return;const r=rt.createBuffer(t.length,t[0].length,ct),h=rt.createBufferSource();t.forEach(((t,n)=>r.getChannelData(n).set(t))),h.buffer=r,h.playbackRate.value=s,h.loop=i;const c=rt.createGain();return c.gain.value=.5*n,c.connect(rt.destination),(window.StereoPannerNode?h.connect(new StereoPannerNode(rt,{pan:o(e,-1,1)})):h).connect(c),h.start(),h}([ut(...t)]),ct=44100;function ut(o=1,r=.05,h=220,u=0,a=0,l=.1,f=0,d=1,w=0,g=0,m=0,v=0,p=0,M=0,y=0,S=0,k=0,b=1,A=0,C=0){let R,$,D=2*t,H=w*=500*D/ct/ct,W=[],F=h*=(1+r*c(-1,1))*D/ct,T=0,x=0,P=0,U=1,N=0,B=0,z=0;for(g*=500*D/ct**3,y*=D/ct,m*=D/ct,v*=ct,p=p*ct|0,$=(u=u*ct+9)+(A*=ct)+(a*=ct)+(l*=ct)+(k*=ct)|0;P<$;W[P++]=z)++B%(100*S|0)||(z=f?f>1?f>2?f>3?Math.sin((T%D)**3):e(s(Math.tan(T),1),-1):1-(2*T/D%2+2)%2:1-4*n(Math.round(T/D)-T/D):Math.sin(T),z=(p?1-C+C*Math.sin(D*P/p):1)*i(z)*n(z)**d*o*.5*(P<u?P/u:P<u+A?1-(P-u)/A*(1-b):P<u+A+a?b:P<$-k?($-P-k)/l*b:0),z=k?z/2+(k>P?0:(P<$-k?1:($-P)/k)*W[P-k|0]/2):z),R=(h+=w+=g)*Math.cos(y*x++),T+=R-R*M*(1-1e9*(Math.sin(P)+1)%2),U&&++U>v&&(h+=m,F+=m,U=0),!p||++N%p||(h=F,w=H,U=U||1);return W}a();let at,lt,ft,dt,wt,gt,mt,vt,pt,Mt,yt,St=[];function kt(t,n){const s=ft.createShader(n);return ft.shaderSource(s,t),ft.compileShader(s),s}function bt(){if(!pt)return;const t=Mt?Ct:Dt;ft.blendFuncSeparate($t,t,Ct,t),ft.enable(Ht),ft.bufferSubData(Lt,0,mt.subarray(0,pt*Jt*Ot)),ft.drawArrays(Rt,0,pt*Jt),pt=0,Mt=yt}function At(t,n,s,e,i,o,r,h,c,u=4294967295,a=0){pt!=jt&&Mt==yt||bt();const l=Math.cos(i)/2,f=Math.sin(i)/2,d=l*s,w=l*e,g=f*s,m=f*e;let v=pt++*Jt*Ot;mt[v++]=t-d-m,mt[v++]=n-w+g,mt[v++]=o,mt[v++]=c,vt[v++]=u,vt[v++]=a,mt[v++]=t+d+m,mt[v++]=n+w-g,mt[v++]=h,mt[v++]=r,vt[v++]=u,vt[v++]=a,mt[v++]=t-d+m,mt[v++]=n+w+g,mt[v++]=o,mt[v++]=r,vt[v++]=u,vt[v++]=a,mt[v++]=t-d-m,mt[v++]=n-w+g,mt[v++]=o,mt[v++]=c,vt[v++]=u,vt[v++]=a,mt[v++]=t+d-m,mt[v++]=n-w-g,mt[v++]=h,mt[v++]=c,vt[v++]=u,vt[v++]=a,mt[v++]=t+d+m,mt[v++]=n+w-g,mt[v++]=h,mt[v++]=r,vt[v++]=u,vt[v++]=a}const Ct=1,Rt=4,$t=770,Dt=771,Ht=3042,Wt=3553,Ft=5121,Tt=5126,xt=6408,Pt=9728,Ut=10240,Nt=10241,Bt=10242,zt=10243,Et=16384,It=33071,Lt=34962,_t=35048,qt=35632,Gt=35633,Jt=6,Ot=6,jt=65536,Yt=24,Kt=0,Qt=1,Vt=2,Xt=3,Zt=4,tn=5,nn=0,sn=1,en=2,on=3,rn=[[0,1],[1,0],[0,-1],[-1,0]],hn=rn.concat([[1,1],[1,-1],[-1,-1],[-1,1]]),cn=0,un=1,an=2,ln=3,fn=4,dn=5,wn={_:1,q:2,G:4,J:8,O:16,j:32,Y:64,K:128},gn=[wn._,wn.q,wn.G,wn.J,wn.O,wn.j,wn.Y,wn.K];class mn{constructor(){this.buttons=[],this.V=null}X(t){this.buttons.push(t)}Z(t){const n=this.buttons.indexOf(t);n>-1&&this.buttons.splice(n,1)}pressed(){this.V=null;for(let t=this.buttons.length-1;t>=0&&!this.V;t--){const n=this.buttons[t];n.tt()&&(this.V=n)}return!!this.V}nt(){return!!this.V&&(this.V.tt()&&this.V.pressed(),this.V=null,!0)}st(){this.buttons.forEach((t=>t.st()))}}class vn{constructor(t,n,s,e,i,o,r,h=!0){this.et=t,this.size=n,this.text=s,this.it=e,this.bgColor=i,this.ot=o,this.rt=r||(()=>{}),this.ht=!0,this.visible=!0,this.ct=h}get enabled(){return this.ht}set enabled(t){this.ht=t,this.bgColor.a=t?1:.5,this.ot.a=t?1:.5}tt(){if(!this.enabled||!this.visible)return!1;const t=this.ct?K:Y;return t.x>=this.et.x-this.size.x/2&&t.y>=this.et.y-this.size.y/2&&t.x<this.et.x+this.size.x/2&&t.y<this.et.y+this.size.y/2}pressed(){this.rt()}st(){if(!this.visible)return;let t,n;this.ct?(t=L,n=_):(t=I,n=q),t(this.et,this.size,this.bgColor),n(this.text,this.et,this.it,this.ot)}}const pn=new class{constructor(){this.ut=null,this.lt=cn}init(t){this.ut=t}ft(t,n){this.lt=t,this.dt=this.ut[t],this.dt.init(n)}wt(){this.dt.wt()}gt(){this.dt.gt()}},Mn=new vn(a(0,-2),a(4,2.5),"Start",1.5,new f(1,1,1),new f(0,0,0),(()=>{pn.ft(an)}),!1),yn=new mn;yn.X(Mn);const Sn={init(){},wt(){O(0)&&yn.pressed(),j(0)&&yn.nt()},gt(){q("Death Estate",a(0,4),5,new f(1,0,0),c(1,1.2),new f(1,1,1)),yn.st()}},kn=[null,null,new f(.6,.6,.6),new f(.5,.5,.5),new f(.8,.3,.3),new f(1,0,0)],bn=[new f(.3,.3,.3),new f(.35,.35,.35)];class An{constructor(t,n,s){this.x=n,this.y=s,this.type=t||0}t(){return new An(this.type,this.x,this.y)}apply(t){this.type=t.type}}class Cn{constructor(t,n){this.et=a(),this.vt=[],this.Mt=[],this.yt=[],this.St=!1,this.kt=!1,this.size=a(t,n);const s=this.size.x*this.size.y;for(let t=0;t<s;t+=1){const n=new An(0,t%this.size.x,Math.floor(t/this.size.y));this.vt.push(n),this.yt.push(n.t())}}bt(){this.vt.forEach(((t,n)=>this.yt[n].apply(t)))}At(t){const n=t.Ct(),s=this.Ct();if(!(n[0].x>=s[0].x&&n[0].y>=s[0].y&&n[1].x<=s[1].x&&n[1].y<=s[1].y))return!1;const e=t.et.o(a(2)),i=t.vt;for(let t=0;t<i.length;t+=1){const n=i[t];for(let s=0;s<n.length;s+=1){if(!(7&n[s]))continue;const i=e.add(a(s,t)),o=this.Rt(i.x,i.y);if(o&&o.type)return!1}}return!0}$t(t){const n=t.t();n.state=on;for(const t of this.vt){const s=a(t.x,t.y).multiply(a(2));n.et=s;for(let t=0;t<4;t++){if(this.At(n)&&this.Dt(n))return n;n.rotate(1)}}return null}Ht(){const t=this.vt.filter((t=>t.type===Vt));for(const n of t)for(const t of rn){const s=a(n.x+t[0],n.y+t[1]),e=this.Rt(s.x,s.y);if(e&&e.type===Kt)return void(this.kt=!0)}this.kt=!1}Dt(t){const n=t.et.o(a(2)),s=t.vt;for(let t=0;t<s.length;t+=1){const e=s[t];for(let s=0;s<e.length;s+=1){if(!(7&e[s]))continue;const i=n.add(a(s,t));if(rn.map((t=>this.Rt(i.x+t[0],i.y+t[1]))).filter((t=>t)).some((t=>t.type===Vt)))return!0}}return!1}Wt(t){t.state=sn,this.Mt.push(t);const n=t.et.o(a(2)),s=t.vt;for(let t=0;t<s.length;t+=1){const e=s[t];for(let s=0;s<e.length;s+=1){if(!(7&e[s]))continue;const i=n.add(a(s,t));this.Ft(i.x,i.y,Qt)}}}Tt(){return this.size.multiply(a(2))}Ct(){return[this.et.t(),this.et.add(this.size.multiply(a(2)))]}Ft(t,n,s){this.vt[t+n*this.size.x].type=s}Rt(t,n){return a(t,n).A(this.size)?this.vt[t+n*this.size.x]:null}xt(){const t=this.Pt();return t?this.Rt(t.x,t.y):null}Pt(t=!1){return this.Ut(Y,t)}Ut(t,n=!1){const s=t.i(this.et).add(a(1));return n||s.A(this.size.multiply(a(2)))?s.o(a(2)).floor():null}Nt(t,n,s){const e=[];if(Math.abs(n.x-t.x)<Math.abs(n.y-t.y)){const s=Math.max(Math.min(n.y,t.y),0),i=Math.min(Math.max(n.y,t.y),this.size.y-1);for(let n=s;n<=i;n+=1)e.push(this.Rt(t.x,n))}else{const s=Math.max(Math.min(n.x,t.x),0),i=Math.min(Math.max(n.x,t.x),this.size.x-1);for(let n=s;n<=i;n+=1)e.push(this.Rt(n,t.y))}for(const t of e)t.type=s;return e}Bt(){this.vt.forEach(((t,n)=>t.apply(this.yt[n])))}zt(){const t=this.vt.filter((t=>t.type===Vt||t.type===tn));t.forEach((t=>t.type=tn));const n=t.filter((t=>0===t.x||0===t.y||t.x===this.size.x-1||t.y===this.size.y-1));n.length?(n.forEach((t=>this.Et(t.x,t.y))),this.St=t.every((t=>t.type===Vt))):this.St=!1}Et(t,n){const s=this.Rt(t,n);if(s&&s.type===tn){s.type=Vt;for(const s of rn)this.Et(t+s[0],n+s[1])}}It(){const t=this.size.x*this.size.y;let n=0,s=0;for(const t of this.vt)t.type===Qt?n+=1:t.type===Vt&&(s+=1);return{Lt:t,_t:n,qt:s}}st(){for(const t of this.vt){const n=a(t.x,t.y).multiply(a(2)).add(this.et),s=kn[t.type]||bn[(t.x+t.y)%2];s&&I(n,a(2),s)}for(const t of this.Mt)t.st()}}const Rn=[new f,new f(.9,.9,.9),new f(1,.3,.3),new f(1,1,1,.5)],$n=a(2),Dn=a(1.5),Hn=1/8,Wn=wn._|wn.q|wn.O,Fn=wn.G|wn.q|wn.j,Tn=wn.G|wn.J|wn.Y,xn=wn._|wn.J|wn.K;class Pn{constructor(t,n){this.et=t,this.vt=n||function(t){const n=2*t-1,s=u(1,n**2+1),e=[],i=[];for(let t=0;t<n;t++)e.push(new Array(n).fill(Kt));for(let t=0;t<s;t++){let s,o;if(0===t)s=u(0,n),o=u(0,n),i.push([s,o]);else{const t=i[u(0,i.length)],r=rn.map((s=>{let i=[t[0]+s[0],t[1]+s[1]];return i[0]<0||i[0]>=n||i[1]<0||i[1]>=n||e[i[1]][i[0]]!==Kt?null:i})).filter((t=>t));if(!r.length)continue;const h=r[u(0,r.length)];[s,o]=h,i.push(h)}e[o][s]=Qt}for(let t=e.length-1;t>=0;t--)e[t].every((t=>t===Kt))&&e.splice(t,1);for(let t=n-1;t>=0;t--)e.map((n=>n[t])).every((t=>t===Kt))&&e.forEach((n=>n.splice(t,1)));return e}(2),this.Gt(),this.state=nn}Gt(){for(let t=0;t<this.vt.length;t++)for(let n=0;n<this.vt[t].length;n++){const s=a(this.vt[t].length,this.vt.length),e=hn.reduce(((e,i,o)=>{const r=a(n+i[0],t+i[1]);return r.A(s)&&7&this.vt[r.y][r.x]?e|gn[o]:e}),0);this.vt[t][n]=7&this.vt[t][n]|e<<3}}t(){const t=[];for(let n=0;n<this.vt.length;n++)t.push([...this.vt[n]]);return new Pn(this.et.t(),t)}Ct(){const t=2*this.vt[0].length,n=2*this.vt.length;return[this.et.t(),this.et.add(a(t,n))]}Jt(){const t=Y.i(this.et).add(a(1)).o(a(2)).floor(),n=this.vt[t.y];return!!n&&!!n[t.x]}rotate(t){const n=this.vt.length,s=this.vt[0].length,e=new Array(s);for(let t=0;t<s;t++)e[t]=new Array(n).fill(Kt);for(let t=0;t<n;t++)for(let n=0;n<s;n++)e[n][t]=this.vt[t][n];1===t?e.reverse():e.forEach((t=>t.reverse())),this.vt=e,this.Gt()}st(){for(let t=0;t<this.vt.length;t+=1){const n=this.vt[t];for(let s=0;s<n.length;s+=1){const e=n[s];if(!(7&e))continue;const i=Rn[this.state]||new f(1,0,0),o=a(s,t).multiply($n).add(this.et);I(o,Dn,i);const r=e>>3;r&wn._&&I(o.add(a(0,Hn).multiply($n)),Dn,i),r&wn.q&&I(o.add(a(Hn,0).multiply($n)),Dn,i),r&wn.G&&I(o.add(a(0,-.125).multiply($n)),Dn,i),r&wn.J&&I(o.add(a(-.125,0).multiply($n)),Dn,i),(r&Wn)===Wn&&I(o.add(a(Hn,Hn).multiply($n)),Dn,i),(r&Fn)===Fn&&I(o.add(a(Hn,-.125).multiply($n)),Dn,i),(r&Tn)===Tn&&I(o.add(a(-.125,-.125).multiply($n)),Dn,i),(r&xn)===xn&&I(o.add(a(-.125,Hn).multiply($n)),Dn,i)}}}}let Un,Nn,Bn,zn,En,In=a(),Ln=null,_n=null,qn=a(),Gn=null;const Jn=a(),On=a();let jn=a();const Yn=new mn,Kn=new vn(a(0,-4),a(5,3),"Done",1.5,new f(1,1,1),new f(0,0,0),(()=>{Un.St&&pn.ft(ln)}),!1);Yn.X(Kn);const Qn=new mn,Vn=new vn(a(0,-5),a(5,3),"Rotate",1.2,new f(1,1,1),new f(0,0,0),(()=>{En.rotate(1)}),!1);Qn.X(Vn);const Xn=new vn(Vn.et.add(a(0,-4)),a(5,3),"Skip",1.5,new f(1,1,1),new f(0,0,0),(()=>{Bn>0&&(Bn-=1,ss()),Bn<=0&&(Xn.enabled=!1)}),!1);Qn.X(Xn);const Zn={lower:a(),upper:a()},ts=Xn.et.i(Xn.size.o(a(2))).add(a(1)),ns=Vn.et.add(Vn.size.o(a(2))).add(a(1));function ss(){En=new Pn(qn.t()),Gn=Un.$t(En)}const es={init(){Un=new Cn(15,15),Ln=null,_n=null;const t=Un.Tt();v.x=Un.et.x+t.x/2-1,v.y=Un.et.y+t.y/2-1,Kn.et.x=Un.et.x+t.x/2-1,Kn.enabled=!1,Jn.x=Kn.et.x,Jn.y=Un.et.y+t.y-1+5,On.x=Kn.et.x,On.y=Kn.et.y-4},wt(){if(O(0)&&!Yn.pressed()&&(_n=Un.Pt(),_n)){Un.bt();const t=Un.xt();Nn=t.type===Vt||t.type===tn?Zt:Xt}if(j(0)){if(Yn.nt(),_n){Un.Bt();const t=Un.Pt(!0);Nn===Xt?Un.Nt(_n,t,Vt):Un.Nt(_n,t,Kt),Un.zt(),Kn.enabled=Un.St}_n=null}if(J(0)&&_n){Un.Bt();const t=Un.Pt(!0);Un.Nt(_n,t,Nn)}},gt(){Un.st(),q("Make roads by clicking and dragging lines\non the grid. Delete by clicking and dragging\non existing roads",Jn,1.5),Un.St||q("All roads must connect to an edge of the grid",On,1.5),Yn.st()}},is={init(){const t=Un.Tt();qn.x=Un.et.x+t.x/2-1,qn.y=-8,Bn=3,Xn.enabled=!0;const n=Un.Ct();Zn.lower=n[0].i(a(8)),Zn.upper=n[1].add(a(8)),Un.Ht(),ss()},wt(){if(j(2)&&En.rotate(1),O(0)&&!Qn.pressed()&&En.Jt()&&(En.state=nn,In=En.et.t(),Ln=Y.t()),j(0)&&(Qn.nt(),Ln)){En.et.x=2*Math.floor((En.et.x+1)/2),En.et.y=2*Math.floor((En.et.y+1)/2);const t=En.Ct(),n=a((t[0].x+t[1].x)/2,(t[0].y+t[1].y)/2);n.x>=ts.x&&n.x<=ns.x&&n.y>=ts.y&&n.y<=ns.y&&(En.et.x=In.x,En.et.y=In.y),Un.At(En)&&Un.Dt(En)?(Un.Wt(En),Un.Ht(),ss()):En.state=en,Ln=null}if(J(0)&&Ln){En.et.x=In.x+(Y.x-Ln.x),En.et.y=In.y+(Y.y-Ln.y);const t=En.Ct();t[0].x<Zn.lower.x?En.et.x=Zn.lower.x:t[1].x>Zn.upper.x&&(En.et.x=Zn.upper.x-(t[1].x-t[0].x)),t[0].y<Zn.lower.y?En.et.y=Zn.lower.y:t[1].y>Zn.upper.y&&(En.et.y=Zn.upper.y-(t[1].y-t[0].y))}(!Un.kt||!Gn&&Bn<=0)&&pn.ft(fn)},gt(){Un.st(),En.st(),q("Place houses! Must touch a road, not overlap\nother houses, and be within the grid",Jn,1.5),q("right-click\nworks too",Vn.et.add(a(3,.5)),1,void 0,void 0,void 0,"left"),q(`Skips left: ${Bn}`,Xn.et.add(a(3,0)),1.5,void 0,void 0,void 0,"left"),Qn.st()}},os={init(){Vn.enabled=!1,Xn.enabled=!1,zn=Date.now()},wt(){const n=Date.now(),s=n-zn;if(jn=((n=1)=>(new l).p(c(2*t),n))(h(r(s,0,1e3),1,0)),s>=3e3){const t=Un.It();pn.ft(dn,{timestamp:n,Ot:t.Lt,jt:t._t,qt:t.qt})}},gt(){Un.st(),En.st(),q("Game over! No more space or skips",Jn.add(jn),1.5),q("right-click\nworks too",Vn.et.add(a(3,.5)),1,new f(1,1,1,.5),void 0,void 0,"left"),q(`Skips left: ${Bn}`,Xn.et.add(a(3,0)),1.5,new f(1,1,1,.5),void 0,void 0,"left"),Qn.st()}},rs=new f(1,0,0),hs=new f(1,1,1),cs=new f(1,1,1),us=new f(1,1,0),as="deathestate_jayther_ldb",ls={};let fs,ds=[],ws=0,gs=0,ms=!0;const vs=a(0,18),ps=vs.add(a(0,-5)),Ms=vs.add(a(0,-13)),ys=Ms.add(a(3,-5)),Ss=new Array(5);for(let t=0;t<Ss.length;t++)Ss[t]=[ys.add(a(-.7,-2*t)),ys.add(a(.7,-2*t))];const ks=new mn,bs=new vn(vs.add(a(0,-31)),a(5,3),"Retry",1.5,new f(1,1,1),new f(0,0,0),(()=>{pn.ft(an)}),!1);function As(t,n){for(fs={jt:t,timestamp:n,Yt:new Date(n).toLocaleDateString(),Kt:!0},ds.push(fs),ds.sort(((t,n)=>{const s=n.jt-t.jt;return 0===s?n.timestamp-t.timestamp:s}));ds.length>5;)ds.pop();!function(){const t=ds.map((t=>({jt:t.jt,timestamp:t.timestamp}))),n=JSON.stringify(t);if(ms)try{window.localStorage.setItem(as,n)}catch(t){ms=!1}ms||(ls[as]=n)}()}ks.X(bs);const Cs=[{init(){},wt(){},gt(){}},Sn,es,is,os,{init(t){ws=t.Ot,gs=t.qt,function(){let t=null;if(ms)try{t=window.localStorage.getItem(as)}catch(t){ms=!1}else t=ls[as]||null;t&&(ds=JSON.parse(t)),ds.forEach((t=>t.Yt=new Date(t.timestamp).toLocaleDateString()))}(),As(t.jt,t.timestamp),v.x=0,v.y=0},wt(){O(0)&&ks.pressed(),j(0)&&ks.nt()},gt(){!function(){q("Game over",vs,4,rs,.5,hs),q(`You covered ${fs.jt} tiles (${Math.floor(fs.jt/ws*100)}%)\n(road count: ${gs}, grid total: ${ws})`,ps,2,cs),q("High Scores",Ms,4,rs,.5,hs);for(let t=0;t<5;t++){const n=ds[t];let s,e,i;n?(s=n.Yt,e=n.jt.toString(),i=n.Kt?us:cs):(s="-------------",e="---",i=cs),q(s,Ss[t][0],2,i,void 0,void 0,"right"),q(e,Ss[t][1],2,i,void 0,void 0,"left")}}(),ks.st()}}],Rs=680,$s=940,Ds=p;!function(t,n,e,i,o,r){F.onerror=F.onload=()=>{S=a(m).o(y=a(F.width,F.height)),document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-moz-user-select:none",document.body.appendChild(T=document.createElement("canvas")),x=T.getContext("2d"),T.style=H,function(){0;lt=document.createElement("canvas"),ft=lt.getContext("webgl",{antialias:!1}),lt.style=H,dt=function(t){if(!t||!t.width)return;const n=ft.createTexture();return ft.bindTexture(Wt,n),ft.texImage2D(Wt,0,xt,xt,Ft,t),ft.texParameteri(Wt,Nt,Pt),ft.texParameteri(Wt,Ut,Pt),ft.texParameteri(Wt,Bt,It),ft.texParameteri(Wt,zt,It),n}(F),document.body.appendChild(lt),gt=function(t,n){0;const s=ft.createProgram();ft.attachShader(s,kt(t,Gt)),ft.attachShader(s,kt(n,qt)),ft.linkProgram(s),0;return s}("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}","precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}");const t=new ArrayBuffer(jt*Jt*Yt);(function(t,n,s){0;const e=ft.createBuffer();ft.bindBuffer(t,e),ft.bufferData(t,n,s)})(Lt,t.byteLength,_t),mt=new Float32Array(t),vt=new Uint32Array(t);let n=pt=0;const s=(t,s,e,i,o=0)=>{const r=ft.getAttribLocation(gt,t);ft.enableVertexAttribArray(r),ft.vertexAttribPointer(r,i,s,o,Yt,n),n+=i*e};s("p",Tt,4,2),s("t",Tt,4,2),s("c",Ft,1,4,1),s("a",Ft,1,4,1)}(),document.body.appendChild(P=document.createElement("canvas")),U=P.getContext("2d"),P.style=H,t(),h()};const h=(t=0)=>{let r=t-$;if($=t,R+=r/1e3,D=s(D+!0*r,50),w.x){P.width=T.width=w.x,P.height=T.height=w.y;const t=innerWidth/innerHeight,n=T.width/T.height;T.style.width=P.style.width=t<n?"100%":"",T.style.height=P.style.height=t<n?"":"100%",lt&&(lt.style.width=T.style.width,lt.style.height=T.style.height)}else P.width=T.width=s(innerWidth,d.x),P.height=T.height=s(innerHeight,d.y);N=a(T.width,T.height);{let t=0;for(D<0&&D>-9&&(t=D,D=0);D>=0;D-=1e3/60)tt(),n(),W(),e(),nt();D+=t}N=a(T.width,T.height),x.imageSmoothingEnabled=!1,function(t,n,s,e,i){var o;ft.viewport(0,0,lt.width=t,lt.height=n),ft.clear(Et),ft.bindTexture(Wt,wt=dt),ft.useProgram(gt),yt=o;const r=2*i/t,h=2*i/n;ft.uniformMatrix4fv(ft.getUniformLocation(gt,"m"),0,new Float32Array([r,0,0,0,0,h,0,0,1,1,-1,1,-1-r*s,-1-h*e,0,0]))}(T.width,T.height,v.x,v.y,p),i(),k.sort(((t,n)=>t.Qt-n.Qt));for(const t of k)t.U||t.st();o(),function(){if(!St.length)return;const t=St[0],n=R-at;if(at)if(n>5)St.shift(at=0);else{const s=4.5,e=n<M?1-n/M:n>s?(n-s)/M:0;t.st(e)}else at=R}(),function(t,n){if(!pt&&!n)return;bt(),n&&t.drawImage(lt,0,0)}(x),requestAnimationFrame(h)};r?F.src=r:F.onload()}((function(){Ws(),pn.init(Cs),pn.ft(un)}),(function(){pn.wt()}),(function(){}),(function(){pn.gt()}),(function(){}));let Hs=null;function Ws(){const t=Rs/$s>innerWidth/innerHeight?innerWidth/Rs:innerHeight/$s;!function(t){p=t}(Ds*t)}window.addEventListener("resize",(function(){clearTimeout(Hs),Hs=setTimeout(Ws,200)}),!1)}();
      </script>
  </body>
</html>
